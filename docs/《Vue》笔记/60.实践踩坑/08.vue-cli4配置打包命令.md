---
title: vue-cli4 é…ç½®æ‰“åŒ…å‘½ä»¤
date: 2022-07-25 11:27:27
permalink: /pages/f5c6ff/
categories:
  - å‰ç«¯æŠ€æœ¯
tags:
  - Vue2.js
---

# vue-cli4 é…ç½®æ‰“åŒ…å‘½ä»¤

## ğŸ“–. å‰è¨€

ä¸ºä»€ä¹ˆä¼šéœ€è¦é…ç½®å¤šç§ç¯å¢ƒå˜é‡ï¼Ÿ

åœ¨ä¸€ä¸ªäº§å“çš„å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¸€èˆ¬æ¥è¯´éƒ½æ˜¯ä¼šç»å†è¿™ä¹ˆä¸€ä¸ªè¿‡ç¨‹ï¼š**æœ¬åœ°å¼€å‘ â†’ æµ‹è¯•ç‰ˆéƒ¨ç½² â†’ æµ‹è¯• â†’ é¢„ä¸Šçº¿ â†’ æ­£å¼ä¸Šçº¿**ã€‚å¯¹åº”çš„æ¯ä¸€ä¸ªç¯èŠ‚ä¸­çš„æœåŠ¡å™¨åœ°å€ï¼Œæ¥å£åœ°å€...éƒ½ä¼šä¸ä¸€æ ·ã€‚é‚£ä¹ˆæˆ‘ä»¬éœ€è¦æ€ä¹ˆå»å¤„ç†è¿™ç§æƒ…å†µã€‚

## ä¸€. å¦‚ä½•é…ç½®ç¯å¢ƒå˜é‡

### 1. åˆ›å»ºæ–‡ä»¶

åœ¨ vue-cli4 çš„è„šæ‰‹æ¶æ„å»ºçš„é¡¹ç›®æ ¹ç›®å½•ä¸­æ–°å»ºä¸€ä¸ª `.env.[model]` æ–‡ä»¶ï¼Œ`model` ä¸ºä¸€ä¸ªå˜é‡ï¼Œå¯ä»¥é€šè¿‡è¿™ä¸ª model çš„å˜é‡å€¼æ¥åˆ¤æ–­å½“å‰å±äºå“ªä¸ªç¯å¢ƒã€‚model å¯ä»¥æ ¹æ®ä½ çš„éœ€æ±‚æ¥ä¿®æ”¹,
è¯¥æ–‡ä»¶ä¸­å†™ä¸Šå¯¹åº”çš„é”®å€¼å¯¹ã€‚ä½ éœ€è¦å¤šå°‘ä¸ªç¯å¢ƒï¼Œå°±åˆ›å»ºå¤šå°‘ä¸ª `.env.[model]` åœ¨æ ¹ç›®å½•ä¸­ï¼Œæ–‡ä»¶å¦‚ä¸‹å›¾ã€‚

```js
# é¢„å‘ç¯å¢ƒ
.env.beta

# å¼€å‘ç¯å¢ƒ
.env.development

# ç”Ÿäº§ç¯å¢ƒ
.env.production

# æµ‹è¯•ç¯å¢ƒ
.env.test
```

ç®€å•è¯´æ˜ä¸€ä¸‹ï¼Œä¸ºä»€ä¹ˆè¦åˆ›å»ºå››ä¸ªæ–‡ä»¶
 
é¦–å…ˆæˆ‘ä»¬åˆ›å»ºçš„æ–‡ä»¶åå¿…é¡»æ˜¯ `.env.xxx`ï¼Œ**.env.xxx æ–‡ä»¶çš„ xxx å¿…é¡»æ˜¯å’Œ package.json é‡Œçš„ script å¯¹è±¡å†…éƒ¨çš„å‘½ä»¤ä¸€è‡´**ã€‚

**ä¸¾ä¸ªä¾‹å­ï¼š**

æˆ‘ä»¬åˆ›å»ºäº† `.env.test` è¿™ä¸ªæ–‡ä»¶ï¼Œé‚£ä¹ˆæˆ‘ä»¬é…ç½®çš„æ‰“åŒ…å‘½ä»¤ `build:test` çš„å€¼ `"vue-cli-service build --mode test"`ï¼Œ--mode åé¢çš„ `test` å¿…é¡»è·Ÿæ–‡ä»¶ `.env.test` ä¸€è‡´ï¼Œè¿™æ ·æˆ‘ä»¬æ‰“åŒ…å‘½ä»¤æ‰ä¼šæ‰¾åˆ°ç¯å¢ƒå˜é‡æ–‡ä»¶é‡Œé¢é…ç½®çš„å‚æ•° `"build:test": "vue-cli-service build --mode test"`

:::tip è¯·æ³¨æ„ï¼ï¼ï¼
åªæœ‰ `NODE_ENV`ï¼Œ`BASE_URL` å’Œä»¥ `VUE_APP_` å¼€å¤´çš„å˜é‡å°†é€šè¿‡ `webpack.DefinePlugin` é™æ€åœ°åµŒå…¥åˆ°å®¢æˆ·ç«¯ä¾§çš„ä»£ç ä¸­ã€‚è¿™æ˜¯ä¸ºäº†é¿å…æ„å¤–å…¬å¼€æœºå™¨ä¸Šå¯èƒ½å…·æœ‰ç›¸åŒåç§°çš„ç§é’¥ã€‚
:::

### 2. ç¯å¢ƒå˜é‡æ–‡ä»¶è¯´æ˜

ç°åœ¨æˆ‘ä»¬æ¥åˆ°é…ç½®æ–‡ä»¶ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶çš„åŠŸèƒ½æ˜¯ä¸ºäº†åˆ¤æ–­å½“å‰æ‰“åŒ…ç¯å¢ƒæ˜¯ç”Ÿäº§è¿˜æ˜¯æµ‹è¯•ï¼Œæˆ–è€…æœ¬åœ°ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥æœ‰å¾ˆå¤šçš„ç¯å¢ƒã€‚åœ¨é…ç½®æ–‡ä»¶ä¸­æˆ‘ä»¬é€šè¿‡ `process.env.VUE_APP_BASE_URL` è¿™ä¸ªå…¨å±€å­—æ®µå»åˆ¤æ–­ç¯å¢ƒï¼Œ
ç„¶åå°†å¯¹åº”çš„æ¥å£åœ°å€åŒ¹é…ä¸Šã€‚æ³¨æ„ä¸€ç‚¹ï¼Œä¸Šé¢çš„ `NODE_ENV = "production"` ä¸å¯ä»¥çœç•¥ï¼Œvue-cli 4.0 åŠä¹‹åçš„ç‰ˆæœ¬ä¼šæ ¹æ® `NODE_ENV = "production"` æ¥åˆ¤æ–­æ˜¯å¦ç”Ÿäº§ç¯å¢ƒï¼Œå¦‚æœä½ æ”¹å˜äº†è¿™ä¸ªå°±ä¼šè¢«é»˜è®¤
`NODE_ENV = "development"`ï¼Œ`development` å’Œ `production` æ¨¡å¼ä¸‹æ‰“åŒ…å‡ºæ¥çš„åŒ…ç»“æ„ä¼šä¸åŒï¼Œä¸ºäº†ä¸€è‡´æ€§ï¼Œæ‰€ä»¥é…ç½®æ–‡ä»¶çš„ç¬¬ä¸€ä¸ªå­—æ®µåº”è¯¥è®¾ç½®ä¸º `NODE_ENV = "production"`ã€‚

> **`.env.test`   (æµ‹è¯•ç¯å¢ƒå˜é‡)**

```js
NODE_ENV = "test"
VUE_APP_BASE_URL = "æ¥å£è¯·æ±‚æµ‹è¯•åœ°å€"
VUE_APP_API = "æ¥å£è¯·æ±‚æµ‹è¯•åœ°å€"
```

> **`.env.production` ï¼ˆæ­£å¼ç¯å¢ƒå˜é‡ï¼‰**

```js
NODE_ENV = "production"
VUE_APP_BASE_URL = "æ¥å£è¯·æ±‚æ­£å¼åœ°å€"
VUE_APP_API = "æ¥å£è¯·æ±‚æ­£å¼åœ°å€"
```

> **`.env.beta`  (é¢„å‘ç¯å¢ƒå˜é‡)**

```js
NODE_ENV = "beta"
VUE_APP_BASE_URL = "æ¥å£è¯·æ±‚é¢„å‘åœ°å€"
VUE_APP_API = "æ¥å£è¯·æ±‚é¢„å‘åœ°å€"
```

> **`.env.development`  (å¼€å‘ç¯å¢ƒå˜é‡)**

```js
NODE_ENV = "development"
VUE_APP_BASE_URL = "/api"  // vue è·¨åŸŸä»£ç†é…ç½®çš„æ ‡è¯†
VUE_APP_API = "æµ‹è¯•ç¯å¢ƒåœ°å€"
```

è¯´æ˜ä¸€ä¸‹å¼€å‘ç¯å¢ƒå˜é‡æ–‡ä»¶ `VUE_APP_BASE_URL` çš„å€¼æŒ‡å‘çš„æ˜¯æˆ‘ä»¬åœ¨ `vue.config.js` é…ç½®çš„è·¨åŸŸä»£ç†çš„å­—ç¬¦ä¸²æ ‡è¯†.

```js
module.exports = {
  publicPath: './',
  devServer: {
    proxy: {
      '/api': {
        target: 'æ¥å£è¯·æ±‚æµ‹è¯•åœ°å€', // API æœåŠ¡å™¨çš„åœ°å€
        ws: true,  // ä»£ç† websockets
        changeOrigin: true, // è™šæ‹Ÿçš„ç«™ç‚¹éœ€è¦æ›´ç®¡ origin
        pathRewrite: {   // é‡å†™è·¯å¾„ æ¯”å¦‚ '/api/aaa/ccc' é‡å†™ä¸º '/aaa/ccc'
          '^/api': ''
        }
      }
    }
  }
}
```

### 3. é…ç½®æ‰“åŒ…å‘½ä»¤

`package.json` æ–‡ä»¶ä¸‹çš„è„šæœ¬ï¼š

```json
{
  "script": {
    "dev": "vue-cli-service serve && webpack-dev-server --open --mode dev",
    "serve": "vue-cli-service serve",
    "build": "vue-cli-service build",
    "build:dev": "vue-cli-service build --mode development",
    "build:prod": "vue-cli-service build --mode production",
    "build:beta": "vue-cli-service build --mode beta",
    "build:test": "vue-cli-service build --mode test"
  }
}
```

ä¸Šé¢æåˆ°åˆ›å»ºçš„ `.env.[model]` æ–‡ä»¶çˆ±ä½ ï¼Œæ–‡ä»¶åä¸­çš„ `model` å¯¹åº” `package.json` æ–‡ä»¶ä¸­çš„æ‰“åŒ…è„šæœ¬ `--model [model]`ã€‚

ä¾‹å¦‚æˆ‘ç°åœ¨æƒ³æ‰“åŒ…æ­£å¼ç¯å¢ƒï¼Œæ­£å¼ç¯å¢ƒå¯¹åº” `.env.[model]` å°±æ˜¯ `.env.prop`ã€‚

åœ¨ `package.json` çš„ `script` ä¸­æ·»åŠ  `"build:prod": "vue-cli-service build --mode production"`ï¼Œå…¶ä¸­ `production` è¿™ä¸ªå¯¹åº”é…ç½®æ–‡ä»¶åçš„ `mode`ï¼Œè¿™æ · webpack æ‰“åŒ…çš„æ—¶å€™ä¼šè‡ªåŠ¨è·Ÿè¸ªåˆ°è¿™ä¸ªæ–‡ä»¶ï¼Œå¹¶å»è¯»å–å…¶ä¸­çš„å„ç§é…ç½®å­—æ®µï¼Œ
æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ä»»æ„ä½ç½®å°±å¯ä»¥é€šè¿‡ `process.env.xx` æ‹¿åˆ°å…¶ä¸­ xx é…ç½®å±æ€§ã€‚

ç°åœ¨æˆ‘ä»¬åªéœ€è¦è¿è¡Œå¯¹åº”çš„è„šæœ¬å‘½ä»¤å°±å¯ä»¥æ‰“åŒ…å¯¹åº”ç¯å¢ƒçš„é¡¹ç›®ä»£ç ã€‚ä¾‹å¦‚ï¼šæˆ‘ç°åœ¨æƒ³æ‰“åŒ… `production` ç¯å¢ƒä¸‹çš„é¡¹ç›®ï¼Œåœ¨æ§åˆ¶å°è¿è¡Œ `npm run build:prod`ï¼Œå°±å¯ä»¥æ‰§è¡Œæ­£å¼ç¯å¢ƒæ‰“åŒ…ã€‚è¿è¡Œ `npm run build:dev`ï¼Œåˆ™å¯ä»¥æ‰“åŒ…æµ‹è¯•ç¯å¢ƒï¼Œè¯¥æ¨¡å¼ä¹Ÿå¯ç”¨äºè‡ªåŠ¨åŒ–éƒ¨ç½²ã€‚

ç»¼ä¸Šæ‰€è¿°ï¼Œvue-cli4.xç‰ˆæœ¬çš„æ‰“åŒ…å‘½ä»¤å’Œç¯å¢ƒå˜é‡å°±é…ç½®å®Œæˆäº†ã€‚
