---
title: keep-alive æ·±å…¥ç†è§£åŠå®è·µæ€»ç»“
date: 2019-08-19 16:47:27
permalink: /pages/ec3c1c/
categories:
  - å‰ç«¯æŠ€æœ¯
tags:
  - Vue.js2
---

# keep-alive æ·±å…¥ç†è§£åŠå®è·µæ€»ç»“

## ğŸ“–. å‰è¨€

åœ¨å¹³å¸¸å¼€å‘ä¸­ï¼Œæœ‰éƒ¨åˆ†ç»„ä»¶æ²¡æœ‰å¿…è¦å¤šæ¬¡åˆå§‹åŒ–ã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å°†ç»„ä»¶è¿›è¡ŒæŒä¹…åŒ–ï¼Œ**ä½¿ç»„ä»¶çš„çŠ¶æ€ç»´æŒä¸å˜**ï¼Œåœ¨ä¸‹ä¸€æ¬¡å±•ç¤ºæ—¶ï¼Œä¹Ÿä¸ä¼šè¿›è¡Œé‡æ–°åˆå§‹åŒ–ç»„ä»¶ã€‚

## ä¸€. ä»€ä¹ˆæ˜¯ `keep-alive`

ä¹Ÿå°±æ˜¯è¯´ï¼Œ`keepalive` æ˜¯ `Vue` å†…ç½®çš„ä¸€ä¸ªç»„ä»¶ï¼Œå¯ä»¥**ä½¿è¢«åŒ…å«çš„ç»„ä»¶ä¿ç•™çŠ¶æ€ï¼Œæˆ–é¿å…é‡æ–°æ¸²æŸ“**ã€‚ä¹Ÿå°±æ˜¯æ‰€è°“çš„**ç»„ä»¶ç¼“å­˜**

`keep-alive` æ˜¯ Vue çš„å†…ç½®ç»„ä»¶ï¼Œèƒ½åœ¨ç»„ä»¶åˆ‡æ¢è¿‡ç¨‹ä¸­å°†çŠ¶æ€ä¿ç•™åœ¨å†…éƒ¨ä¸­ï¼Œæˆ¿ä¸œé‡å¤æ¸²æŸ“ DOMã€‚

> `keep-alive` åŒ…è£¹åŠ¨æ€ç»„ä»¶æ—¶ï¼Œä¼šç¼“å­˜ä¸æ´»åŠ¨çš„ç»„ä»¶å®ä¾‹ï¼Œè€Œä¸æ˜¯é”€æ¯å®ƒä»¬ã€‚å’Œ `<transition>` ç›¸ä¼¼ï¼Œ`keep-alive` æ˜¯ä¸€ä¸ªæŠ½è±¡ç»„ä»¶ï¼šå®ƒè‡ªèº«ä¸ä¼šæ¸²æŸ“ä¸€ä¸ª `DOM` å…ƒç´ ï¼Œä¹Ÿä¸ä¼šå‡ºç°åœ¨çˆ¶ç»„ä»¶é“¾ä¸­ã€‚

**prop:**

- `include` â†’ å­—ç¬¦ä¸²æˆ–æ­£åˆ™è¡¨è¾¾å¼ã€‚åªæœ‰åŒ¹é…çš„ç»„ä»¶ä¼šè¢«ç¼“å­˜ã€‚
- `exclude` â†’ å­—ç¬¦ä¸²æˆ–æ­£åˆ™è¡¨è¾¾å¼ã€‚ä»»ä½•åŒ¹é…çš„ç»„ä»¶éƒ½ä¸ä¼šè¢«ç¼“å­˜ã€‚

## äºŒ. å£°æ˜å‘¨æœŸæ‰§è¡Œé¡ºåº

- é¡µé¢ç¬¬ä¸€æ¬¡è¿›å…¥ï¼Œé’©å­çš„è§¦å‘é¡ºåº: `created â†’ mounted â†’ activated`ï¼›é€€å‡ºæ—¶è§¦å‘ `deactivated`ï¼›å½“å†æ¬¡è¿›å…¥ï¼ˆå‰è¿›æˆ–è€…åé€€ï¼‰æ—¶ï¼Œåªè§¦å‘ `activated`
- äº‹ä»¶æŒ‚è½½çš„æ–¹æ³•ç­‰ï¼Œåªæ‰§è¡Œä¸€æ¬¡çš„æ”¾åœ¨ `mounted` ä¸­ï¼›ç»„ä»¶æ¯æ¬¡è¿›å»æ‰§è¡Œçš„æ–¹æ³•æ”¾åœ¨ `activated` ä¸­

## ä¸‰. åŸºæœ¬ç”¨æ³•

```html
<!--è¢«keepaliveåŒ…å«çš„ç»„ä»¶ä¼šè¢«ç¼“å­˜-->
<keep-alive>
  <component><component />
</keep-alive>
```

è¢« `keepalive` åŒ…å«çš„ç»„ä»¶ä¸ä¼šè¢«å†æ¬¡åˆå§‹åŒ–ï¼Œä¹Ÿå°±æ„å‘³ç€**ä¸ä¼šé‡èµ°ç”Ÿå‘½å‘¨æœŸå‡½æ•°**

ä½†æ˜¯æœ‰æ—¶å€™æ˜¯å¸Œæœ›æˆ‘ä»¬ç¼“å­˜çš„ç»„ä»¶å¯ä»¥èƒ½å¤Ÿå†æ¬¡è¿›è¡Œæ¸²æŸ“ï¼Œè¿™æ—¶ `Vue` ä¸ºæˆ‘ä»¬è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚è¢«åŒ…å«åœ¨ `keep-alive` ä¸­åˆ›å»ºçš„ç»„ä»¶ï¼Œä¼šå¤šå‡ºä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸçš„é’©å­ï¼š`activated` ä¸ `deactivated`ï¼š

- `activated` å½“ `keepalive` åŒ…å«çš„ç»„ä»¶å†æ¬¡æ¸²æŸ“çš„æ—¶å€™è§¦å‘
- `deactivated` å½“ `keepalive` åŒ…å«çš„ç»„ä»¶é”€æ¯çš„æ—¶å€™è§¦å‘

`keepalive` æ˜¯ä¸€ä¸ªæŠ½è±¡çš„ç»„ä»¶ï¼Œç¼“å­˜çš„ç»„ä»¶ä¸ä¼šè¢« `mounted`ï¼Œä¸ºæ­¤æä¾› `activated` å’Œ `deactivated` é’©å­å‡½æ•°

## å››. å‚æ•°ç†è§£

`keepalive` å¯ä»¥æ¥æ”¶ 3 ä¸ªå±æ€§åšä¸ºå‚è€ƒè¿›è¡ŒåŒ¹é…å¯¹åº”çš„ç»„ä»¶è¿›è¡Œç¼“å­˜ï¼š

- `include` â†’ åŒ…å«çš„ç»„ä»¶ï¼ˆå¯ä»¥ä¸ºå­—ç¬¦ä¸²ï¼Œæ•°ç»„ï¼Œä»¥åŠæ­£åˆ™è¡¨è¾¾å¼ï¼Œåªæœ‰åŒ¹é…çš„ç»„ä»¶ä¼šè¢«ç¼“å­˜ï¼‰
- `exclude` â†’ æ’é™¤çš„ç»„ä»¶ï¼ˆä»¥ä¸ºå­—ç¬¦ä¸²ï¼Œæ•°ç»„ï¼Œä»¥åŠæ­£åˆ™è¡¨è¾¾å¼ï¼Œä»»ä½•åŒ¹é…çš„ç»„ä»¶éƒ½ä¸ä¼šè¢«ç¼“å­˜ï¼‰
- `max` â†’ ç¼“å­˜ç»„ä»¶çš„æœ€å¤§å€¼ï¼ˆç±»å‹ä¸ºå­—ç¬¦ä¸²æˆ–è€…æ•°å­—ï¼Œå¯ä»¥æ§åˆ¶ç¼“å­˜ç»„ä»¶çš„ä¸ªæ•°ï¼‰

> **æ³¨ï¼šå½“ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æˆ–è€…æ•°ç»„æ—¶ï¼Œä¸€å®šè¦ç”¨ `v-bind`**

```html
<!-- å°†ï¼ˆåªï¼‰ç¼“å­˜ç»„ä»¶ name ä¸º a æˆ–è€… b çš„ç»„ä»¶, ç»“åˆåŠ¨æ€ç»„ä»¶ä½¿ç”¨ -->
<keep-alive include="a,b">
  <component></component>
</keep-alive>

<!-- ç»„ä»¶ name ä¸º c çš„ç»„ä»¶ä¸ç¼“å­˜(å¯ä»¥ä¿ç•™å®ƒçš„çŠ¶æ€æˆ–é¿å…é‡æ–°æ¸²æŸ“) -->
<keep-alive exclude="c"> 
  <component></component>
</keep-alive>

<!-- ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ï¼Œéœ€ä½¿ç”¨ v-bind -->
<keep-alive :include="/a|b/">
  <component :is="view"></component>
</keep-alive>

<!-- åŠ¨æ€åˆ¤æ–­ -->
<keep-alive :include="includedComponents">
  <router-view></router-view>
</keep-alive>

<!-- å¦‚æœåŒæ—¶ä½¿ç”¨ include,exclude,é‚£ä¹ˆ exclude ä¼˜å…ˆäº includeï¼Œ ä¸‹é¢çš„ä¾‹å­åªç¼“å­˜ a ç»„ä»¶ -->
<keep-alive include="a,b" exclude="b"> 
  <component></component>
</keep-alive>

<!-- å¦‚æœç¼“å­˜çš„ç»„ä»¶è¶…è¿‡äº† max è®¾å®šçš„å€¼ 5ï¼Œé‚£ä¹ˆå°†åˆ é™¤ç¬¬ä¸€ä¸ªç¼“å­˜çš„ç»„ä»¶ -->
<keep-alive exclude="c" max="5"> 
  <component></component>
</keep-alive>
```

## äº”. ç¼“å­˜éƒ¨åˆ†é¡µé¢

ç»“åˆ `vue-router` å’Œ `router` ä½¿ç”¨ï¼Œå®ç°ç¼“å­˜éƒ¨åˆ†é¡µé¢æ•ˆæœã€‚

### 5.1 å…¨ç¼“å­˜

æ‰€æœ‰è·¯å¾„ä¸‹çš„è§†å›¾ç»„ä»¶éƒ½ä¼šè¢«ç¼“å­˜

```html
<keep-alive>
  <router-view>
    <!-- æ‰€æœ‰è·¯å¾„åŒ¹é…åˆ°çš„è§†å›¾ç»„ä»¶éƒ½ä¼šè¢«ç¼“å­˜ï¼ -->
  </router-view>
</keep-alive>
```

### 5.2 éƒ¨åˆ†ç¼“å­˜

å¦‚æœåªæƒ³è¦ `router-view` é‡Œé¢çš„æŸä¸ªç»„ä»¶è¢«ç¼“å­˜ï¼Œæ€ä¹ˆåŠï¼Ÿ

- ä½¿ç”¨ `include` / `exclude`
- ä½¿ç”¨ `meta` å±æ€§

1. ç”¨ `include`ï¼ˆ`exclude` ä¾‹å­ç±»ä¼¼ï¼‰

> ç¼ºç‚¹ï¼šéœ€è¦çŸ¥é“ç»„ä»¶çš„ nameï¼Œé¡¹ç›®å¤æ‚çš„æ—¶å€™ä¸æ˜¯å¾ˆå¥½çš„é€‰æ‹©

```html
<keep-alive include="a">
  <router-view>
    <!-- åªæœ‰è·¯å¾„åŒ¹é…åˆ°çš„ include ä¸º a ç»„ä»¶ä¼šè¢«ç¼“å­˜ -->
  </router-view>
</keep-alive>
```

2. ä½¿ç”¨ `meta` å±æ€§

> ä¼˜ç‚¹ï¼šä¸éœ€è¦æå†³å‡ºéœ€è¦è¢«ç¼“å­˜ç»„ä»¶åç§°

ä½¿ç”¨ `$route.meta` çš„ `keepAlive` å±æ€§ï¼š

```html
<keep-alive>
  <router-view v-if="$route.meta.keepAlive"></router-view>
</keep-alive>

<router-view v-if="!$route.meta.keepAlive"></router-view>
```

éœ€è¦åœ¨ `router` ä¸­è®¾ç½® router çš„å…ƒä¿¡æ¯ metaï¼š

```vue
//...router.js
export default new Router({
  routes: [
    {
      path: '/',
      name: 'Hello',
      component: Hello,
      meta: {
        keepAlive: false // ä¸éœ€è¦ç¼“å­˜
      }
    },
    {
      path: '/page1',
      name: 'Page1',
      component: Page1,
      meta: {
        keepAlive: true // éœ€è¦è¢«ç¼“å­˜
      }
    }
  ]
})
```

## å…­. åŠ ç›ï¼šrouter.meta æ‹“å±•

å‡è®¾è¿™é‡Œæœ‰ 3 ä¸ªè·¯ç”±ï¼šAã€Bã€C

- éœ€æ±‚ï¼š
  - é»˜è®¤æ˜¾ç¤º A
  - B è·³åˆ° Aï¼ŒA ä¸åˆ·æ–°
  - C è°ƒåˆ° Aï¼ŒA åˆ·æ–°

- å®ç°æ–¹å¼

1. åœ¨ A è·¯ç”±é‡Œé¢è®¾ç½® meta å±æ€§ï¼š

```
{
  path: '/',
  name: 'A',
  component: A,
  meta: {
    keepAlive: true // éœ€è¦è¢«ç¼“å­˜
  }
}
```

2. åœ¨ B ç»„ä»¶é‡Œé¢è®¾ç½® `beforeRouteLeave`:

```vue
export default {
  data() {
    return {};
  },
  methods: {},
  beforeRouteLeave(to, from, next) {
    // è®¾ç½®ä¸‹ä¸€ä¸ªè·¯ç”±çš„ meta
    to.meta.keepAlive = true;  // è®© A ç¼“å­˜ï¼Œå³ä¸åˆ·æ–°
    next();
  }
};
```

3. åœ¨ C ç»„ä»¶é‡Œé¢è®¾ç½® `beforeRouteLeave`:

```vue
export default {
  data() {
    return {};
  },
  methods: {},
  beforeRouteLeave(to, from, next) {
    // è®¾ç½®ä¸‹ä¸€ä¸ªè·¯ç”±çš„ meta
    to.meta.keepAlive = false; // è®© A ä¸ç¼“å­˜ï¼Œå³åˆ·æ–°
    next();
  }
};
```

è¿™æ ·ä¾¿èƒ½å®ç° B å›åˆ° Aï¼ŒA ä¸åˆ·æ–°ï¼›è€Œ C å›åˆ° A åˆ™åˆ·æ–°ã€‚

## ä¸ƒ. é˜²å‘æŒ‡å—

1. `keep-alive` å…ˆåŒ¹é…è¢«åŒ…å«ç»„ä»¶çš„ `name` å­—æ®µï¼Œå¦‚æœ `é‚£ä¹ˆ` ä¸å¯ç”¨ï¼ŒåŒ¹é…å½“å‰ç»„ä»¶ `components` é…ç½®ä¸­çš„æ³¨å†Œåç§°ã€‚
2. `keep-alive` ä¸ä¼šåœ¨å‡½æ•°å¼ç»„ä»¶ä¸­æ­£å¸¸å·¥ä½œï¼Œå› ä¸ºå®ƒä»¬æ²¡æœ‰ç¼“å­˜å®ä¾‹ã€‚
3. å½“åŒ¹é…æ¡ä»¶åŒæ—¶åœ¨ `include` ä¸ `exclude` å­˜åœ¨æ—¶ï¼Œä»¥ `exclude` ä¼˜å…ˆçº§æœ€é«˜ï¼ˆå½“å‰ vue 2.4.2 versionï¼‰ã€‚æ¯”å¦‚ï¼šåŒ…å«äºæ’é™¤åŒæ—¶åŒ¹é…åˆ°äº†ç»„ä»¶ Aï¼Œé‚£ç»„ä»¶ A ä¸ä¼šè¢«ç¼“å­˜ã€‚
4. åŒ…å«åœ¨ `keep-alive`ä¸­ï¼Œä½†ç¬¦åˆ `exclude`ï¼Œä¸ä¼šè°ƒç”¨ `activated` å’Œ `deactivated`ã€‚

**å®ç°å‰è¿›åˆ·æ–°ï¼Œåé€€ä¸åˆ·æ–°**ï¼Œæ„Ÿè°¢ [iceuncle](https://www.jianshu.com/u/beced864ad95) åˆ†äº«çš„ [ã€Švueå®ç°å‰è¿›åˆ·æ–°ï¼Œåé€€ä¸åˆ·æ–°ã€‹](https://juejin.im/post/6844903555657269261) ã€‚

## å…«. æ€»ç»“

è·¯ç”±å¤§æ³•ä¸é”™ï¼Œä¸éœ€è¦å…³å¿ƒå“ªä¸ªé¡µé¢è·³è½¬è¿‡æ¥çš„ï¼Œåªè¦ `router.go(-1)` å°±èƒ½å›å»ï¼Œä¸éœ€è¦é¢å¤–å‚æ•°ã€‚

åœ¨éå•é¡µåº”ç”¨çš„æ—¶å€™ï¼Œ`keep-alive` å¹¶ä¸èƒ½æœ‰æ•ˆçš„ç¼“å­˜äº† = =

keep-alive ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°ï¼šactivatedã€deactivated

ä½¿ç”¨ `<keep-alive>` ä¼šå°†æ•°æ®ä¿ç•™åœ¨å†…å­˜ä¸­ï¼Œå¦‚æœè¦åœ¨æ¯æ¬¡è¿›å…¥é¡µé¢çš„æ—¶å€™è·å–æœ€æ–°çš„æ•°æ®ï¼Œéœ€è¦åœ¨ `activated` é˜¶æ®µè·å–æ•°æ®ï¼Œæ‰¿æ‹…åŸæ¥ `created` é’©å­ä¸­è·å–æ•°æ®çš„ä»»åŠ¡ã€‚

## ä¹. é™„å½•

ç”Ÿå‘½å‘¨æœŸå‡½æ•°ï¼šå°±æ˜¯ vue åœ¨æŸä¸ªæ—¶é—´æ®µä¼šè‡ªåŠ¨æ‰§è¡Œçš„å‡½æ•°

1. `beforeCreate() {}` â†’ åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œdata è¿˜æœ‰ methods éƒ½è¿˜æ²¡æœ‰è¢«åˆå§‹åŒ–ã€‚
2. `created() {}` â†’ data è¿˜æœ‰ methods éƒ½è¢«åˆå§‹åŒ–å¥½äº†ï¼Œå¦‚æœè¦è°ƒç”¨ `methods` æ–¹æ³•æˆ–è€…æ“ä½œ `data` é‡Œé¢çš„æ•°æ®ï¼Œæœ€æ—©åªèƒ½åœ¨ `created` é‡Œé¢è¿›è¡Œæ“ä½œã€‚
3. `beforeMount() {}` â†’ è¡¨ç¤ºæ¨¡æ¿å·²ç»åœ¨å†…å­˜ä¸­ç¼–è¯‘å®Œæˆäº†ï¼Œä½†æ˜¯å°šæœªæ¸²æŸ“åˆ°æ¨¡æ¿é¡µé¢ä¸­ã€‚å³é¡µé¢ä¸­çš„å…ƒç´ ï¼Œæ²¡æœ‰è¢«çœŸæ­£çš„æ›¿æ¢è¿‡æ¥ï¼Œåªæ˜¯ä¹‹å‰å†™çš„ä¸€äº›æ¨¡æ¿å­—ç¬¦ä¸²ã€‚
4. `mounted() {}` â†’ è¡¨ç¤ºå†…å­˜ä¸­æ¨¡æ¿å·²ç»çœŸå®çš„æŒ‚è½½åˆ°é¡µé¢ä¸­å»äº†ï¼Œç”¨æˆ·å¯ä»¥çœ‹åˆ°æ¸²æŸ“å¥½çš„ç•Œé¢äº†ã€‚
   > - **æ³¨æ„**ï¼šè¿™æ˜¯ç”Ÿå‘½å‘¨æœŸå‡½æ•°çš„æœ€åä¸€ä¸ªå‡½æ•°äº†ï¼Œæ‰§è¡Œå®Œè¿™ä¸ªå‡½æ•°è¡¨ç¤ºï¼šæ•´ä¸ª vue å®ä¾‹å·²ç»åˆå§‹åŒ–å®Œæˆäº†ï¼Œç»„ä»¶è„±ç¦»äº†åˆ›å»ºé˜¶æ®µï¼Œè¿›å…¥è¿è¡Œé˜¶æ®µã€‚
   > - ä¸‹é¢æ˜¯è¿è¡ŒæœŸé—´çš„ä¸¤ä¸ªç”Ÿå‘½å‘¨æœŸå‡½æ•°çš„é’©å­ï¼š
5. `beforeUpdate() {}` â†’ è¡¨ç¤ºæˆ‘ä»¬çš„ç•Œé¢è¿˜æ²¡æ›´æ–°ï¼Œä½†æ˜¯ data é‡Œé¢çš„æ•°æ®æ˜¯æœ€æ–°çš„ã€‚å³é¡µé¢å°šæœªå’Œæœ€æ–°çš„ data é‡Œé¢çš„æ•°æ®ä¿æŒåŒæ­¥ã€‚
6. `updated() {}` â†’ è¡¨ç¤ºé¡µé¢å’Œ data é‡Œé¢çš„æ•°æ®å·²ç»ä¿æŒåŒæ­¥äº†ï¼Œéƒ½æ˜¯æœ€æ–°çš„ã€‚
7. `beforeDestory() {}` â†’ å½“æ‰§è¡Œè¿™ä¸ªç”Ÿå‘½å‘¨æœŸé’©å­çš„æ—¶å€™ï¼Œvue çš„å®ä¾‹ä»è¿è¡Œé˜¶æ®µè¿›å…¥é”€æ¯é˜¶æ®µã€‚æ­¤æ—¶å®ä¾‹èº«ä¸Šçš„ data è¿˜æœ‰ methods å¤„äºå¯ç”¨çš„çŠ¶æ€ã€‚
8. `destoryed() {}` â†’ è¡¨ç¤ºç»„ä»¶å·²ç»å®Œå…¨é”€æ¯äº†ï¼Œç»„ä»¶ä¸­æ‰€æœ‰çš„å®ä¾‹æ–¹æ³•éƒ½ä¸èƒ½ç”¨äº†ã€‚

## å‚è€ƒ

- [issues#811](https://github.com/vuejs/vue-router/issues/811)
- [vue#keep-alive](https://cn.vuejs.org/v2/api/#keep-alive)
- [vue2.0 keep-aliveæœ€ä½³å®è·µ](https://segmentfault.com/a/1190000008123035)
