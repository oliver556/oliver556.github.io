---
title: HTML5 ä¸­çš„ API æ¦‚è§ˆ
date: 2020-04-21 17:39:38
permalink: /pages/78ff51/
categories:
  - å‰ç«¯æŠ€æœ¯
tags:
  - HTML
---

# HTML5 ä¸­çš„ API æ¦‚è§ˆ

> æ•´ç†ä¸€ä¸‹ HTML5 ä¸­çš„å¸¸è§ APIã€‚

## ğŸ“–. å‰è¨€

HTML5 ä¸­æä¾›äº†ä¸€äº›åŠŸèƒ½å¼ºå¤§çš„ APIï¼Œåœ¨ä¸è€ƒè™‘å…¼å®¹æ€§çš„æƒ…å†µä¸‹ï¼Œæ¯”èµ·åŸç”Ÿ js å®ç°æ›´åŠ ç®€å•ï¼Œæ¯”èµ· `jQuery` å¯ä»¥å°‘å¼•å…¥åŒ…ï¼Œè¿™é‡Œæ•´ç†å‡ ä¸ªå¸¸ç”¨çš„ã€‚

## ä¸€. è·å–é¡µé¢å…ƒç´ åŠç±»åæ“ä½œå’Œè‡ªå®šä¹‰å±æ€§

### 1. è·å–é¡µé¢å…ƒç´ 

- `document.querySelector(â€œé€‰æ‹©å™¨â€);`
  - é€‰æ‹©å™¨ï¼šå¯ä»¥æ˜¯ css ä¸­çš„ä»»æ„ä¸€ç§é€‰æ‹©å™¨
  - é€šè¿‡è¯¥é€‰æ‹©å™¨åªèƒ½é€‰ä¸­ç¬¬ä¸€ä¸ªå…ƒç´ ã€‚
- `document.querySelectorAll(â€œé€‰æ‹©å™¨â€);`
  - ä¸ `document.querySelector` åŒºåˆ«ï¼š`querySelectorAll` å¯ä»¥é€‰ä¸­æ‰€æœ‰ç¬¦åˆé€‰æ‹©å™¨è§„åˆ™çš„å…ƒç´ ï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªåˆ—è¡¨ã€‚`querySelector` è¿”å›çš„åªæ˜¯å•ç‹¬çš„ä¸€ä¸ªå…ƒç´ ã€‚

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Document</title>
</head>
<body>
  <ul>
    <li>
      <p>
        <span>ç¬¬ä¸€ä¸ª</span>
      </p>
    </li>
    <li>
      <span>ç¬¬äºŒä¸ª</span>
    </li>
  </ul>

<script type="text/javascript">
  document.querySelector("li span").style.color = "red";
  var obj = document.querySelectorAll("li span");
  for (var i = 0; i < obj.length; i++) {
    obj[i].innerText = i + '. ' + obj[i].innerText;
  }
</script>
</body>
</html>
```

### 2. ç±»åæ“ä½œ

- `Dom.classList.add(â€œç±»åâ€);`
  - ç»™å½“å‰domå…ƒç´ æ·»åŠ ç±»æ ·å¼ã€‚
- `Dom.classList.remove(â€œç±»åâ€);`
  - ç»™å½“å‰domå…ƒç´ ç§»é™¤ç±»æ ·å¼ã€‚
- `classList.contains(â€œç±»åâ€);`
  - æ£€æµ‹æ˜¯å¦åŒ…å«ç±»æ ·å¼ã€‚
- `classList.toggle(â€œactiveâ€);`
  - åˆ‡æ¢ç±»æ ·å¼ï¼ˆæœ‰å°±åˆ é™¤ï¼Œæ²¡æœ‰å°±æ·»åŠ ï¼‰ã€‚

### 3. è‡ªå®šä¹‰å±æ€§

HTML5è§„èŒƒï¼Œè‡ªå®šä¹‰å±æ€§åœ¨æ ‡ç­¾ä¸­çš„åç§°ä¸ºï¼šdata-è‡ªå®šä¹‰å±æ€§å

- `Dom.dataset.å±æ€§å` æˆ–è€… `Dom.dataset[å±æ€§å]`
  - è·å–è‡ªå®šä¹‰å±æ€§ `Dom.dataset` è¿”å›çš„æ˜¯ä¸€ä¸ªå¯¹è±¡
  - æ³¨æ„ï¼šæ­¤å¤„å±æ€§åä¸åŒ…å« `data-`
- `Dom.dataset.è‡ªå®šä¹‰å±æ€§å=å€¼` æˆ– `Dom.dataset[è‡ªå®šä¹‰å±æ€§å]=å€¼`
  - è®¾ç½®è‡ªå®šä¹‰å±æ€§

## äºŒ. æ–‡ä»¶è¯»å–

ä½¿ç”¨ HTML5 çš„ File æ¥å£éœ€è¦å…ˆæ–°å»ºæ–‡ä»¶è¯»å–å¯¹è±¡ï¼š

```js
var reader = new FileReader();
```

### 1. FileReader æ–¹æ³•

FileReader æœ‰ 3 ä¸ªç”¨æ¥è¯»å–æ–‡ä»¶çš„æ–¹æ³•ï¼š

- `.readAsText(file)` ã€€ã€€â€” å°†æ–‡ä»¶è¯»å–ä¸ºæ–‡æœ¬
- `.readAsDataURL(file)` ã€€ã€€â€” å°†æ–‡ä»¶è¯»å–ä¸ºDataURLï¼ˆäºŒè¿›åˆ¶æµå½¢å¼ï¼‰
-` .readAsBinaryString(file)` ã€€ã€€â€” å°†æ–‡ä»¶è¯»å–ä¸ºäºŒè¿›åˆ¶ç¼–ç 

### 2. FileReader äº‹ä»¶

- `.onload` ã€€ã€€â€” èµ„æºè¯»å–å®Œæ¯• reader.result
- `.onprogress` ã€€ã€€â€” è¯»å–è¿›åº¦æ›´æ–°æ—¶è§¦å‘
- `.onloadstart` ã€€ã€€â€” åŠ è½½å¼€å§‹æ—¶è§¦å‘
-` .onloadend` ã€€ã€€â€” åŠ è½½ç»“æŸæ—¶è§¦å‘
- `.onerror` ã€€ã€€â€” å‡ºç°é”™è¯¯æ—¶è§¦å‘
- `.onabort` ã€€ã€€â€” åŠ è½½è¿‡ç¨‹ä¸­ä¸­æ­¢æ—¶è§¦å‘
-` .abort` ã€€ã€€â€” æ‰‹åŠ¨ä¸­æ­¢åŠ è½½

### 3. ä»£ç å®ç°

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>æ–‡ä»¶è¯»å–</title>
</head>
<body>
  <input type="file" name="">
  
  <script type="text/javascript">
  var input_file = document.querySelector("input");

  input_file.onchange = function () {
    var files = this.files;
    var file = files[0];
    // åˆ›å»ºè¯»å–å™¨
    var reader = new FileReader();


    // å°†æ•°æ®è¯»å–æˆäºŒè¿›åˆ¶æ–¹å¼
    // reader.readAsBinaryString(file);
    // reader.onload=function(){
    //    console.log(reader.result);
    // }


    // å°†æ•°æ®è¯»å–æˆæ–‡æœ¬å½¢å¼
    // reader.readAsText(file);
    // reader.onload=function(){
    //     console.log(reader.result);
    //  }


    //å°†æ•°æ®è¯»å–æˆurlå½¢å¼
    reader.readAsDataURL(file);
    reader.onload = function () {
      console.log(reader.result);
    }
  }
</script>
</body>
</html>
```

### 4. å°æ¡ˆä¾‹

::: demo [vanilla]
```html
<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title>æ˜¾ç¤ºå›¾ç‰‡</title>
</head>

<body>
  <input class="demo-input" type="file">
  <script type="text/javascript">

    var file_btn = document.querySelector("demo-input");
    file_btn.onchange = function () {
      var file = this.files[0];
      
      // åˆ¤æ–­åç¼€åæ˜¯å¦åˆæ³•
      var filename = file.name.substring(file.name.lastIndexOf("."));
      var imgs = [".png", ".jpg", "gif", ".ico"];
      var flag = false;
      
      for (var i = 0; i < imgs.length; i++) {
        if (imgs[i] === filename) {
          flag = true;
          break;
        }
      }
  
      if (flag) {
        var reader = new FileReader();
        reader.readAsDataURL(file);
  
        reader.onload = function () {
          var img = document.createElement("img");
          img.src = reader.result;
            document.body.appendChild(img);
        }
      } else {
        alert("æ–‡ä»¶ç±»å‹ä¸æ­£ç¡®ï¼Œè¯·é‡æ–°é€‰æ‹©");
      }
    };
</script>
</body>
</html>
```
:::

## ä¸‰. è·å–ç½‘ç»œçŠ¶æ€

### 1. è·å–ç½‘ç»œçŠ¶æ€æ–¹æ³•

```js
// è·å–å½“å‰ç½‘ç»œçŠ¶æ€
var state = window.navigator.onLine;

if (state) {
  alert("æ‚¨å¥½ï¼Œå½“å‰å¤„äºè”ç½‘çŠ¶æ€");
} else {
  alert("å½“å‰å¤„äºæ–­ç½‘çŠ¶æ€");
}
```

### 2. ç½‘ç»œçŠ¶æ€äº‹ä»¶

```js
// å½“è”ç½‘çš„æ—¶å€™è§¦å‘è¯¥äº‹ä»¶
window.ononline = function () {
  alert("åœ¨çº¿");
}

// å½“æ–­ç½‘çš„æ—¶å€™è§¦å‘è¯¥äº‹ä»¶
window.onoffline = function () {
  alert("æ–­ç½‘");
}
```

## å››. è·å–åœ°ç†ä½ç½®

### 1. è·å–ä¸€æ¬¡å½“å‰ä½ç½®

```js
// åªèƒ½è·å–ä¸€æ¬¡å½“å‰åœ°ç†ä½ç½®ä¿¡æ¯
window.navigator.geolocation.getCurrentPosition(success, error);

function success (msg) {
  console.log(msg);
}

function error (msg) {
  console.log(msg);
}
```

### 2. å®æ—¶è·å–å½“å‰ä½ç½®

`window.navigator.geolocation.watchPosition(success,error);`

```js
// å®æ—¶è·å–åœ°ç†ä½ç½®:
window.navigator.geolocation.watchPosition(success, error);

function success (msg, position) {
  console.log(msg);
  console.dir(position);
}

function error (msg) {
  console.log(msg);
}
```

### 3. å°æ¡ˆä¾‹

:::demo [vanilla]
```html
<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title>ç™¾åº¦åœ°å›¾</title>
  <script type="text/javascript" src="http://api.map.baidu.com/api?v=2.0&ak=rFwb7Ow6y08zThgDXpGoovvtNIKkQIQO"></script>
</head>
<body>

<p>è¯·æ‰“å¼€å³ä¸‹è§’åœ¨çº¿è¿è¡ŒæŸ¥çœ‹æ¡ˆä¾‹è·å–åœ°å€æ•ˆæœã€‚</p>

<div id="allmap"></div>

<script type="text/javascript">
  window.navigator.geolocation.getCurrentPosition(suc, err);

  function suc (position) {
    var wd = position.coords.latitude;
    var jd = position.coords.longitude;

    // ç™¾åº¦åœ°å›¾APIåŠŸèƒ½
    var map = new BMap.Map("allmap");
    var point = new BMap.Point(jd, wd);
    map.centerAndZoom(point, 15);

    // åˆ›å»ºå°ç‹ç‹¸
    var pt = point;
    var myIcon = new BMap.Icon("http://lbsyun.baidu.com/jsdemo/img/fox.gif", new BMap.Size(300, 157));
    var marker2 = new BMap.Marker(pt, {icon: myIcon});  // åˆ›å»ºæ ‡æ³¨
    map.addOverlay(marker2);
  }

  function err (meg) {

  }
</script>
</body>
</html>
```
:::

## äº”. æœ¬åœ°å­˜å‚¨

ä¼ ç»Ÿæ–¹å¼æˆ‘ä»¬ä»¥ `document.cookie` æ¥è¿›è¡Œå­˜å‚¨ï¼Œä½†æ˜¯ç”±äºå…¶å­˜å‚¨å¤§å°åªæœ‰ 4k å·¦å³ï¼Œå¹¶ä¸”è§£æä¹Ÿç›¸å½“çš„å¤æ‚ï¼Œç»™å¼€å‘å¸¦æ¥è¯¸å¤šä¸ä¾¿ï¼ŒHTML5è§„èŒƒåˆ™æå‡ºè§£å†³æ–¹æ¡ˆï¼Œä½¿ç”¨ `sessionStorage` å’Œ `localStorage` å­˜å‚¨æ•°æ®ã€‚

### 1. localStorage

- localStorage ç‰¹ç‚¹ï¼š
  - æ°¸ä¹…ç”Ÿæ•ˆ
  - å¤šçª—å£å…±äº«
  - å®¹é‡å¤§çº¦ä¸º 20M
- ç”¨æ³•ï¼š
  - `window.localStorage.setItem(key,value)` ã€€ã€€â€” è®¾ç½®å­˜å‚¨å†…å®¹
  - `window.localStorage.getItem(key)` ã€€ã€€â€” è·å–å†…å®¹
  - `window.localStorage.removeItem(key)` ã€€ã€€â€” åˆ é™¤å†…å®¹
  - `window.localStorage.clear()` ã€€ã€€â€” æ¸…ç©ºå†…å®¹

### 2. sessionStorage

- sessionStorage ç‰¹ç‚¹ï¼š
  - ç”Ÿå‘½å‘¨æœŸä¸ºå…³é—­å½“å‰æµè§ˆå™¨çª—å£
  - å¯ä»¥åœ¨åŒä¸€ä¸ªçª—å£ä¸‹è®¿é—®
  - æ•°æ®å¤§å°ä¸º5Må·¦å³
- ç”¨æ³•ï¼š
  - `window.sessionStorage.setItem(key,value)` ã€€ã€€â€” è®¾ç½®å­˜å‚¨å†…å®¹
  - `window.sessionStorage.getItem(key)` ã€€ã€€â€” è·å–å†…å®¹
  - `window.sessionStorage.removeItem(key)` ã€€ã€€â€” åˆ é™¤å†…å®¹
  - `window.sessionStorage.clear()` ã€€ã€€â€” æ¸…ç©ºå†…å®¹

## å…­. æ“ä½œå¤šåª’ä½“

[å‚è€ƒæ‰‹å†Œ](https://www.w3school.com.cn/html5/html5_ref_audio_video_dom.asp)

## ä¸ƒ. Canvas ç”»å¸ƒ

å…ˆä¸æ•´ç†ï¼Œç”¨åˆ°çš„æ—¶å€™å†è¿›è¡Œå­¦ä¹ 
