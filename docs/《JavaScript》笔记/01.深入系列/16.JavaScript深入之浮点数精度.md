---
title: JavaScript æ·±å…¥ä¹‹æµ®ç‚¹æ•°ç²¾åº¦
date: 2021-10-15 18:38:40
permalink: /pages/c0f83e/
categories:
  - å‰ç«¯æŠ€æœ¯
tags:
  - Webå¼€å‘
  - JavaScript
  - æ·±å…¥ç³»åˆ—
author:
  name: Jamison
  link: https://github.com/oliver556
---

# JavaScript æ·±å…¥ä¹‹æµ®ç‚¹æ•°ç²¾åº¦

## ï¸ğŸ“–. å‰è¨€

0.1 + 0.2 æ˜¯å¦ç­‰äº 0.3 ä½œä¸ºä¸€é“ç»å…¸çš„é¢è¯•é¢˜ï¼Œå·²ç»å¹¿å¤–ç†ŸçŸ¥ï¼Œè¯´èµ·åŸå› ï¼Œå¤§å®¶èƒ½å›ç­”å‡ºè¿™æ˜¯æµ®ç‚¹æ•°ç²¾åº¦é—®é¢˜å¯¼è‡´ï¼Œä¹Ÿèƒ½è¾©è¯çš„çœ‹å¾…è¿™å¹¶éæ˜¯ ECMAScript è¿™é—¨è¯­è¨€çš„é—®é¢˜ï¼Œä»Šå¤©å°±æ˜¯å…·ä½“çœ‹ä¸€ä¸‹èƒŒåçš„åŸå› ã€‚

## ä¸€. æ•°å­—ç±»å‹

ECMAScript ä¸­çš„ Number ç±»å‹ä½¿ç”¨ IEEE754 æ ‡å‡†æ¥è¡¨ç¤ºæ•´æ•°å’Œæµ®ç‚¹æ•°å€¼ã€‚æ‰€è°“ IEEE754 æ ‡å‡†ï¼Œå…¨ç§° IEEE äºŒè¿›åˆ¶æµ®ç‚¹æ•°ç®—æœ¯æ ‡å‡†ï¼Œè¿™ä¸ªæ ‡å‡†å®šä¹‰äº†è¡¨ç¤ºæµ®ç‚¹æ•°çš„æ ¼å¼ç­‰å†…å®¹ã€‚

åœ¨ IEEE754 ä¸­ï¼Œè§„å®šäº†å››ç§è¡¨ç¤ºæµ®ç‚¹æ•°å€¼çš„æ–¹å¼ï¼šå•ç²¾ç¡®åº¦ï¼ˆ32ä½ï¼‰ã€åŒç²¾ç¡®åº¦ï¼ˆ64ä½ï¼‰ã€å»¶ä¼¸å•ç²¾ç¡®åº¦ã€ä¸å»¶ä¼¸åŒç²¾ç¡®åº¦ã€‚åƒ ECMAScript é‡‡ç”¨çš„å°±æ˜¯åŒç²¾ç¡®åº¦ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¼šç”¨ 64 ä½æ¥å‚¨å­˜ä¸€ä¸ªæµ®ç‚¹æ•°ã€‚

## äºŒ. æµ®ç‚¹æ•°è½¬äºŒè¿›åˆ¶

æˆ‘ä»¬æ¥çœ‹ä¸‹ 1020 ç”¨åè¿›åˆ¶çš„è¡¨ç¤ºï¼š

> 1020 = 1 * 10^3 + 0 * 10^2 + 2 * 10^1 + 0 * 10^0

æ‰€ä»¥ 1020 ç”¨åè¿›åˆ¶è¡¨ç¤ºå°±æ˜¯ 1020â€¦â€¦(å“ˆå“ˆ)

å¦‚æœ 1020 ç”¨äºŒè¿›åˆ¶æ¥è¡¨ç¤ºå‘¢ï¼Ÿ

> 1020 = 1 * 2^9 + 1 * 2^8 + 1 * 2^7 + 1 * 2^6 + 1 * 2^5 + 1 * 2^4 + 1 * 2^3 + 1 * 2^2 + 0 * 2^1 + 0 * 2^0

æ‰€ä»¥ 1020 çš„äºŒè¿›åˆ¶ä¸º `1111111100`

é‚£å¦‚æœæ˜¯ 0.75 ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºå‘¢ï¼ŸåŒç†åº”è¯¥æ˜¯ï¼š

> 0.75 = a * 2^-1 + b * 2^-2 + c * 2^-3 + d * 2^-4 + ...

å› ä¸ºä½¿ç”¨çš„æ˜¯äºŒè¿›åˆ¶ï¼Œè¿™é‡Œçš„ abcdâ€¦â€¦çš„å€¼çš„è¦ä¹ˆæ˜¯ 0 è¦ä¹ˆæ˜¯ 1ã€‚

é‚£æ€ä¹ˆç®—å‡º abcdâ€¦â€¦ çš„å€¼å‘¢ï¼Œæˆ‘ä»¬å¯ä»¥ä¸¤è¾¹ä¸åœçš„ä¹˜ä»¥ 2 ç®—å‡ºæ¥ï¼Œè§£æ³•å¦‚ä¸‹ï¼š

> 0.75 = a * 2^-1 + b * 2^-2 + c * 2^-3 + d * 2^-4...

ä¸¤è¾¹åŒæ—¶ä¹˜ä»¥ 2

> 1 + 0.5 = a * 2^0 + b * 2^-1 + c * 2^-2 + d * 2^-3... (æ‰€ä»¥ a = 1)

å‰©ä¸‹çš„ï¼š

> 0.5 = b * 2^-1 + c * 2^-2 + d * 2^-3...

å†åŒæ—¶ä¹˜ä»¥ 2

> 1 + 0 = b * 2^0 + c * 2^-2 + d * 2^-3... (æ‰€ä»¥ b = 1)

æ‰€ä»¥ 0.75 ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºå°±æ˜¯ 0.abï¼Œä¹Ÿå°±æ˜¯ 0.11

ç„¶è€Œä¸æ˜¯æ‰€æœ‰çš„æ•°éƒ½åƒ 0.75 è¿™ä¹ˆå¥½ç®—ï¼Œæˆ‘ä»¬æ¥ç®—ä¸‹ 0.1ï¼š

```
0.1 = a * 2^-1 + b * 2^-2 + c * 2^-3 + d * 2^-4 + ...

0 + 0.2 = a * 2^0 + b * 2^-1 + c * 2^-2 + ...   (a = 0)
0 + 0.4 = b * 2^0 + c * 2^-1 + d * 2^-2 + ...   (b = 0)
0 + 0.8 = c * 2^0 + d * 2^-1 + e * 2^-2 + ...   (c = 0)
1 + 0.6 = d * 2^0 + e * 2^-1 + f * 2^-2 + ...   (d = 1)
1 + 0.2 = e * 2^0 + f * 2^-1 + g * 2^-2 + ...   (e = 1)
0 + 0.4 = f * 2^0 + g * 2^-1 + h * 2^-2 + ...   (f = 0)
0 + 0.8 = g * 2^0 + h * 2^-1 + i * 2^-2 + ...   (g = 0)
1 + 0.6 = h * 2^0 + i * 2^-1 + j * 2^-2 + ...   (h = 1)
....
```

ç„¶åä½ å°±ä¼šå‘ç°ï¼Œè¿™ä¸ªè®¡ç®—åœ¨ä¸åœçš„å¾ªç¯ï¼Œæ‰€ä»¥ 0.1 ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºå°±æ˜¯ 0.00011001100110011â€¦â€¦

## ä¸‰. æµ®ç‚¹æ•°çš„å­˜å‚¨

è™½ç„¶ 0.1 è½¬æˆäºŒè¿›åˆ¶æ—¶æ˜¯ä¸€ä¸ªæ— é™å¾ªç¯çš„æ•°ï¼Œä½†è®¡ç®—æœºæ€»è¦å‚¨å­˜å§ï¼Œæˆ‘ä»¬çŸ¥é“ ECMAScript ä½¿ç”¨ 64 ä½æ¥å‚¨å­˜ä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œé‚£å…·ä½“æ˜¯æ€ä¹ˆå‚¨å­˜çš„å‘¢ï¼Ÿè¿™å°±è¦è¯´å› IEEE754 è¿™ä¸ªæ ‡å‡†äº†ï¼Œæ¯•ç«Ÿæ˜¯è¿™ä¸ªæ ‡å‡†è§„å®šäº†å­˜å‚¨çš„æ–¹å¼ã€‚

è¿™ä¸ªæ ‡å‡†è®¤ä¸ºï¼Œä¸€ä¸ªæµ®ç‚¹æ•° (Value) å¯ä»¥è¿™æ ·è¡¨ç¤ºï¼š

> Value = sign * exponent * fraction

çœ‹èµ·æ¥å¾ˆæŠ½è±¡çš„æ ·å­ï¼Œç®€å•ç†è§£å°±æ˜¯ç§‘å­¦è®¡æ•°æ³•â€¦â€¦

æ¯”å¦‚ -1020ï¼Œç”¨ç§‘å­¦è®¡æ•°æ³•è¡¨ç¤ºå°±æ˜¯:

> -1 * 10^3 * 1.02

sign å°±æ˜¯ -1ï¼Œexponent å°±æ˜¯ 10^3ï¼Œfraction å°±æ˜¯ 1.02

å¯¹äºäºŒè¿›åˆ¶ä¹Ÿæ˜¯ä¸€æ ·ï¼Œä»¥ 0.1 çš„äºŒè¿›åˆ¶ 0.00011001100110011â€¦â€¦ è¿™ä¸ªæ•°æ¥è¯´ï¼š

å¯ä»¥è¡¨ç¤ºä¸ºï¼š

> 1 * 2^-4 * 1.1001100110011â€¦â€¦

å…¶ä¸­ sign å°±æ˜¯ 1ï¼Œexponent å°±æ˜¯ 2^-4ï¼Œfraction å°±æ˜¯ 1.1001100110011â€¦â€¦

è€Œå½“åªåšäºŒè¿›åˆ¶ç§‘å­¦è®¡æ•°æ³•çš„è¡¨ç¤ºæ—¶ï¼Œè¿™ä¸ª Value çš„è¡¨ç¤ºå¯ä»¥å†å…·ä½“ä¸€ç‚¹å˜æˆï¼š

> V = (-1)^S * (1 + Fraction) * 2^E

(å¦‚æœæ‰€æœ‰çš„æµ®ç‚¹æ•°éƒ½å¯ä»¥è¿™æ ·è¡¨ç¤ºï¼Œé‚£ä¹ˆæˆ‘ä»¬å­˜å‚¨çš„æ—¶å€™å°±æŠŠè¿™å…¶ä¸­ä¼šå˜åŒ–çš„ä¸€äº›å€¼å­˜å‚¨èµ·æ¥å°±å¥½äº†)

æˆ‘ä»¬æ¥ä¸€ç‚¹ç‚¹çœ‹ï¼š

`(-1)^S` è¡¨ç¤ºç¬¦å·ä½ï¼Œå½“ S = 0ï¼ŒV ä¸ºæ­£æ•°ï¼›å½“ S = 1ï¼ŒV ä¸ºè´Ÿæ•°ã€‚

å†çœ‹ `(1 + Fraction)`ï¼Œè¿™æ˜¯å› ä¸ºæ‰€æœ‰çš„æµ®ç‚¹æ•°éƒ½å¯ä»¥è¡¨ç¤ºä¸º 1.xxxx * 2^xxx çš„å½¢å¼ï¼Œå‰é¢çš„ä¸€å®šæ˜¯ 1.xxxï¼Œé‚£å¹²è„†æˆ‘ä»¬å°±ä¸å­˜å‚¨è¿™ä¸ª 1 äº†ï¼Œç›´æ¥å­˜åé¢çš„ xxxxx å¥½äº†ï¼Œè¿™ä¹Ÿå°±æ˜¯ Fraction çš„éƒ¨åˆ†ã€‚

æœ€åå†çœ‹ `2^E`

å¦‚æœæ˜¯ 1020.75ï¼Œå¯¹åº”äºŒè¿›åˆ¶æ•°å°±æ˜¯ 1111111100.11ï¼Œå¯¹åº”äºŒè¿›åˆ¶ç§‘å­¦è®¡æ•°æ³•å°±æ˜¯ 1 * 1.11111110011 * 2^9ï¼ŒE çš„å€¼å°±æ˜¯ 9ï¼Œè€Œå¦‚æœæ˜¯ 0.1 ï¼Œå¯¹åº”äºŒè¿›åˆ¶æ˜¯ 1 * 1.1001100110011â€¦â€¦ * 2^-4ï¼Œ E çš„å€¼å°±æ˜¯ -4ï¼Œ
ä¹Ÿå°±æ˜¯è¯´ï¼ŒE æ—¢å¯èƒ½æ˜¯è´Ÿæ•°ï¼Œåˆå¯èƒ½æ˜¯æ­£æ•°ï¼Œé‚£é—®é¢˜å°±æ¥äº†ï¼Œé‚£æˆ‘ä»¬è¯¥æ€ä¹ˆå‚¨å­˜è¿™ä¸ª E å‘¢ï¼Ÿ

æˆ‘ä»¬è¿™æ ·è§£å†³ï¼Œå‡å¦‚æˆ‘ä»¬ç”¨ 8 ä½æ¥å­˜å‚¨ E è¿™ä¸ªæ•°ï¼Œå¦‚æœåªæœ‰æ­£æ•°çš„è¯ï¼Œå‚¨å­˜çš„å€¼çš„èŒƒå›´æ˜¯ 0 ~ 254ï¼Œè€Œå¦‚æœè¦å‚¨å­˜æ­£è´Ÿæ•°çš„è¯ï¼Œå€¼çš„èŒƒå›´å°±æ˜¯ -127~127ï¼Œæˆ‘ä»¬åœ¨å­˜å‚¨çš„æ—¶å€™ï¼ŒæŠŠè¦å­˜å‚¨çš„æ•°å­—åŠ ä¸Š 127ï¼Œè¿™æ ·å½“æˆ‘ä»¬å­˜ -127 çš„æ—¶å€™ï¼Œ
æˆ‘ä»¬å­˜ 0ï¼Œå½“å­˜ 127 çš„æ—¶å€™ï¼Œå­˜ 254ï¼Œè¿™æ ·å°±è§£å†³äº†å­˜è´Ÿæ•°çš„é—®é¢˜ã€‚å¯¹åº”çš„ï¼Œå½“å–å€¼çš„æ—¶å€™ï¼Œæˆ‘ä»¬å†å‡å» 127ã€‚

æ‰€ä»¥å‘¢ï¼ŒçœŸåˆ°å®é™…å­˜å‚¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¹¶ä¸ä¼šç›´æ¥å­˜å‚¨ Eï¼Œè€Œæ˜¯ä¼šå­˜å‚¨ E + biasï¼Œå½“ç”¨ 8 ä½çš„æ—¶å€™ï¼Œè¿™ä¸ª bias å°±æ˜¯ 127ã€‚

æ‰€ä»¥ï¼Œå¦‚æœè¦å­˜å‚¨ä¸€ä¸ªæµ®ç‚¹æ•°ï¼Œæˆ‘ä»¬å­˜ S å’Œ Fraction å’Œ E + bias è¿™ä¸‰ä¸ªå€¼å°±å¥½äº†ï¼Œé‚£å…·ä½“è¦åˆ†é…å¤šå°‘ä¸ªä½æ¥å­˜å‚¨è¿™äº›æ•°å‘¢ï¼ŸIEEE754 ç»™å‡ºäº†æ ‡å‡†ï¼š

![javascript_03-13_01](https://fastly.jsdelivr.net/gh/oliver556/image-hosting@master/20220313/javascript_03-13_01.41nww54z1rs0.jpg)

åœ¨è¿™ä¸ªæ ‡å‡†ä¸‹ï¼š

æˆ‘ä»¬ä¼šç”¨ 1 ä½å­˜å‚¨ Sï¼Œ0 è¡¨ç¤ºæ­£æ•°ï¼Œ1 è¡¨ç¤ºè´Ÿæ•°ã€‚

ç”¨ 11 ä½å­˜å‚¨ E + biasï¼Œå¯¹äº 11 ä½æ¥è¯´ï¼Œbias çš„å€¼æ˜¯ 2^(11-1) - 1ï¼Œä¹Ÿå°±æ˜¯ 1023ã€‚

ç”¨ 52 ä½å­˜å‚¨ Fractionã€‚

ä¸¾ä¸ªä¾‹å­ï¼Œå°±æ‹¿ 0.1 æ¥çœ‹ï¼Œå¯¹åº”äºŒè¿›åˆ¶æ˜¯ 1 * 1.1001100110011â€¦â€¦ * 2^-4ï¼Œ Sign æ˜¯ 0ï¼ŒE + bias æ˜¯ -4 + 1023 = 1019ï¼Œ1019 ç”¨äºŒè¿›åˆ¶è¡¨ç¤ºæ˜¯ 1111111011ï¼ŒFraction æ˜¯ 1001100110011â€¦â€¦

å¯¹åº” 64 ä½çš„å®Œæ•´è¡¨ç¤ºå°±æ˜¯ï¼š

> 0 01111111011 1001100110011001100110011001100110011001100110011010

åŒç†, 0.2 è¡¨ç¤ºçš„å®Œæ•´è¡¨ç¤ºæ˜¯ï¼š

> 0 01111111100 1001100110011001100110011001100110011001100110011010

æ‰€ä»¥å½“ 0.1 å­˜ä¸‹æ¥çš„æ—¶å€™ï¼Œå°±å·²ç»å‘ç”Ÿäº†ç²¾åº¦ä¸¢å¤±ï¼Œå½“æˆ‘ä»¬ç”¨æµ®ç‚¹æ•°è¿›è¡Œè¿ç®—çš„æ—¶å€™ï¼Œä½¿ç”¨çš„å…¶å®æ˜¯ç²¾åº¦ä¸¢å¤±åçš„æ•°ã€‚

## å››. æµ®ç‚¹æ•°çš„è¿ç®—

å…³äºæµ®ç‚¹æ•°çš„è¿ç®—ï¼Œä¸€èˆ¬ç”±ä»¥ä¸‹äº”ä¸ªæ­¥éª¤å®Œæˆï¼šå¯¹é˜¶ã€å°¾æ•°è¿ç®—ã€è§„æ ¼åŒ–ã€èˆå…¥å¤„ç†ã€æº¢å‡ºåˆ¤æ–­ã€‚æˆ‘ä»¬æ¥ç®€å•çœ‹ä¸€ä¸‹ 0.1 å’Œ 0.2 çš„è®¡ç®—ã€‚

é¦–å…ˆæ˜¯å¯¹é˜¶ï¼Œæ‰€è°“å¯¹é˜¶ï¼Œå°±æ˜¯æŠŠé˜¶ç è°ƒæ•´ä¸ºç›¸åŒï¼Œæ¯”å¦‚ 0.1 æ˜¯ `1.1001100110011â€¦â€¦ * 2^-4`ï¼Œé˜¶ç æ˜¯ -4ï¼Œè€Œ 0.2 å°±æ˜¯ `1.10011001100110...* 2^-3`ï¼Œé˜¶ç æ˜¯ -3ï¼Œä¸¤ä¸ªé˜¶ç ä¸åŒï¼Œæ‰€ä»¥å…ˆè°ƒæ•´ä¸ºç›¸åŒçš„é˜¶ç å†è¿›è¡Œè®¡ç®—ï¼Œ
è°ƒæ•´åŸåˆ™æ˜¯å°é˜¶å¯¹å¤§é˜¶ï¼Œä¹Ÿå°±æ˜¯ 0.1 çš„ -4 è°ƒæ•´ä¸º -3ï¼Œå¯¹åº”å˜æˆ `0.11001100110011â€¦â€¦ * 2^-3`

æ¥ä¸‹æ¥æ˜¯å°¾æ•°è®¡ç®—:

```
  0.1100110011001100110011001100110011001100110011001101
+ 1.1001100110011001100110011001100110011001100110011010
â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
 10.0110011001100110011001100110011001100110011001100111
```

æˆ‘ä»¬å¾—åˆ°ç»“æœä¸º `10.0110011001100110011001100110011001100110011001100111 * 2^-3`

å°†è¿™ä¸ªç»“æœå¤„ç†ä¸€ä¸‹ï¼Œå³ç»“æœè§„æ ¼åŒ–ï¼Œå˜æˆ `1.0011001100110011001100110011001100110011001100110011(1) * 2^-2`

æ‹¬å·é‡Œçš„ 1 æ„æ€æ˜¯è¯´è®¡ç®—åè¿™ä¸ª 1 è¶…å‡ºäº†èŒƒå›´ï¼Œæ‰€ä»¥è¦è¢«èˆå¼ƒäº†ã€‚

å†ç„¶åæ˜¯èˆå…¥ï¼Œå››èˆäº”å…¥å¯¹åº”åˆ°äºŒè¿›åˆ¶ä¸­ï¼Œå°±æ˜¯ 0 èˆ 1 å…¥ï¼Œå› ä¸ºæˆ‘ä»¬è¦æŠŠæ‹¬å·é‡Œçš„ 1 ä¸¢äº†ï¼Œæ‰€ä»¥è¿™é‡Œä¼šè¿›ä¸€ï¼Œç»“æœå˜æˆ

`1.0011001100110011001100110011001100110011001100110100 * 2^-2`

æœ¬æ¥è¿˜æœ‰ä¸€ä¸ªæº¢å‡ºåˆ¤æ–­ï¼Œå› ä¸ºè¿™é‡Œä¸æ¶‰åŠï¼Œå°±ä¸è®²äº†ã€‚

æ‰€ä»¥æœ€ç»ˆçš„ç»“æœå­˜æˆ 64 ä½å°±æ˜¯

> 0 01111111101 0011001100110011001100110011001100110011001100110100

å°†å®ƒè½¬æ¢ä¸º10è¿›åˆ¶æ•°å°±å¾—åˆ° `0.30000000000000004440892098500626`

å› ä¸ºä¸¤æ¬¡å­˜å‚¨æ—¶çš„ç²¾åº¦ä¸¢å¤±åŠ ä¸Šä¸€æ¬¡è¿ç®—æ—¶çš„ç²¾åº¦ä¸¢å¤±ï¼Œæœ€ç»ˆå¯¼è‡´äº† 0.1 + 0.2 !== 0.3

## äº”. å…¶ä»–

```
// åè¿›åˆ¶è½¬äºŒè¿›åˆ¶
parseFloat(0.1).toString(2);
=> "0.0001100110011001100110011001100110011001100110011001101"

// äºŒè¿›åˆ¶è½¬åè¿›åˆ¶
parseInt(1100100,2)
=> 100

// ä»¥æŒ‡å®šçš„ç²¾åº¦è¿”å›è¯¥æ•°å€¼å¯¹è±¡çš„å­—ç¬¦ä¸²è¡¨ç¤º
(0.1 + 0.2).toPrecision(21)
=> "0.300000000000000044409"
(0.3).toPrecision(21)
=> "0.299999999999999988898"
```

## ğŸŒŸ. å‚è€ƒ

1. [why is 0.1+0.2 not equal to 0.3 in most programming languages](https://medium.com/better-programming/why-is-0-1-0-2-not-equal-to-0-3-in-most-programming-languages-99432310d476)
2. [IEEE-754æ ‡å‡†ä¸æµ®ç‚¹æ•°è¿ç®—](https://blog.csdn.net/m0_37972557/article/details/84594879)

