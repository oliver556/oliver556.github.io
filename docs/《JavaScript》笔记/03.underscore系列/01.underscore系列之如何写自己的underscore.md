---
title: underscore ç³»åˆ—ä¹‹å¦‚ä½•å†™è‡ªå·±çš„ underscore
date: 2021-11-10 10:56:11
permalink: /pages/5a58ac/
categories:
  - å‰ç«¯æŠ€æœ¯
tags:
  - Webå¼€å‘
  - JavaScript
  - underscoreç³»åˆ—
author:
  name: Jamison
  link: https://github.com/oliver556
---

# underscore ç³»åˆ—ä¹‹å¦‚ä½•å†™è‡ªå·±çš„ underscore

## ğŸ“–. å‰è¨€

åœ¨ ã€ŠJavaScript ä¸“é¢˜ç³»åˆ—ã€‹ä¸­ï¼Œæˆ‘ä»¬å†™äº†å¾ˆå¤šçš„åŠŸèƒ½å‡½æ•°ï¼Œæ¯”å¦‚é˜²æŠ–ã€èŠ‚æµã€å»é‡ã€ç±»å‹åˆ¤æ–­ã€æ‰å¹³æ•°ç»„ã€æ·±æµ…æ‹·è´ã€æŸ¥æ‰¾æ•°ç»„å…ƒç´ ã€é€šç”¨éå†ã€æŸ¯é‡ŒåŒ–ã€å‡½æ•°ç»„åˆã€å‡½æ•°è®°å¿†ã€ä¹±åºç­‰ï¼Œå¯æˆ‘ä»¬è¯¥å¦‚ä½•å»ç»„ç»‡è¿™äº›å‡½æ•°ï¼Œ
å½¢æˆè‡ªè‡ªå·±çš„ä¸€ä¸ªå·¥å…·å‡½æ•°åº“å‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬å°±è¦å€Ÿé‰´ underscore æ˜¯æ€ä¹ˆåšçš„äº†ã€‚

## ä¸€. è‡ªå·±å®ç°

å¦‚æœæ˜¯æˆ‘ä»¬è‡ªå·±å»ç»„ç»‡è¿™äº›å‡½æ•°ï¼Œæˆ‘ä»¬è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿæˆ‘æƒ³æˆ‘ä¼šè¿™æ ·åšï¼š

```js
(function(){
  var root = this;
  var _ = {};
  root._ = _;
  
  // åœ¨è¿™é‡Œæ·»åŠ è‡ªå·±çš„æ–¹æ³•
  _.reverse = function(string) {
    return string.split('').reverse().join('');
  }
})()

_.reverse('hello');
=> 'olleh'
```

æˆ‘ä»¬å°†æ‰€æœ‰çš„æ–¹æ³•æ·»åŠ åˆ°ä¸€ä¸ªåä¸º `_` çš„å¯¹è±¡ä¸Šï¼Œç„¶åå°†è¯¥å¯¹è±¡æŒ‚è½½åˆ°å…¨å±€å¯¹è±¡ä¸Šã€‚

ä¹‹æ‰€ä»¥ä¸ç›´æ¥ `window._ = _` æ˜¯å› ä¸ºæˆ‘ä»¬å†™çš„æ˜¯ä¸€ä¸ªå·¥å…·å‡½æ•°åº“ï¼Œä¸ä»…è¦æ±‚å¯ä»¥åœ¨æµè§ˆå™¨ç«¯ï¼Œè¿˜å¯ä»¥è¿è¡Œåœ¨è¯¸å¦‚ Node ç­‰ç¯å¢ƒä¸­ã€‚

## äºŒ. root

ç„¶è€Œ underscore å¯ä¸ä¼šå†™å¾—å¦‚æ­¤ç®€å•ï¼Œæˆ‘ä»¬ä» `var root = this` å¼€å§‹è¯´èµ·ã€‚

ä¹‹æ‰€ä»¥å†™è¿™ä¸€å¥ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬è¦é€šè¿‡ this è·å¾—å…¨å±€å¯¹è±¡ï¼Œç„¶åå°† `_` å¯¹è±¡ï¼ŒæŒ‚è½½ä¸Šå»ã€‚

ç„¶è€Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œthis è¿”å› undefinedï¼Œè€Œä¸æ˜¯æŒ‡å‘ Windowï¼Œå¹¸è¿çš„æ˜¯ underscore å¹¶æ²¡æœ‰é‡‡ç”¨ä¸¥æ ¼æ¨¡å¼ï¼Œå¯æ˜¯å³ä¾¿å¦‚æ­¤ï¼Œä¹Ÿä¸èƒ½é¿å…ï¼Œå› ä¸ºåœ¨ ES6 ä¸­æ¨¡å—è„šæœ¬è‡ªåŠ¨é‡‡ç”¨ä¸¥æ ¼æ¨¡å¼ï¼Œä¸ç®¡æœ‰æ²¡æœ‰å£°æ˜ `use strict`ã€‚

å¦‚æœ this è¿”å› undefinedï¼Œä»£ç å°±ä¼šæŠ¥é”™ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„æ€è·¯æ˜¯å¯¹ç¯å¢ƒè¿›è¡Œæ£€æµ‹ï¼Œç„¶åæŒ‚è½½åˆ°æ­£ç¡®çš„å¯¹è±¡ä¸Šã€‚æˆ‘ä»¬ä¿®æ”¹ä¸€ä¸‹ä»£ç ï¼š

```js
var root = (typeof window === 'object' && window.window === window && window) ||
          (typeof global === 'object' && global.global === global && global);
```

åœ¨è¿™æ®µä»£ç ä¸­ï¼Œæˆ‘ä»¬åˆ¤æ–­äº†æµè§ˆå™¨å’Œ Node ç¯å¢ƒï¼Œå¯æ˜¯åªæœ‰è¿™ä¸¤ä¸ªç¯å¢ƒå—ï¼Ÿé‚£æˆ‘ä»¬æ¥çœ‹çœ‹ Web Workerã€‚

## ä¸‰. Web Worker

Web Worker å±äº HTML5 ä¸­çš„å†…å®¹ï¼Œå¼•ç”¨ã€ŠJavaScriptæƒå¨æŒ‡å—ã€‹ä¸­çš„è¯å°±æ˜¯ï¼š

> åœ¨ Web Worker æ ‡å‡†ä¸­ï¼Œå®šä¹‰äº†è§£å†³å®¢æˆ·ç«¯ JavaScript æ— æ³•å¤šçº¿ç¨‹çš„é—®é¢˜ã€‚å…¶ä¸­å®šä¹‰çš„ â€œworkerâ€ æ˜¯æŒ‡æ‰§è¡Œä»£ç çš„å¹¶è¡Œè¿‡ç¨‹ã€‚ä¸è¿‡ï¼ŒWeb Worker å¤„åœ¨ä¸€ä¸ªè‡ªåŒ…å«çš„æ‰§è¡Œç¯å¢ƒä¸­ï¼Œæ— æ³•è®¿é—® Window å¯¹è±¡å’Œ Document å¯¹è±¡ï¼Œ
 å’Œä¸»çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ä¸šåªèƒ½é€šè¿‡å¼‚æ­¥æ¶ˆæ¯ä¼ é€’æœºåˆ¶æ¥å®ç°ã€‚

åœ¨ Web Worker ä¸­ï¼Œæ˜¯æ— æ³•è®¿é—® Window å¯¹è±¡çš„ï¼Œæ‰€ä»¥ `typeof window` å’Œ `typeof global` çš„ç»“æœéƒ½æ˜¯ `undefined`ï¼Œæ‰€ä»¥æœ€ç»ˆ root çš„å€¼ä¸º falseï¼Œå°†ä¸€ä¸ªåŸºæœ¬ç±»å‹çš„å€¼åƒå¯¹è±¡ä¸€æ ·æ·»åŠ å±æ€§å’Œæ–¹æ³•ï¼Œè‡ªç„¶æ˜¯ä¼šæŠ¥é”™çš„ã€‚

é‚£ä¹ˆæˆ‘ä»¬è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ

è™½ç„¶åœ¨ Web Worker ä¸­ä¸èƒ½è®¿é—®åˆ° Window å¯¹è±¡ï¼Œä½†æ˜¯æˆ‘ä»¬å´èƒ½é€šè¿‡ self è®¿é—®åˆ° Worker ç¯å¢ƒä¸­çš„å…¨å±€å¯¹è±¡ã€‚æˆ‘ä»¬åªæ˜¯è¦æ‰¾å…¨å±€å˜é‡æŒ‚è½½è€Œå·²ï¼Œæ‰€ä»¥å®Œå…¨å¯ä»¥æŒ‚åˆ° self ä¸­å˜›ã€‚

è€Œä¸”åœ¨æµè§ˆå™¨ä¸­ï¼Œé™¤äº† window å±æ€§ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ self å±æ€§ç›´æ¥è®¿é—®åˆ° Window å¯¹è±¡ã€‚

```js
console.log(window.window === window); // true
console.log(window.self === window); // true
```

è€ƒè™‘åˆ°ä½¿ç”¨ self è¿˜å¯ä»¥é¢å¤–æ”¯æŒ Web Workerï¼Œæˆ‘ä»¬ç›´æ¥å°†ä»£ç æ”¹æˆ selfï¼š

```js
var root = (typeof self == 'object' && self.self == self && self) ||
           (typeof global == 'object' && global.global == global && global);
```

## å››. node vm

åˆ°äº†è¿™é‡Œï¼Œä¾ç„¶æ²¡å®Œï¼Œè®©ä½ æƒ³ä¸åˆ°çš„æ˜¯ï¼Œåœ¨ node çš„ vm æ¨¡å—ä¸­ï¼Œä¹Ÿå°±æ˜¯æ²™ç›’æ¨¡å—ï¼ŒrunlnContext æ–¹æ³•ä¸­ï¼Œæ˜¯ä¸å­˜åœ¨ windowï¼Œä¹Ÿä¸å­˜åœ¨ global å˜é‡çš„ã€‚

ä½†æ˜¯æˆ‘ä»¬å´å¯ä»¥é€šè¿‡ this è®¿é—®åˆ°å…¨å±€å¯¹è±¡ï¼Œæ‰€ä»¥å°±æœ‰äººå‘èµ·äº†ä¸€ä¸ª PRï¼Œä»£ç æ”¹æˆäº†ï¼š

```js
var root = (typeof self == 'object' && self.self == self && self) ||
           (typeof global == 'object' && global.global == global && global) ||
           this;
```

## äº”. å¾®ä¿¡å°ç¨‹åº

åˆ°äº†è¿™é‡Œï¼Œè¿˜æ˜¯æ´—å®Œï¼Œè½®åˆ°å¾®ä¿¡å°ç¨‹åºç™»åœºäº†ã€‚

å› ä¸ºåœ¨å¾®ä¿¡å°ç¨‹åºä¸­ï¼Œwindow å’Œ global éƒ½æ˜¯ undefinedï¼ŒåŠ ä¸Šåˆå¼ºåˆ¶ä½¿ç”¨ä¸¥æ ¼æ¨¡å¼ï¼Œthis ä¸º undefinedï¼ŒæŒ‚è½½å°±ä¼šå‘ç”Ÿé”™è¯¯ï¼Œæ‰€ä»¥å°±åˆæœ‰äººå‘äº†ä¸€ä¸ª PRï¼Œä»£ç å˜æˆäº†ï¼š

```js
var root = (typeof self == 'object' && self.self == self && self) ||
           (typeof global == 'object' && global.global == global && global) ||
           this ||
           {};
```

è¿™å°±æ˜¯ç°åœ¨ v1.8.3 çš„æ ·å­ã€‚

è™½ç„¶ä½œè€…å¯ä»¥ç›´æ¥è®²è§£æœ€ç»ˆçš„ä»£ç ï¼Œä½†æ˜¯ä½œè€…æ›´å¸Œæœ›å¤§å®¶çœ‹çœ‹è¿™çœ‹ä¼¼æ™®é€šçš„ä»£ç æ˜¯å¦‚ä½•ä¸€æ­¥æ­¥æ¼”å˜æˆè¿™æ ·çš„ï¼Œä¹Ÿå¸Œæœ›å‘Šè¯‰å¤§å®¶ï¼Œä»£ç çš„å¥å£®æ€§ï¼Œå¹¶éä¸€è¹´è€Œå°±ï¼Œè€Œæ˜¯æ±‡é›†äº†å¾ˆå¤šäººçš„ç»éªŒï¼Œè€ƒè™‘åˆ°äº†å¾ˆå¤šæˆ‘ä»¬æ„æƒ³ä¸åˆ°çš„åœ°æ–¹ï¼Œ
è¿™ä¹Ÿå°±æ˜¯å¼€æºé¡¹ç›®çš„å¥½å¤„å§ã€‚

## å…­. å‡½æ•°å¯¹è±¡

ç°åœ¨æˆ‘ä»¬è®²ç¬¬äºŒå¥ `var _ = {};`ã€‚

å¦‚æœä»…ä»…è®¾ç½® _ ä¸ºä¸€ä¸ªç©ºå¯¹è±¡ï¼Œæˆ‘ä»¬è°ƒç”¨æ–¹æ³•çš„æ—¶å€™ï¼Œåªèƒ½ä½¿ç”¨ `_.reverse('hello')` çš„æ–¹å¼ï¼Œå®é™…ä¸Šï¼Œunderscore ä¹Ÿæ”¯æŒç±»ä¼¼é¢å‘å¯¹è±¡çš„æ–¹å¼è°ƒç”¨ï¼Œå³ï¼š

```js
_('hello').reverse(); // 'olleh'
```

å†ä¸¾ä¸ªä¾‹å­æ¯”è¾ƒä¸‹ä¸¤ç§è°ƒç”¨æ–¹å¼ï¼š

```js
// å‡½æ•°å¼é£æ ¼
_.each([1, 2, 3], function(item){
  console.log(item);
});

// é¢å‘å¯¹è±¡é£æ ¼
_([1, 2, 3]).each(function(item){
  console.log(item);
});
```

å¯æ˜¯è¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿ

æ—¢ç„¶ä»¥ `_([1, 2, 3])` çš„å½¢å¼å¯ä»¥æ‰§è¡Œï¼Œå°±è¡¨æ˜ `_` ä¸æ˜¯ä¸€ä¸ªå­—é¢é‡å¯¹è±¡ï¼Œè€Œæ˜¯ä¸€ä¸ªå‡½æ•°ï¼

å¹¸è¿çš„æ˜¯ï¼Œåœ¨ JavaScript ä¸­ï¼Œå‡½æ•°ä¹Ÿæ˜¯ä¸€ç§å¯¹è±¡ï¼Œæˆ‘ä»¬ä¸¾ä¸ªä¾‹å­ï¼š

```js
var  _ = function() {};
_.value = 1;
_.log = function() { return this.value + 1 };

console.log(_.value); // 1
console.log(_log()); // 2
```

æˆ‘ä»¬å®Œå…¨å¯ä»¥å°†è‡ªå®šä¹‰çš„å‡½æ•°å®šä¹‰åœ¨ `_` å‡½æ•°ä¸Šï¼

ç›®å‰çš„å†™æ³•ä¸ºï¼š

```js
var root = (typeof self == 'object' && self.self == self && self) ||
           (typeof global == 'object' && global.global == global && global) ||
           this ||
           {};

var _ = function() {}

root._ = _;
```

å¦‚ä½•åšåˆ° `_([1, 2, 3]).each(...)` å‘¢ï¼Ÿå³ _ å‡½æ•°è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡ï¼Œå¦‚ä½•è°ƒç”¨æŒ‚åœ¨ _ å‡½æ•°ä¸Šçš„æ–¹æ³•å‘¢ï¼Ÿ

æˆ‘ä»¬çœ‹çœ‹ underscore æ˜¯å¦‚ä½•å®ç°çš„ï¼š

```js
var _ = function(obj) {
    if (!(this instanceof _)) return new _(obj);
    this._wrapped = obj;
};

_([1, 2, 3]);
```

æˆ‘ä»¬åˆ†æä¸‹ `_([1, 2, 3])` çš„æ‰§è¡Œè¿‡ç¨‹ï¼š

1. æ‰§è¡Œ `this instanceof _`ï¼Œthis æŒ‡å‘ windowï¼Œ`window instanceof _` ä¸º falseï¼Œ`!` æ“ä½œç¬¦å–åï¼Œæ‰€ä»¥æ‰§è¡Œ `new _(obj)`ã€‚
2. `new _(obj)` ä¸­ï¼Œthis æŒ‡å‘å®ä¾‹å¯¹è±¡ï¼Œ`this instanceof _` ä¸º trueï¼Œå–ååï¼Œä»£ç æ¥ç€æ‰§è¡Œã€‚
3. æ‰§è¡Œ `this._wrapped = obj`ï¼Œå‡½æ•°æ‰§è¡Œç»“æŸã€‚
4. æ€»ç»“ï¼Œ`_([1, 2, 3])` è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œä¸º `{_wrapped: [1, 2, 3]}`ï¼Œè¯¥å¯¹è±¡çš„åŸå‹æŒ‡å‘ `_.prototype`

ç¤ºæ„å›¾å¦‚ä¸‹ï¼š

![underscore_03-29_01](https://fastly.jsdelivr.net/gh/oliver556/image-hosting@master/20220329/underscore_03-29_01.1737uq7fu74w.webp)

ç„¶åé—®é¢˜æ¥äº†ï¼Œæˆ‘ä»¬æ˜¯å°†æ–¹æ³•æŒ‚è½½åˆ° _ å‡½æ•°å¯¹è±¡ä¸Šï¼Œå¹¶æ²¡æœ‰æŒ‚è½½åˆ°å‡½æ•°çš„åŸå‹ä¸Šå‘ï¼Œæ‰€ä»¥è¿”å›äº†çš„å®ä¾‹ï¼Œå…¶å®æ˜¯æ— æ³•è°ƒç”¨ _ å‡½æ•°å¯¹è±¡ä¸Šçš„æ–¹æ³•çš„ï¼

æˆ‘ä»¬å†™ä¸ªä¾‹å­ï¼š

```js
(function(){
    var root = (typeof self == 'object' && self.self == self && self) ||
               (typeof global == 'object' && global.global == global && global) ||
               this ||
               {};

    var _ = function(obj) {
      if (!(this instanceof _)) return new _(obj);
      this._wrapped = obj;
    }

    root._ = _;

    _.log = function(){
      console.log(1);
    }

})()

_().log(); // _(...).log is not a function
```

ç¡®å®æœ‰è¿™ä¸ªé—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªæ–¹æ³•å°† _ ä¸Šçš„æ–¹æ³•å¤åˆ¶åˆ° `_.prototype` ä¸Šï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯ `_.mixin`ã€‚

## ä¸ƒ. _.functions

ä¸ºäº†å°† _ ä¸Šçš„æ–¹æ³•å¤åˆ¶åˆ°åŸå‹ä¸Šï¼Œé¦–å…ˆæˆ‘ä»¬è¦è·å¾— _ ä¸Šçš„æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬å…ˆå†™ä¸ª `_.function` æ–¹æ³•ã€‚

```js
_.function = function(obj) {
  var names = [];
  for (var key in obj) {
    if (_.isFunction(obj[key])) names.push(key);
  }
  return names.sort();
}
```

isFunction å‡½æ•°å¯ä»¥å‚è€ƒ [ã€ŠJavaScriptä¸“é¢˜ä¹‹ç±»å‹åˆ¤æ–­(ä¸‹)ã€‹](../02.ä¸“é¢˜ç³»åˆ—/05.JavaScriptä¸“é¢˜ä¹‹ç±»å‹åˆ¤æ–­-ä¸‹.md)

## å…«. mixin

ç°åœ¨æˆ‘ä»¬å¯ä»¥å†™ mixin æ–¹æ³•äº†ã€‚

```js
var ArrayProto = Array.prototype;
var push = ArrayProto.push;

_.mixin = function(obj) {
  _.each(_.functions(obj), function(name) {
    var func = _[name] = obj[name];
    _.prototype[name] = function() {
      var args = [this._wrapped];
      push.apply(args, arguments);
      return func.apply(_, args);
    };
  });
  return _;
};

_.mixin(_);
```

each æ–¹æ³•å¯ä»¥å‚è€ƒ [ã€ŠJavaScriptä¸“é¢˜ä¹‹jQueryé€šç”¨éå†æ–¹æ³•eachçš„å®ç°ã€‹](../02.ä¸“é¢˜ç³»åˆ—/11.JavaScriptä¸“é¢˜ä¹‹jQueryé€šç”¨éå†æ–¹æ³•eachçš„å®ç°.md)

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šå› ä¸º `_[name] = obj[name]` çš„ç¼˜æ•…ï¼Œæˆ‘ä»¬å¯ä»¥ç»™ underscore æ‹“å±•è‡ªå®šä¹‰çš„æ–¹æ³•ï¼š

```js
_.mixin({
  addOne: function(num) {
    return num + 1;
  }
});

_(2).addOne(); // 3
```

è‡³æ­¤ï¼Œæˆ‘ä»¬ç®—æ˜¯å®ç°äº†åŒæ—¶æ”¯æŒé¢å‘å¯¹è±¡é£æ ¼å’Œå‡½æ•°é£æ ¼ã€‚

## ä¹. å¯¼å‡º

ç»ˆäºåˆ°äº†è®²æœ€åä¸€æ­¥ `root._ = _`ï¼Œæˆ‘ä»¬ç›´æ¥çœ‹æºç ï¼š

```js
if (typeof exports != 'undefined' && !exports.nodeType) {
  if (typeof module != 'undefined' && !module.nodeType && module.exports) {
    exports = module.exports = _;
  }
  exports._ = _;
} else {
  root._ = _;
}
```

ä¸ºäº†æ”¯æŒæ¨¡å—åŒ–ï¼Œæˆ‘ä»¬éœ€è¦å°† _ åœ¨åˆé€‚çš„ç¯å¢ƒä¸­ä½œä¸ºæ¨¡å—å¯¼å‡ºï¼Œä½†æ˜¯ nodejs æ¨¡å—çš„ API æ›¾ç»å‘ç”Ÿè¿‡æ”¹å˜ï¼Œæ¯”å¦‚åœ¨æ—©æœŸç‰ˆæœ¬ä¸­ï¼š

```js
// add.js
exports.addOne = function(num) {
  return num + 1
}

// index.js
var add = require('./add');
add.addOne(2);
```

åœ¨æ–°ç‰ˆæœ¬ä¸­ï¼š

```js
// add.js
module.exports = function(1){
  return num + 1;
}

// index.js
var addOne = require('./add.js');
addOne(2);
```

æ‰€ä»¥æˆ‘ä»¬æ ¹æ® exports å’Œ module æ˜¯å¦å­˜åœ¨æ¥é€‰æ‹©ä¸åŒçš„å¯¼å‡ºæ–¹å¼ï¼Œé‚£ä¸ºä»€ä¹ˆåœ¨æ–°ç‰ˆæœ¬ä¸­ï¼Œæˆ‘ä»¬è¿˜è¦ä½¿ç”¨ `exports = module.exports = _` å‘¢ï¼Ÿ

è¿™æ˜¯å› ä¸ºåœ¨ nodejs ä¸­ï¼Œexports æ˜¯ module.exports çš„ä¸€ä¸ªå¼•ç”¨ï¼Œå½“ä½ ä½¿ç”¨äº† module.exports = function(){}ï¼Œå®é™…ä¸Šè¦†ç›–äº† module.exportsã€‚
ä½†æ˜¯ exports å¹¶æœªå‘ç”Ÿæ”¹å˜ï¼Œä¸ºäº†é¿å…åé¢å†ä¿®æ”¹ exports è€Œå¯¼è‡´ä¸èƒ½æ­£ç¡®è¾“å‡ºï¼Œå°±å†™æˆè¿™æ ·ï¼Œå°†ä¸¤è€…ä¿æŒç»Ÿä¸€ã€‚

å†™ä¸ª demo å§ï¼š

```js
// exports æ˜¯ module.exports çš„ä¸€ä¸ªå¼•ç”¨
module.exports.num = '1';

console.log(exports.num); // 1

exports.num = '2';

console.log(module.exports.num); // 2
```

```js
// addOne.js
module.exports = function(num){
  return num + 1;
}

exports.num = '3'

// result.js ä¸­å¼•å…¥ addOne.js
var addOne = require('./addOne.js');

console.log(addOne(1)); // 2
console.log(addOne.num); // undefined
```

```js
// addOne.js
exports = module.exports = function(num){
  return num + 1;
}

exports.num = '3';

// result.js ä¸­å¼•å…¥ addOne.js
var addOne = require('./addOne.js');

console.log(addOne(1)); // 2
console.log(addOne.num); // 3
```

æœ€åä¸ºä»€ä¹ˆè¦è¿›è¡Œä¸€ä¸ª exports.nodeType åˆ¤æ–­å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºå¦‚æœä½ åœ¨ HTML é¡µé¢ä¸­åŠ å…¥ä¸€ä¸ª id ä¸º exports çš„å…ƒç´ ï¼Œæ¯”å¦‚

```html
<div id="exports"></div>
```

å°±ä¼šç”Ÿæˆä¸€ä¸ª window.exports å…¨å±€å˜é‡ï¼Œä½ å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨å‘½ä»¤è¡Œä¸­æ‰“å°è¯¥å˜é‡ã€‚

æ­¤æ—¶åœ¨æµè§ˆå™¨ä¸­ï¼Œ`typeof exports ï¼= 'undefined' çš„åˆ¤æ–­å°±ä¼šç”Ÿæ•ˆï¼Œç„¶å `exports._ = _`ï¼Œç„¶è€Œåœ¨æµè§ˆå™¨ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å°† _ æŒ‚è½½åˆ°å…¨å±€å˜é‡ä¸Šå‘ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è¿˜éœ€è¦è¿›è¡Œä¸€ä¸ªæ˜¯å¦ DOM èŠ‚ç‚¹çš„åˆ¤æ–­ã€‚

## å. æºç 

æœ€ç»ˆçš„ä»£ç å¦‚ä¸‹ï¼Œæœ‰äº†è¿™ä¸ªåŸºæœ¬ç»“æ„ï¼Œä½ å¯ä»¥è‡ªç”±æ·»åŠ ä½ éœ€è¦ä½¿ç”¨åˆ°çš„å‡½æ•°äº†ï¼š

```js
(function() {

  var root = (typeof self == 'object' && self.self == self && self) ||
    (typeof global == 'object' && global.global == global && global) ||
    this || {};
  
  var ArrayProto = Array.prototype;
  
  var push = ArrayProto.push;
  
  var _ = function(obj) {
    if (obj instanceof _) return obj;
    if (!(this instanceof _)) return new _(obj);
    this._wrapped = obj;
  };

  if (typeof exports != 'undefined' && !exports.nodeType) {
    if (typeof module != 'undefined' && !module.nodeType && module.exports) {
      exports = module.exports = _;
    }
    exports._ = _;
  } else {
    root._ = _;
  }

  _.VERSION = '0.1';
  
  var MAX_ARRAY_INDEX = Math.pow(2, 53) - 1;
  
  var isArrayLike = function(collection) {
    var length = collection.length;
    return typeof length == 'number' && length >= 0 && length <= MAX_ARRAY_INDEX;
  };
  
  _.each = function(obj, callback) {
    var length, i = 0;
  
    if (isArrayLike(obj)) {
      length = obj.length;
      for (; i < length; i++) {
        if (callback.call(obj[i], obj[i], i) === false) {
          break;
        }
      }
    } else {
      for (i in obj) {
        if (callback.call(obj[i], obj[i], i) === false) {
          break;
        }
      }
    }
  
    return obj;
  }

  _.isFunction = function(obj) {
    return typeof obj == 'function' || false;
  };
  
  _.functions = function(obj) {
    var names = [];
    for (var key in obj) {
      if (_.isFunction(obj[key])) names.push(key);
    }
    return names.sort();
  };

    /**
     * åœ¨ _.mixin(_) å‰æ·»åŠ è‡ªå·±å®šä¹‰çš„æ–¹æ³•
     */
    _.reverse = function(string){
      return string.split('').reverse().join('');
    }

    _.mixin = function(obj) {
      _.each(_.functions(obj), function(name) {
        var func = _[name] = obj[name];
        _.prototype[name] = function() {
          var args = [this._wrapped];
    
          push.apply(args, arguments);
    
          return func.apply(_, args);
        };
      });
      return _;
    };

    _.mixin(_);

})()
```
