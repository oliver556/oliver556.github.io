---
title: underscore ç³»åˆ—ä¹‹é“¾å¼è°ƒç”¨
date: 2021-11-11 12:57:28
permalink: /pages/ad7318/
categories:
  - å‰ç«¯æŠ€æœ¯
tags:
  - Webå¼€å‘
  - JavaScript
  - underscoreç³»åˆ—
author:
  name: Jamison
  link: https://github.com/oliver556
---

# underscore ç³»åˆ—ä¹‹é“¾å¼è°ƒç”¨

## ğŸ“–. å‰è¨€

æœ¬æ–‡æ¥ç€ä¸Šç¯‡ [ã€Šunderscore ç³»åˆ—ä¹‹å¦‚ä½•å†™è‡ªå·±çš„ underscoreã€‹](01.underscoreç³»åˆ—ä¹‹å¦‚ä½•å†™è‡ªå·±çš„underscore.md)ï¼Œé˜…è¯»æœ¬ç¯‡å‰ï¼Œå¸Œæœ›ä½ å·²ç»é˜…è¯»äº†ä¸Šä¸€ç¯‡ã€‚

## ä¸€. jQuery

æˆ‘ä»¬éƒ½çŸ¥é“ jQuery å¯ä»¥é“¾å¼è°ƒç”¨ï¼Œæ¯”å¦‚ï¼š

```js
$("div").eq(0).css("width", "200px").show();
```

æˆ‘ä»¬å†™ä¸ªç®€å•çš„ demo æ¨¡æ‹Ÿé“¾å¼è°ƒç”¨ï¼š

```js
function JQuery(selector) {
  this.elements = [];
  var nodeLists = document.getElementsByTagName(selector);
  for (var i = 0; i < nodeLists.length; i++) {
    this.elements.push(nodeLists[i]);
  }
  return this;
}

JQuery.prototype = {
  eq: function(num){
    this.elements = [this.elements[num]];
    return this;
  },
  css: function(prop, val) {
    this.elements.forEach(function(el){
      el.style[prop] = val;
    })
    return this;
  },
  show: function() {
    this.css('display', 'block');
    return this;
  }
}

window.$ = function(selector){
  return new JQuery(selector)
}

$("div").eq(0).css("width", "200px").show();
```

jQuery ä¹‹æ‰€ä»¥èƒ½å®ç°é“¾å¼è°ƒç”¨ï¼Œå…³é”®å°±åœ¨äºé€šè¿‡ `return this`ï¼Œè¿”å›è°ƒç”¨å¯¹è±¡ã€‚å†ç²¾ç®€ä¸‹ demo å°±æ˜¯ï¼š


```js
var jQuery = {
  eq: function(){
    console.log('è°ƒç”¨ eq æ–¹æ³•');
    return this;
  },
  show: function(){
    console.log('è°ƒç”¨ show æ–¹æ³•');
    return this;
  }
}

jQuery.eq().show();
```

## äºŒ. _.chain

åœ¨ underscore ä¸­ï¼Œé»˜è®¤ä¸ä½¿ç”¨é“¾å¼è°ƒç”¨ï¼Œä½†æ˜¯å¦‚æœä½ æƒ³ä½¿ç”¨é“¾å¼è°ƒç”¨ï¼Œä½ å¯ä»¥é€šè¿‡ _.chain å‡½æ•°å®ç°ï¼š

```js
_.chain([1, 2, 3, 4])
.filter(function(num) { return num % 2 == 0; })
.map(function(num) { return num * num })
.value(); // [4, 16]
```

æˆ‘ä»¬çœ‹çœ‹ _.chain è¿™ä¸ªæ–¹æ³•éƒ½åšäº†ä»€ä¹ˆï¼š

```js
_.chain = function (obj) {
  var instance = _(obj);
  instance._chain = true;
  return instance;
};
```

æˆ‘ä»¬ä»¥ [1, 2, 3] ä¸ºä¾‹ï¼Œ_.chain([1, 2, 3]) ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼š

```js
{
  _chain: true,
  _wrapped: [1, 2, 3]
}
```

è¯¥å¯¹è±¡çš„åŸå‹ä¸Šæœ‰ç€ underscore çš„å„ç§æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥è°ƒç”¨è¿™äº›æ–¹æ³•ã€‚

ä½†æ˜¯é—®é¢˜åœ¨äºåŸå‹ä¸Šçš„è¿™äº›æ–¹æ³•å¹¶æ²¡æœ‰åƒ jQuery ä¸€æ ·ï¼Œè¿”å› this ï¼Œæ‰€ä»¥å¦‚æœä½ è°ƒç”¨äº†ä¸€æ¬¡æ–¹æ³•ï¼Œå°±æ— æ³•æ¥ç€è°ƒç”¨å…¶ä»–æ–¹æ³•äº†â€¦â€¦

ä½†æ˜¯è¯•æƒ³ä¸‹ï¼Œæˆ‘ä»¬å°†å‡½æ•°çš„è¿”å›å€¼ä½œä¸ºå‚æ•°å†ä¼ å…¥ `_.chain` å‡½æ•°ä¸­ï¼Œä¸å°±å¯ä»¥æ¥ç€è°ƒç”¨å…¶ä»–æ–¹æ³•äº†ï¼Ÿ

å†™ä¸€ä¸ªç²¾ç®€çš„ Demo:

```js
var _ = function(obj) {
  if (!(this instanceof _)) return new _(obj);
  this._wrapped = obj;
};

_.chain = function (obj) {
  var instance = _(obj);
  instance._chain = true;
  return instance;
};

_.prototype.push = function(num) {
  this._wrapped.push(num);
  return this._wrapped;
}

_.prototype.shift = function(num) {
  this._wrapped.shift()
  return this._wrapped
}

var res = _.chain([1, 2, 3]).push(4);
// å°†ä¸Šä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼ï¼Œä¼ å…¥ _.chainï¼Œç„¶åå†ç»§ç»­è°ƒç”¨å…¶ä»–å‡½æ•°
var res2 = _.chain(res).shift();

console.log(res2); // [2, 3, 4]
```

ç„¶è€Œè¿™ä¹Ÿå¤ªå¤æ‚äº†å§ï¼Œéš¾é“ chain è¿™ä¸ªè¿‡ç¨‹ä¸èƒ½æ˜¯è‡ªåŠ¨åŒ–çš„å—ï¼Ÿå¦‚æœæˆ‘æ˜¯å¼€å‘è€…ï¼Œæˆ‘è‚¯å®šå¸Œæœ›ç›´æ¥å†™æˆï¼š

```js
_.chain([1, 2, 3]).push(4).shift();
```

æ‰€ä»¥æˆ‘ä»¬å†ä¼˜åŒ–ä¸€ä¸‹å®ç°æ–¹å¼ï¼š

```js
var _ = function(obj) {
  if (!(this instanceof _)) return new _(obj);
  this._wrapped = obj;
};

var chainResult = function (instance, obj) {
  return instance._chain ? _.chain(obj) : obj;
};

_.chain = function (obj) {
  var instance = _(obj);
  instance._chain = true;
  return instance;
};

_.prototype.push = function(num) {
  this._wrapped.push(num);
  return chainResult(this, this._wrapped)
}

_.prototype.shift = function() {
  this._wrapped.shift();
  return chainResult(this, this._wrapped);
}

var res = _.chain([1, 2, 3]).push(4).shift();

console.log(res._wrapped);
```

æˆ‘ä»¬åœ¨æ¯ä¸ªå‡½æ•°ä¸­ï¼Œéƒ½ç”¨ chainResult å°†å‡½æ•°çš„è¿”å›å€¼åŒ…è£¹ä¸€éï¼Œå†ç”Ÿæˆä¸€ä¸ªç±»ä¼¼ä»¥ä¸‹è¿™ç§å½¢å¼çš„å¯¹è±¡ï¼š

```js
{
  _wrapped: some value, 
  _chain: true
}
```

è¯¥å¯¹è±¡çš„åŸå‹ä¸Šæœ‰å„ç§å‡½æ•°ï¼Œè€Œè¿™äº›å‡½æ•°çš„è¿”å›å€¼ä½œä¸ºå‚æ•°ä¼ å…¥äº† chainResultï¼Œè¯¥å‡½æ•°åˆä¼šè¿”å›è¿™æ ·ä¸€ä¸ªå¯¹è±¡ï¼Œå‡½æ•°çš„è¿”å›å€¼å°±ä¿å­˜åœ¨ _wrapped ä¸­ï¼Œè¿™æ ·å°±å®ç°äº†é“¾å¼è°ƒç”¨ã€‚

`_.chain` é“¾å¼è°ƒç”¨åŸç†å°±æ˜¯è¿™æ ·ï¼Œå¯æ˜¯è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ¯ä¸ªå‡½æ•°éƒ½è¿›è¡Œä¿®æ”¹å‘€â€¦â€¦

å¹¸è¿çš„æ˜¯ï¼Œåœ¨ underscore ä¸­ï¼Œæ‰€æœ‰çš„å‡½æ•°æ˜¯æŒ‚è½½åˆ° `_` å‡½æ•°å¯¹è±¡ä¸­çš„ï¼Œ`_`.prototype ä¸Šçš„å‡½æ•°æ˜¯é€šè¿‡ `_.mixin` å‡½æ•°å°† `_` å‡½æ•°å¯¹è±¡ä¸­çš„æ‰€æœ‰å‡½æ•°å¤åˆ¶åˆ° `_.prototype` ä¸­çš„ã€‚

æ‰€ä»¥ä¸ºäº†å®ç°é“¾å¼è°ƒç”¨ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å¯¹ä¸Šä¸€ç¯‡ [ã€Šunderscore ç³»åˆ—ä¹‹å¦‚ä½•å†™è‡ªå·±çš„ underscoreã€‹](01.underscoreç³»åˆ—ä¹‹å¦‚ä½•å†™è‡ªå·±çš„underscore.md) ä¸­çš„ `_.mixin` æ–¹æ³•è¿›è¡Œä¸€å®šä¿®æ”¹ï¼š

```js
// ä¿®æ”¹å‰
var ArrayProto = Array.prototype;
var push = ArrayProto.push;

_.mixin = function(obj) {
  _.each(_.functions(obj), function(name) {
    var func = _[name] = obj[name];
    _.prototype[name] = function() {
      var args = [this._wrapped];
      push.apply(args, arguments);
      return func.apply(_, args);
    };
  });
  return _;
};

_.mixin(_);
```

```js
// ä¿®æ”¹å
var ArrayProto = Array.prototype;
var push = ArrayProto.push;

var chainResult = function (instance, obj) {
    return instance._chain ? _(obj).chain() : obj;
};

_.mixin = function(obj) {
  _.each(_.functions(obj), function(name) {
    var func = _[name] = obj[name];
    _.prototype[name] = function() {
      var args = [this._wrapped];
      push.apply(args, arguments);
      return chainResult(this, func.apply(_, args));
    };
  });
  return _;
};

_.mixin(_);
```

## ä¸‰. _.value

æ ¹æ®ä¸Šé¢çš„åˆ†æè¿‡ç¨‹ï¼Œæˆ‘ä»¬çŸ¥é“å¦‚æœæˆ‘ä»¬æ‰“å°ï¼š

```js
console.log(_.chain([1, 2, 3]).push(4).shift());
```

å…¶å®ä¼šæ‰“å°ä¸€ä¸ªå¯¹è±¡ `{_chain: true, _wrapped: [2, 3, 4] }`

å¯æ˜¯æˆ‘å¸Œæœ›è·å¾—å€¼æ˜¯ [2, 3, 4] å‘€ï¼

æ‰€ä»¥ï¼Œæˆ‘ä»¬è¿˜éœ€è¦æä¾›ä¸€ä¸ª value æ–¹æ³•ï¼Œå½“æ‰§è¡Œ value æ–¹æ³•çš„æ—¶å€™ï¼Œå°±è¿”å›å½“å‰ _wrapped çš„å€¼ã€‚

```js
_.prototype.value = function() {
  return this._wrapped;
};
```

æ­¤æ—¶è°ƒç”¨æ–¹å¼ä¸ºï¼š

```js
var arr = _.chain([1, 2, 3]).push(4).shift().value();
console.log(arr); // [2, 3, 4]
```

## å››. æœ€ç»ˆä»£ç 

ç»“åˆ [ä¸Šä¸€ç¯‡æ–‡ç« ](01.underscoreç³»åˆ—ä¹‹å¦‚ä½•å†™è‡ªå·±çš„underscore.md)ï¼Œæœ€ç»ˆçš„ underscore ä»£ç ç»„ç»‡ç»“æ„å¦‚ä¸‹ï¼š

```js
(function() {

  var root = (typeof self == 'object' && self.self == self && self) ||
      (typeof global == 'object' && global.global == global && global) ||
      this || {};

  var ArrayProto = Array.prototype;

  var push = ArrayProto.push;

  var _ = function(obj) {
    if (obj instanceof _) return obj;
    if (!(this instanceof _)) return new _(obj);
    this._wrapped = obj;
  };

  if (typeof exports != 'undefined' && !exports.nodeType) {
    if (typeof module != 'undefined' && !module.nodeType && module.exports) {
      exports = module.exports = _;
    }
    exports._ = _;
  } else {
    root._ = _;
  }

  _.VERSION = '0.2';

  var MAX_ARRAY_INDEX = Math.pow(2, 53) - 1;

  var isArrayLike = function(collection) {
      var length = collection.length;
      return typeof length == 'number' && length >= 0 && length <= MAX_ARRAY_INDEX;
  };

  _.each = function(obj, callback) {
    var length, i = 0;

    if (isArrayLike(obj)) {
      length = obj.length;
      for (; i < length; i++) {
        if (callback.call(obj[i], obj[i], i) === false) {
          break;
        }
      }
    } else {
      for (i in obj) {
        if (callback.call(obj[i], obj[i], i) === false) {
          break;
        }
      }
    }

    return obj;
  }

  _.isFunction = function(obj) {
    return typeof obj == 'function' || false;
  };

  _.functions = function(obj) {
    var names = [];
    for (var key in obj) {
      if (_.isFunction(obj[key])) names.push(key);
    }
    return names.sort();
  };

  /**
   * åœ¨ _.mixin(_) å‰æ·»åŠ è‡ªå·±å®šä¹‰çš„æ–¹æ³•
   */
  _.reverse = function(string){
    return string.split('').reverse().join('');
  }

  _.chain = function(obj) {
    var instance = _(obj);
    instance._chain = true;
    return instance;
  };

  var chainResult = function(instance, obj) {
    return instance._chain ? _(obj).chain() : obj;
  };

  _.mixin = function(obj) {
    _.each(_.functions(obj), function(name) {
      var func = _[name] = obj[name];
      _.prototype[name] = function() {
        var args = [this._wrapped];
        push.apply(args, arguments);
        return chainResult(this, func.apply(_, args));
      };
    });
    return _;
  };

  _.mixin(_);

  _.prototype.value = function () {
    return this._wrapped;
  };

})()
```
