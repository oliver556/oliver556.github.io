---
title: JavaScript ä¸“é¢˜ä¹‹æ•°ç»„å»é‡
date: 2021-10-20 13:52:00
permalink: /pages/97e2d2/
categories:
  - å‰ç«¯æŠ€æœ¯
tags:
  - Webå¼€å‘
  - JavaScript
  - ä¸“é¢˜ç³»åˆ—
author:
  name: Jamison
  link: https://github.com/oliver556
---

# JavaScript ä¸“é¢˜ä¹‹æ•°ç»„å»é‡

## ğŸ“–. å‰è¨€

æ•°ç»„å»é‡æ–¹æ³•è€ç”Ÿå¸¸è°ˆï¼Œæ—¢ç„¶æ˜¯å¸¸è°ˆï¼Œæˆ‘ä¹Ÿæ¥è°ˆè°ˆã€‚

## ä¸€. åŒå±‚å¾ªç¯

ä¹Ÿè®¸æˆ‘ä»¬é¦–å…ˆæƒ³åˆ°çš„æ˜¯ä½¿ç”¨ indexOf æ¥å¾ªç¯åˆ¤æ–­ä¸€éï¼Œä½†åœ¨è¿™ä¸ªæ–¹æ³•ä¹‹å‰ï¼Œè®©æˆ‘ä»¬å…ˆçœ‹çœ‹æœ€åŸå§‹çš„æ–¹æ³•ï¼š

```js
var array = [1, 1, '1', '1'];

function unique(array) {
  // resç”¨æ¥å­˜å‚¨ç»“æœ
  var res = [];
  for (var i = 0, arrayLen = array.length; i < arrayLen; i++) {
    for (var j = 0, resLen = res.length; j < resLen; j++ ) {
      if (array[i] === res[j]) {
        break;
      }
    }
    // å¦‚æœarray[i]æ˜¯å”¯ä¸€çš„ï¼Œé‚£ä¹ˆæ‰§è¡Œå®Œå¾ªç¯ï¼Œjç­‰äºresLen
    if (j === resLen) {
      res.push(array[i]);
    }
  }
  return res;
}

console.log(unique(array)); // [1, "1"]
```

åœ¨è¿™ä¸ªæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å¾ªç¯åµŒå¥—ï¼Œæœ€å¤–å±‚å¾ªç¯ arrayï¼Œé‡Œé¢å¾ªç¯ resï¼Œå¦‚æœ array[i] çš„å€¼è·Ÿ res[j] çš„å€¼ç›¸ç­‰ï¼Œå°±è·³å‡ºå¾ªç¯ï¼Œå¦‚æœéƒ½ä¸ç­‰äºï¼Œè¯´æ˜å…ƒç´ æ˜¯å”¯ä¸€çš„ï¼Œè¿™æ—¶å€™ j çš„å€¼å°±ä¼šç­‰äº res çš„é•¿åº¦ï¼Œ
æ ¹æ®è¿™ä¸ªç‰¹ç‚¹è¿›è¡Œåˆ¤æ–­ï¼Œå°†å€¼æ·»åŠ è¿› resã€‚

çœ‹èµ·æ¥å¾ˆç®€å•å§ï¼Œä¹‹æ‰€ä»¥è¦è®²ä¸€è®²è¿™ä¸ªæ–¹æ³•ï¼Œæ˜¯å› ä¸ºâ€”â€”â€”â€”â€”â€”å…¼å®¹æ€§å¥½ï¼

## äºŒ. indexOf

æˆ‘ä»¬å¯ä»¥ç”¨ indexOf ç®€åŒ–å†…å±‚çš„å¾ªç¯ï¼š

```js
var array = [1, 1, '1'];

function unique(array) {
  var res = [];
  for (var i = 0, len = array.length; i < len; i++) {
    var current = array[i];
    if (res.indexOf(current) === -1) {
      res.push(current);
    }
  }
  return res;
}

console.log(unique(array));
```

## ä¸‰. æ’åºåå»é‡

è¯•æƒ³æˆ‘ä»¬å…ˆå°†è¦å»é‡çš„æ•°ç»„ä½¿ç”¨ sort æ–¹æ³•æ’åºåï¼Œç›¸åŒçš„å€¼å°±ä¼šè¢«æ’åœ¨ä¸€èµ·ï¼Œç„¶åæˆ‘ä»¬å°±å¯ä»¥åªåˆ¤æ–­å½“å‰å…ƒç´ ä¸ä¸Šä¸€ä¸ªå…ƒç´ æ˜¯å¦ç›¸åŒï¼Œç›¸åŒå°±è¯´æ˜é‡å¤ï¼Œä¸ç›¸åŒå°±æ·»åŠ è¿› resï¼Œè®©æˆ‘ä»¬å†™ä¸ª demoï¼š

```js
var array = [1, 1, '1'];

function unique(array) {
  var res = [];
  var sortedArray = array.concat().sort();
  var seen;
  for (var i = 0, len = sortedArray.length; i < len; i++) {
    // å¦‚æœæ˜¯ç¬¬ä¸€ä¸ªå…ƒç´ æˆ–è€…ç›¸é‚»çš„å…ƒç´ ä¸ç›¸åŒ
    if (!i || seen !== sortedArray[i]) {
      res.push(sortedArray[i]);
    }
    seen = sortedArray[i];
  }
  return res;
}

console.log(unique(array));
```

å¦‚æœæˆ‘ä»¬å¯¹ä¸€ä¸ªå·²ç»æ’å¥½åºçš„æ•°ç»„å»é‡ï¼Œè¿™ç§æ–¹æ³•æ•ˆç‡è‚¯å®šé«˜äºä½¿ç”¨ indexOfã€‚

## å››. unique API

çŸ¥é“äº†è¿™ä¸¤ç§æ–¹æ³•åï¼Œæˆ‘ä»¬å¯ä»¥å»å°è¯•å†™ä¸€ä¸ªåä¸º unique çš„å·¥å…·å‡½æ•°ï¼Œæˆ‘ä»¬æ ¹æ®ä¸€ä¸ªå‚æ•° isSorted åˆ¤æ–­ä¼ å…¥çš„æ•°ç»„æ˜¯å¦æ˜¯å·²æ’åºçš„ï¼Œå¦‚æœä¸º trueï¼Œæˆ‘ä»¬å°±åˆ¤æ–­ç›¸é‚»å…ƒç´ æ˜¯å¦ç›¸åŒï¼Œå¦‚æœä¸º falseï¼Œæˆ‘ä»¬å°±ä½¿ç”¨ indexOf è¿›è¡Œåˆ¤æ–­

```js
var array1 = [1, 2, '1', 2, 1];
var array2 = [1, 1, '1', 2, 2];

// ç¬¬ä¸€ç‰ˆ
function unique(array, isSorted) {
  var res = [];
  var seen = [];
  
  for (var i = 0, len = array.length; i < len; i++) {
    var value = array[i];
    if (isSorted) {
      if (!i || seen !== value) {
        res.push(value);
      }
      seen = value;
    }
    else if (res.indexOf(value) === -1) {
      res.push(value);
    }        
  }
  return res;
}

console.log(unique(array1)); // [1, 2, "1"]
console.log(unique(array2, true)); // [1, "1", 2]
```

## äº”. ä¼˜åŒ–

å°½ç®¡ unqique å·²ç»å¯ä»¥è¯•ä¸‹å»é‡åŠŸèƒ½ï¼Œä½†æ˜¯ä¸ºäº†è®©è¿™ä¸ª API æ›´åŠ å¼ºå¤§ï¼Œæˆ‘ä»¬æ¥è€ƒè™‘ä¸€ä¸ªéœ€æ±‚ï¼š

æ–°éœ€æ±‚ï¼šå­—æ¯çš„å¤§å°å†™è§†ä¸ºä¸€è‡´ï¼Œæ¯”å¦‚'a'å’Œ'A'ï¼Œä¿ç•™ä¸€ä¸ªå°±å¯ä»¥äº†ï¼

è™½ç„¶æˆ‘ä»¬å¯ä»¥å…ˆå¤„ç†æ•°ç»„ä¸­çš„æ‰€æœ‰æ•°æ®ï¼Œæ¯”å¦‚å°†æ‰€æœ‰çš„å­—æ¯è½¬æˆå°å†™ï¼Œç„¶åå†ä¼ å…¥ unique å‡½æ•°ï¼Œä½†æ˜¯æœ‰æ²¡æœ‰æ–¹æ³•å¯ä»¥çœæ‰å¤„ç†æ•°ç»„çš„è¿™ä¸€éå¾ªç¯ï¼Œç›´æ¥å°±åœ¨å»é‡çš„å¾ªç¯ä¸­åšå‘¢ï¼Ÿè®©æˆ‘ä»¬å»å®Œæˆè¿™ä¸ªéœ€æ±‚ï¼š

```js
var array3 = [1, 1, 'a', 'A', 2, 2];

// ç¬¬äºŒç‰ˆ
// iteratee è‹±æ–‡é‡Šä¹‰ï¼šè¿­ä»£ é‡å¤
function unique(array, isSorted, iteratee) {
  var res = [];
  var seen = [];
  
  for (var i = 0, len = array.length; i < len; i++) {
    var value = array[i];
    var computed = iteratee ? iteratee(value, i, array) : value;
    if (isSorted) {
      if (!i || seen !== computed) {
        res.push(value);
      }
      seen = computed;
    }
    else if (iteratee) {
      if (seen.indexOf(computed) === -1) {
        seen.push(computed);
        res.push(value);
      }
    }
    else if (res.indexOf(value) === -1) {
      res.push(value);
    }        
  }
  return res;
}

console.log(unique(array3, false, function(item){
  return typeof item == 'string' ? item.toLowerCase() : item;
})); // [1, "a", 2]
```

åœ¨è¿™ä¸€ç‰ˆä¹Ÿæ˜¯æœ€åä¸€ç‰ˆçš„å®ç°ä¸­ï¼Œå‡½æ•°ä¼ é€’ä¸‰ä¸ªå‚æ•°ï¼š

arrayï¼šè¡¨ç¤ºè¦å»é‡çš„æ•°ç»„ï¼Œå¿…å¡«

isSortedï¼šè¡¨ç¤ºå‡½æ•°ä¼ å…¥çš„æ•°ç»„æ˜¯å¦å·²æ’è¿‡åºï¼Œå¦‚æœä¸º trueï¼Œå°†ä¼šé‡‡ç”¨æ›´å¿«çš„æ–¹æ³•è¿›è¡Œå»é‡

iterateeï¼šä¼ å…¥ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥å¯¹æ¯ä¸ªå…ƒç´ è¿›è¡Œé‡æ–°çš„è®¡ç®—ï¼Œç„¶åæ ¹æ®å¤„ç†çš„ç»“æœè¿›è¡Œå»é‡

è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»ä»¿ç…§ç€ underscore çš„æ€è·¯å†™äº†ä¸€ä¸ª unique å‡½æ•°ã€‚

## å…­. filter

ES5 æä¾›äº† filter æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨æ¥ç®€åŒ–å¤–å±‚å¾ªç¯ï¼š

æ¯”å¦‚ä½¿ç”¨ indexOf çš„æ–¹æ³•ï¼š

```js
var array = [1, 2, 1, 1, '1'];

function unique(array) {
  var res = array.filter(function(item, index, array){
    return array.indexOf(item) === index;
  })
  return res;
}

console.log(unique(array));
```

æ’åºå»é‡çš„æ–¹æ³•ï¼š

```js
var array = [1, 2, 1, 1, '1'];

function unique(array) {
  return array.concat().sort().filter(function(item, index, array){
    return !index || item !== array[index - 1]
  })
}

console.log(unique(array));
```

## ä¸ƒ. Object é”®å€¼å¯¹

å»é‡çš„æ–¹æ³•ä¼—å¤šï¼Œå°½ç®¡æˆ‘ä»¬å·²ç»è·Ÿç€ underscore å†™äº†ä¸€ä¸ª unqiue APIï¼Œä½†æ˜¯è®©æˆ‘ä»¬çœ‹çœ‹å…¶ä»–çš„æ–¹æ³•æ‹“å±•ä¸‹è§†é‡ï¼š

è¿™ç§æ–¹æ³•æ˜¯åˆ©ç”¨ä¸€ä¸ªç©ºçš„ Object å¯¹è±¡ï¼Œæˆ‘ä»¬æŠŠæ•°ç»„çš„å€¼å­˜æˆ Object çš„ key å€¼ï¼Œæ¯”å¦‚ Object[value1] = trueï¼Œåœ¨åˆ¤æ–­å¦ä¸€ä¸ªå€¼çš„æ—¶å€™ï¼Œå¦‚æœ Object[value2]å­˜åœ¨çš„è¯ï¼Œå°±è¯´æ˜è¯¥å€¼æ˜¯é‡å¤çš„ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š

```js
var array = [1, 2, 1, 1, '1'];

function unique(array) {
  var obj = {};
  return array.filter(function(item, index, array){
    return obj.hasOwnProperty(item) ? false : (obj[item] = true);
  })
}

console.log(unique(array)); // [1, 2]
```

æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæ˜¯æœ‰é—®é¢˜çš„ï¼Œå› ä¸º 1 å’Œ '1' æ˜¯ä¸åŒçš„ï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•ä¼šåˆ¤æ–­ä¸ºåŒä¸€ä¸ªå€¼ï¼Œè¿™æ˜¯å› ä¸ºå¯¹è±¡çš„é”®å€¼åªèƒ½æ˜¯å­—ç¬¦ä¸²ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `typeof item + item` æ‹¼æˆå­—ç¬¦ä¸²ä½œä¸º key å€¼æ¥é¿å…è¿™ä¸ªé—®é¢˜ï¼š

```js
var array = [1, 2, 1, 1, '1'];

function unique(array) {
  var obj = {};
  return array.filter(function(item, index, array){
    return obj.hasOwnProperty(typeof item + item) ? false : (obj[typeof item + item] = true);
  })
}

console.log(unique(array)); // [1, 2, "1"]
```

ç„¶è€Œï¼Œå³ä¾¿å¦‚æ­¤ï¼Œæˆ‘ä»¬ä¾ç„¶æ— æ³•æ­£ç¡®åŒºåˆ†å‡ºä¸¤ä¸ªå¯¹è±¡ï¼Œæ¯”å¦‚ {value: 1} å’Œ {value: 2}ï¼Œå› ä¸º `typeof item + item` çš„ç»“æœéƒ½ä¼šæ˜¯ `object[object Object]`ï¼Œä¸è¿‡æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ JSON.stringify å°†å¯¹è±¡åºåˆ—åŒ–ï¼š

```js
var array = [{value: 1}, {value: 1}, {value: 2}];

function unique(array) {
  var obj = {};
  return array.filter(function(item, index, array){
    console.log(typeof item + JSON.stringify(item));
    return obj.hasOwnProperty(typeof item + JSON.stringify(item)) ? false : (obj[typeof item + JSON.stringify(item)] = true);
  })
}

console.log(unique(array)); // [{value: 1}, {value: 2}]
```

çœ‹ä¼¼å·²ç»ä¸‡æ— ä¸€å¤±ï¼Œä½†è€ƒè™‘åˆ° JSON.stringify ä»»ä½•ä¸€ä¸ªæ­£åˆ™è¡¨è¾¾å¼çš„ç»“æœéƒ½æ˜¯ {}ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•å¹¶ä¸é€‚ç”¨äºå¤„ç†æ­£åˆ™è¡¨è¾¾å¼å»é‡ã€‚

```js
console.log(JSON.stringify(/a/)); // {}
console.log(JSON.stringify(/b/)); // {}
```

## å…«. ES6

éšç€ ES6 çš„åˆ°æ¥ï¼Œå»é‡çš„æ–¹æ³•åˆæœ‰äº†è¿›å±•ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Set å’Œ Map æ•°æ®ç»“æ„ï¼Œä»¥ Set ä¸ºä¾‹ï¼ŒES6 æä¾›äº†æ–°çš„æ•°æ®ç»“æ„ Setã€‚å®ƒç±»ä¼¼äºæ•°ç»„ï¼Œä½†æ˜¯æˆå‘˜çš„å€¼éƒ½æ˜¯å”¯ä¸€çš„ï¼Œæ²¡æœ‰é‡å¤çš„å€¼ã€‚

æ˜¯ä¸æ˜¯æ„Ÿè§‰å°±åƒæ˜¯ä¸ºå»é‡è€Œå‡†å¤‡çš„ï¼Ÿè®©æˆ‘ä»¬æ¥å†™ä¸€ç‰ˆï¼š

```js
var array = [1, 2, 1, 1, '1'];

function unique(array) {
 return Array.from(new Set(array));
}

console.log(unique(array)); // [1, 2, "1"]
```

ç”šè‡³å¯ä»¥å†ç®€åŒ–ä¸‹ï¼š

```js
function unique(array) {
  return [...new Set(array)];
}
```

è¿˜å¯ä»¥å†ç®€åŒ–ä¸‹ï¼š

```js
var unique = (a) => [...new Set(a)];
```

æ­¤å¤–ï¼Œå¦‚æœç”¨ Map çš„è¯ï¼š

```js
function unique (arr) {
  const seen = new Map();
  return arr.filter((a) => !seen.has(a) && seen.set(a, 1));
}
```

## ä¹. JavaScript çš„è¿›åŒ–

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œå»é‡æ–¹æ³•ä»åŸå§‹çš„ 14 è¡Œä»£ç åˆ° ES6 çš„ 1 è¡Œä»£ç ï¼Œå…¶å®ä¹Ÿè¯´æ˜äº† JavaScript è¿™é—¨è¯­è¨€åœ¨ä¸åœçš„è¿›æ­¥ï¼Œç›¸ä¿¡ä»¥åçš„å¼€å‘ä¹Ÿä¼šè¶Šæ¥è¶Šé«˜æ•ˆã€‚

## å. ç‰¹æ®Šç±»å‹æ¯”è¾ƒ

å»é‡çš„æ–¹æ³•å°±åˆ°æ­¤ç»“æŸäº†ï¼Œç„¶è€Œè¦å»é‡çš„å…ƒç´ ç±»å‹å¯èƒ½æ˜¯å¤šç§å¤šæ ·ï¼Œé™¤äº†ä¾‹å­ä¸­ç®€å•çš„ 1 å’Œ '1' ä¹‹å¤–ï¼Œå…¶å®è¿˜æœ‰ nullã€undefinedã€NaNã€å¯¹è±¡ç­‰ï¼Œé‚£ä¹ˆå¯¹äºè¿™äº›å…ƒç´ ï¼Œä¹‹å‰çš„è¿™äº›æ–¹æ³•çš„å»é‡ç»“æœåˆæ˜¯æ€æ ·å‘¢ï¼Ÿ

åœ¨æ­¤ä¹‹å‰ï¼Œå…ˆè®©æˆ‘ä»¬å…ˆçœ‹å‡ ä¸ªä¾‹å­ï¼š

```js
var str1 = '1';
var str2 = new String('1');

console.log(str1 == str2); // true
console.log(str1 === str2); // false

console.log(null == null); // true
console.log(null === null); // true

console.log(undefined == undefined); // true
console.log(undefined === undefined); // true

console.log(NaN == NaN); // false
console.log(NaN === NaN); // false

console.log(/a/ == /a/); // false
console.log(/a/ === /a/); // false

console.log({} == {}); // false
console.log({} === {}); // false
```

é‚£ä¹ˆï¼Œå¯¹äºè¿™æ ·ä¸€ä¸ªæ•°ç»„

```js
var array = [1, 1, '1', '1', null, null, undefined, undefined, new String('1'), new String('1'), /a/, /a/, NaN, NaN];
```

ä»¥ä¸Šå„ç§æ–¹æ³•å»é‡çš„ç»“æœåˆ°åº•æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿ

æˆ‘ç‰¹åœ°æ•´ç†äº†ä¸€ä¸ªåˆ—è¡¨ï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨ä¸‹å¯¹è±¡å’Œ NaN çš„å»é‡æƒ…å†µï¼š

| æ–¹æ³•              | ç»“æœ                                                             | è¯´æ˜                           |
|:-----------------|:-----------------------------------------------------------------|:-----------------------------|
| forå¾ªç¯           | [1, "1", null, undefined, String, String, /a/, /a/, NaN, NaN]    | å¯¹è±¡å’Œ NaN ä¸å»é‡              |
| indexOf          | [1, "1", null, undefined, String, String, /a/, /a/, NaN, NaN]    | å¯¹è±¡å’Œ NaN ä¸å»é‡               |
| sort             | [/a/, /a/, "1", 1, String, 1, String, NaN, NaN, null, undefined] | å¯¹è±¡å’Œ NaN ä¸å»é‡ æ•°å­— 1 ä¹Ÿä¸å»é‡ |
| filter + indexOf | [1, "1", null, undefined, String, String, /a/, /a/]              | å¯¹è±¡ä¸å»é‡ NaN ä¼šè¢«å¿½ç•¥æ‰        |
| ä¼˜åŒ–åçš„é”®å€¼å¯¹æ–¹æ³•  | [1, "1", null, undefined, String, /a/, NaN]                      | å…¨éƒ¨å»é‡                       |
| Set              | [1, "1", null, undefined, String, String, /a/, /a/, NaN]         | å¯¹è±¡ä¸å»é‡ NaN å»é‡             |

è¿™é‡Œå†æ¬¡å£°æ˜ä¸€ä¸‹ï¼Œé”®å€¼å¯¹æ–¹æ³•ä¸èƒ½å»é‡æ­£åˆ™è¡¨è¾¾å¼ã€‚

æƒ³äº†è§£ä¸ºä»€ä¹ˆä¼šå‡ºç°ä»¥ä¸Šçš„ç»“æœï¼Œçœ‹ä¸¤ä¸ª demo ä¾¿èƒ½æ˜ç™½ï¼š

```js
// demo1
var arr = [1, 2, NaN];
arr.indexOf(NaN); // -1
```

indexOf åº•å±‚è¿˜æ˜¯ä½¿ç”¨ === è¿›è¡Œåˆ¤æ–­ï¼Œå› ä¸º NaN === NaNçš„ç»“æœä¸º falseï¼Œæ‰€ä»¥ä½¿ç”¨ indexOf æŸ¥æ‰¾ä¸åˆ° NaN å…ƒç´ 

```js
// demo2
function unique(array) {
   return Array.from(new Set(array));
}
console.log(unique([NaN, NaN])); // [NaN]
```

Set è®¤ä¸ºå°½ç®¡ NaN === NaN ä¸º falseï¼Œä½†æ˜¯è¿™ä¸¤ä¸ªå…ƒç´ æ˜¯é‡å¤çš„ã€‚

## ğŸŒŸ. å†™åœ¨æœ€å

è™½ç„¶å»é‡çš„ç»“æœæœ‰æ‰€ä¸åŒï¼Œä½†æ›´é‡è¦çš„æ˜¯è®©æˆ‘ä»¬çŸ¥é“åœ¨åˆé€‚çš„åœºæ™¯è¦é€‰æ‹©åˆé€‚çš„æ–¹æ³•ã€‚
