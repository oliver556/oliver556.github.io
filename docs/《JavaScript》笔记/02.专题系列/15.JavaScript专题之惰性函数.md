---
title: JavaScript ä¸“é¢˜ä¹‹æƒ°æ€§å‡½æ•°
date: 2021-11-04 16:37:45
permalink: /pages/d15b8e/
categories:
  - ã€ŠJavaScriptã€‹ç¬”è®°
  - ä¸“é¢˜ç³»åˆ—
tags:
  - JavaScriptä¸“é¢˜ç³»åˆ—
---

# JavaScript ä¸“é¢˜ä¹‹æƒ°æ€§å‡½æ•°

## ğŸ“–. éœ€æ±‚

æˆ‘ä»¬ç°åœ¨éœ€è¦å†™ä¸€ä¸ª foo å‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°è¿”å›é¦–æ¬¡è°ƒç”¨æ—¶çš„ Date å¯¹è±¡ï¼Œæ³¨æ„æ˜¯é¦–æ¬¡ã€‚

## ä¸€. è§£å†³ä¸€ï¼šæ™®é€šæ–¹æ³•

```js
var t;
function foo() {
  if (t) return t;
  t = new Date();
  return t;
}
```

é—®é¢˜æœ‰ä¸¤ä¸ªï¼Œä¸€æ˜¯æ±¡æŸ“äº†å…¨å±€å˜é‡ï¼ŒäºŒæ˜¯æ¯æ¬¡è°ƒç”¨ foo çš„æ—¶å€™éƒ½éœ€è¦è¿›è¡Œä¸€æ¬¡åˆ¤æ–­ã€‚

## äºŒ. è§£å†³äºŒï¼šé—­åŒ…

æˆ‘ä»¬å¾ˆå®¹æ˜“æƒ³åˆ°ç”¨é—­åŒ…é¿å…æ±¡æŸ“å…¨å±€å˜é‡ã€‚

```js
var foo = function() {
  var t;
  return function() {
    if (t) return t;
    t = new Date();
    return t;
  }
}
```

ç„¶è€Œè¿˜æ˜¯æ²¡æœ‰è§£å†³è°ƒç”¨æ—¶éƒ½å¿…é¡»è¿›è¡Œä¸€æ¬¡åˆ¤æ–­çš„é—®é¢˜ã€‚

## ä¸‰. è§£å†³ä¸‰ï¼šå‡½æ•°å¯¹è±¡

å‡½æ•°ä¹Ÿæ˜¯ä¸€ç§å¯¹è±¡ï¼Œåˆ©ç”¨è¿™ä¸ªç‰¹æ€§ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚

```js
function foo() {
  if (foo.t) return foo.t;
  foo.t = new Date();
  return foo.t;
}
```

ä¾æ—§æ²¡è§£å†³è°ƒç”¨æ—¶éƒ½å¿…é¡»è¿›è¡Œä¸€æ¬¡åˆ¤æ–­çš„é—®é¢˜ã€‚

## å››. è§£å†³å››ï¼šæƒ°æ€§å‡½æ•°

ä¸é”™ï¼Œæƒ°æ€§å‡½æ•°å°±æ˜¯è§£å†³æ¯æ¬¡éƒ½è¦è¿›è¡Œåˆ¤æ–­çš„è¿™ä¸ªé—®é¢˜ï¼Œè§£å†³åŸç†å¾ˆç®€å•ï¼Œé‡å†™å‡½æ•°ã€‚

```js
var foo = function() {
  var t = new Date();
  foo = function() {
    return t;
  };
  return foo();
}
```

## äº”. æ›´å¤šåº”ç”¨

DOM äº‹ä»¶æ·»åŠ ä¸­ï¼Œä¸ºäº†å…¼å®¹ç°åœ¨æµè§ˆå™¨å’Œ IE æµè§ˆå™¨ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æµè§ˆå™¨ç¯å¢ƒè¿›è¡Œä¸€æ¬¡åˆ¤æ–­ï¼š

```js
// ç®€åŒ–å†™æ³•
function addEvent(type, el, fn) {
  if(window.addEventListener) {
    el.addEventListener(type, fn, false);
  }
  else if(window.attachEvent) {
    el.attachEvent('on' + type, fn);
  }
}
```

é—®é¢˜åœ¨äºæˆ‘ä»¬æ¯å½“ä½¿ç”¨ä¸€æ¬¡ addEvent æ—¶éƒ½ä¼šè¿›è¡Œä¸€æ¬¡åˆ¤æ–­ã€‚

åˆ©ç”¨æƒ°æ€§å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·åšï¼š

```js
function addEvent(type, el, fn) {
  if(window.addEventListener) {
    addEvent = function (type, el, fn) {
      el.addEventListener(type, fn, false);
    }
  }
  else if(window.attachEvent) {
    addEvent = function(type, el, fn) {
      el.attachEvent('on' + type, fn);
    }
  }
}
```

å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨é—­åŒ…çš„å½¢å¼ï¼š

```js
var addEvent = (function(){
  if (window.addEventListener) {
    return function (type, el, fn) {
      el.addEventListener(type, fn, false);
    }
  }
  else if(window.attachEvent){
    return function (type, el, fn) {
      el.attachEvent('on' + type, fn);
    }
  }
})();
```

å½“æˆ‘ä»¬æ¯æ¬¡éƒ½éœ€è¦è¿›è¡Œæ¡ä»¶åˆ¤æ–­ï¼Œå…¶å®åªéœ€è¦åˆ¤æ–­ä¸€æ¬¡ï¼Œæ¥ä¸‹æ¥çš„ä½¿ç”¨æ–¹å¼éƒ½ä¸ä¼šå‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œæƒ³æƒ³æ˜¯å¦å¯ä»¥è€ƒè™‘ä½¿ç”¨æƒ°æ€§å‡½æ•°ã€‚

## å…­. é‡è¦å‚è€ƒ

[Lazy Function Definition Pattern](http://peter.michaux.ca/articles/lazy-function-definition-pattern)
