---
title: JavaScript ä¸“é¢˜ä¹‹ä»é›¶å®ç° jQuery çš„ extend
date: 2021-10-25 10:41:06
permalink: /pages/4e9f5c/
categories:
  - å‰ç«¯æŠ€æœ¯
tags:
  - JavaScript ä¸“é¢˜
---

# JavaScript ä¸“é¢˜ä¹‹ä»é›¶å®ç° jQuery çš„ extend

## ğŸ“–. å‰è¨€

jQuery çš„ `extend` æ˜¯ jQuery ä¸­åº”ç”¨éå¸¸å¤šçš„ä¸€ä¸ªå‡½æ•°ï¼Œä»Šå¤©æˆ‘ä»¬ä¸€è¾¹çœ‹ jQuery çš„ `extend` çš„ç‰¹æ€§ï¼Œä¸€è¾¹å®ç°ä¸€ä¸ª `extend`!


## ä¸€. extend åŸºæœ¬ç”¨æ³•

å…ˆæ¥çœ‹çœ‹ `extend` çš„åŠŸèƒ½ï¼Œå¼•ç”¨ jQuery å®˜ç½‘ï¼š

> Merge the contents of two or more objects together into the first object.

ç¿»è¯‘è¿‡æ¥å°±æ˜¯ï¼Œåˆå¹¶ä¸¤ä¸ªæˆ–è€…æ›´å¤šçš„å¯¹è±¡çš„å†…å®¹åˆ°ç¬¬ä¸€ä¸ªå¯¹è±¡ä¸­ã€‚

è®©æˆ‘ä»¬çœ‹çœ‹ `extend` çš„ç”¨æ³•ï¼š

```js
jQuery.extend( target [, object1 ] [, objectN ] );
```

ç¬¬ä¸€ä¸ªå‚æ•° targetï¼Œè¡¨ç¤ºè¦æ‹“å±•çš„ç›®æ ‡ï¼Œæˆ‘ä»¬å°±ç§°å®ƒä¸ºç›®æ ‡å¯¹è±¡å§ã€‚

åé¢çš„å‚æ•°ï¼Œéƒ½ä¼ å…¥å¯¹è±¡ï¼Œå†…å®¹éƒ½ä¼šå¤åˆ¶åˆ°ç›®æ ‡å¯¹è±¡ä¸­ï¼Œæˆ‘ä»¬å°±ç§°å®ƒä»¬ä¸ºå¾…å¤åˆ¶å¯¹è±¡å§ã€‚

ä¸¾ä¸ªä¾‹å­ï¼š

```js
var obj1 = {
  a: 1,
  b: { b1: 1, b2: 2 }
};

var obj2 = {
  b: { b1: 3, b3: 4 },
  c: 3
};

var obj3 = {
  d: 4
}

console.log($.extend(obj1, obj2, obj3));

// {
//    a: 1,
//    b: { b1: 3, b3: 4 },
//    c: 3,
//    d: 4
// }
```

å½“ä¸¤ä¸ªå¯¹è±¡å‡ºç°ç›¸åŒå­—æ®µçš„æ—¶å€™ï¼Œåè€…ä¼šè¦†ç›–å‰è€…ï¼Œè€Œä¸ä¼šè¿›è¡Œæ·±å±‚æ¬¡çš„è¦†ç›–ã€‚

## äºŒ. extend ç¬¬ä¸€ç‰ˆ

ç»“åˆç€ä¸Šç¯‡å†™å¾—[ã€ŠJavaScript ä¸“é¢˜ä¹‹æ·±æµ…æ‹·è´ã€‹](06.JavaScriptä¸“é¢˜ä¹‹æ·±æµ…æ‹·è´.md)ï¼Œæˆ‘ä»¬å°è¯•ç€è‡ªå·±å†™ä¸€ä¸ª extend å‡½æ•°ï¼š

```js
// ç¬¬ä¸€ç‰ˆ
function extend() {
  var name, options, copy;
  var length = arguments.length;
  var i = 1;
  var target = arguments[0];
  
  for (; i < length; i++) {
    options = arguments[i];
    if (options != null) {
      for (name in options) {
        copy = options[name];
        if (copy !== undefined){
          target[name] = copy;
        }
      }
    }
  }
  
  return target;
};
```

## ä¸‰. extend æ·±æ‹·è´

é‚£å¦‚ä½•è¿›è¡Œæ·±å±‚æ¬¡çš„å¤åˆ¶å‘¢ï¼ŸjQuery v1.1.4 åŠ å…¥äº†ä¸€ä¸ªæ–°çš„ç”¨æ³•ï¼š

```js
jQuery.extend( [deep], target, object1 [, objectN ] );
```

ä¹Ÿå°±æ˜¯è¯´ï¼Œå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å¯ä»¥ä¼ ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå¦‚æœä¸º trueï¼Œæˆ‘ä»¬å°±ä¼šè¿›è¡Œæ·±æ‹·è´ï¼Œfalse ä¾ç„¶å½“åšæµ…æ‹·è´ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œtarget å°±å¾€åç§»åŠ¨åˆ°ç¬¬äºŒä¸ªå‚æ•°ã€‚

è¿˜æ˜¯ä¸¾è¿™ä¸ªä¾‹å­ï¼š

```js
var obj1 = {
  a: 1,
  b: { b1: 1, b2: 2 }
};

var obj2 = {
  b: { b1: 3, b3: 4 },
  c: 3
};

var obj3 = {
  d: 4
}

console.log($.extend(true, obj1, obj2, obj3));

// {
//    a: 1,
//    b: { b1: 3, b2: 2, b3: 4 },
//    c: 3,
//    d: 4
// }
```

å› ä¸ºé‡‡ç”¨äº†æ·±æ‹·è´ï¼Œä¼šéå†åˆ°æ›´æ·±çš„å±‚æ¬¡è¿›è¡Œæ·»åŠ å’Œè¦†ç›–ã€‚

## å››. extend ç¬¬äºŒç‰ˆ

æˆ‘ä»¬æ¥å®ç°æ·±æ‹·è´çš„åŠŸèƒ½ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ï¼š

1. éœ€è¦æ ¹æ®ç¬¬ä¸€ä¸ªå‚æ•°çš„ç±»å‹ï¼Œç¡®å®š target å’Œè¦åˆå¹¶çš„å¯¹è±¡çš„ä¸‹æ ‡èµ·å§‹å€¼ã€‚
2. å¦‚æœæ˜¯æ·±æ‹·è´ï¼Œæ ¹æ® copy çš„ç±»å‹é€’å½’ extend

```js
// ç¬¬äºŒç‰ˆ
function extend() {
  // é»˜è®¤ä¸è¿›è¡Œæ·±æ‹·è´
  var deep = false;
  var name, options, src, copy;
  var length = arguments.length;
  // è®°å½•è¦å¤åˆ¶çš„å¯¹è±¡çš„ä¸‹æ ‡
  var i = 1;
  // ç¬¬ä¸€ä¸ªå‚æ•°ä¸ä¼ å¸ƒå°”å€¼çš„æƒ…å†µä¸‹ï¼Œtargeté»˜è®¤æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°
  var target = arguments[0] || {};
  // å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¸ƒå°”å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯æ‰æ˜¯target
  if (typeof target == 'boolean') {
    deep = target;
    target = arguments[i] || {};
    i++;
  }
  // å¦‚æœtargetä¸æ˜¯å¯¹è±¡ï¼Œæˆ‘ä»¬æ˜¯æ— æ³•è¿›è¡Œå¤åˆ¶çš„ï¼Œæ‰€ä»¥è®¾ä¸º{}
  if (typeof target !== 'object') {
    target = {}
  }
  
  // å¾ªç¯éå†è¦å¤åˆ¶çš„å¯¹è±¡ä»¬
  for (; i < length; i++) {
    // è·å–å½“å‰å¯¹è±¡
    options = arguments[i];
    // è¦æ±‚ä¸èƒ½ä¸ºç©º é¿å…extend(a,,b)è¿™ç§æƒ…å†µ
    if (options != null) {
      for (name in options) {
        // ç›®æ ‡å±æ€§å€¼
        src = target[name];
        // è¦å¤åˆ¶çš„å¯¹è±¡çš„å±æ€§å€¼
        copy = options[name];

        if (deep && copy && typeof copy == 'object') {
          // é€’å½’è°ƒç”¨
          target[name] = extend(deep, src, copy);
        }
        else if (copy !== undefined){
          target[name] = copy;
        }
      }
    }
  }
  
  return target;
};
```

åœ¨å®ç°ä¸Šï¼Œæ ¸å¿ƒçš„éƒ¨åˆ†è¿˜æ˜¯è·Ÿä¸Šç¯‡å®ç°çš„æ·±æµ…æ‹·è´å‡½æ•°ä¸€è‡´ï¼Œå¦‚æœè¦å¤åˆ¶çš„å¯¹è±¡çš„å±æ€§å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå°±é€’å½’è°ƒç”¨ extendã€‚ä¸è¿‡ extend çš„å®ç°ä¸­ï¼Œå¤šäº†å¾ˆå¤šç»†èŠ‚ä¸Šçš„åˆ¤æ–­ï¼Œæ¯”å¦‚ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¦æ˜¯å¸ƒå°”å€¼ï¼Œtarget æ˜¯å¦æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œ
ä¸ä¼ å‚æ•°æ—¶çš„é»˜è®¤å€¼ç­‰ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬çœ‹å‡ ä¸ª jQuery çš„ extend ä½¿ç”¨æ•ˆæœï¼š

## äº”. target æ˜¯å‡½æ•°

åœ¨æˆ‘ä»¬çš„å®ç°ä¸­ï¼Œ`typeof target` å¿…é¡»ç­‰äº `object`ï¼Œæˆ‘ä»¬æ‰ä¼šåœ¨è¿™ä¸ª `target` åŸºç¡€ä¸Šè¿›è¡Œæ‹“å±•ï¼Œç„¶è€Œæˆ‘ä»¬ç”¨ `typeof` åˆ¤æ–­ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œä¼šè¿”å› `function`ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬æ— æ³•åœ¨ä¸€ä¸ªå‡½æ•°ä¸Šè¿›è¡Œæ‹“å±•ï¼

ä»€ä¹ˆï¼Œæˆ‘ä»¬è¿˜èƒ½åœ¨ä¸€ä¸ªå‡½æ•°ä¸Šè¿›è¡Œæ‹“å±•ï¼ï¼

å½“ç„¶å•¦ï¼Œæ¯•ç«Ÿå‡½æ•°ä¹Ÿæ˜¯ä¸€ç§å¯¹è±¡å˜›ï¼Œè®©æˆ‘ä»¬çœ‹ä¸ªä¾‹å­ï¼š

```js
function a() {}

a.target = 'b';

console.log(a.target); // b
```

å®é™…ä¸Šï¼Œåœ¨ underscore çš„å®ç°ä¸­ï¼Œunderscore çš„å„ç§æ–¹æ³•ä¾¿æ˜¯æŒ‚åœ¨äº†å‡½æ•°ä¸Šï¼

æ‰€ä»¥åœ¨è¿™é‡Œæˆ‘ä»¬è¿˜è¦åˆ¤æ–­æ˜¯ä¸æ˜¯å‡½æ•°ï¼Œè¿™æ—¶å€™æˆ‘ä»¬ä¾¿å¯ä»¥ä½¿ç”¨[ã€ŠJavaScriptä¸“é¢˜ä¹‹ç±»å‹åˆ¤æ–­(ä¸Šã€‹](04.JavaScriptä¸“é¢˜ä¹‹ç±»å‹åˆ¤æ–­%28ä¸Š%29.md)ä¸­å†™å¾— isFunction å‡½æ•°

æˆ‘ä»¬è¿™æ ·ä¿®æ”¹ï¼š

```js
if (typeof target !== "object" && !isFunction(target)) {
  target = {};
}
```

## å…­. ç±»å‹ä¸ä¸€è‡´

å…¶å®æˆ‘ä»¬å®ç°çš„æ–¹æ³•æœ‰ä¸ªå° bug ï¼Œä¸ä¿¡æˆ‘ä»¬å†™ä¸ª demo:

```js
var obj1 = {
  a: 1,
  b: {
    c: 2
  }
}
  
var obj2 = {
  b: {
    c: [5],
  
  }
}

var d = extend(true, obj1, obj2)
console.log(d);
```

æˆ‘ä»¬é¢„æœŸä¼šè¿”å›è¿™æ ·ä¸€ä¸ªå¯¹è±¡ï¼š

```js
{
  a: 1,
  b: {
    c: [5]
  }
}
```

ç„¶è€Œè¿”å›äº†è¿™æ ·ä¸€ä¸ªå¯¹è±¡:

```js
{
  a: 1,
  b: {
    c: {
      0: 5
    }
  }
}
```

è®©æˆ‘ä»¬ç»†ç»†åˆ†æä¸ºä»€ä¹ˆä¼šå¯¼è‡´è¿™ç§æƒ…å†µï¼š

é¦–å…ˆæˆ‘ä»¬åœ¨å‡½æ•°çš„å¼€å§‹å†™ä¸€ä¸ª console å‡½æ•°æ¯”å¦‚ï¼š`console.log(1)`ï¼Œç„¶åä»¥ä¸Šé¢è¿™ä¸ª demo ä¸ºä¾‹ï¼Œæ‰§è¡Œä¸€ä¸‹ï¼Œæˆ‘ä»¬ä¼šå‘ç° 1 æ‰“å°äº†ä¸‰æ¬¡ï¼Œè¿™å°±æ˜¯è¯´ extend å‡½æ•°æ‰§è¡Œäº†ä¸‰éï¼Œè®©æˆ‘ä»¬æ‹ä¸€æ‹è¿™ä¸‰éä¼ å…¥çš„å‚æ•°ï¼š

ç¬¬ä¸€éæ‰§è¡Œåˆ°é€’å½’è°ƒç”¨æ—¶ï¼š

```js
var src = { c: 2 };
var copy = { c: [5]};

target[name] = extend(true, src, copy);
```

ç¬¬äºŒéæ‰§è¡Œåˆ°é€’å½’è°ƒç”¨æ—¶ï¼š

```js
var src = 2;
var copy = [5];

target[name] = extend(true, src, copy);
```

ç¬¬ä¸‰éè¿›è¡Œæœ€ç»ˆçš„èµ‹å€¼ï¼Œå› ä¸º src æ˜¯ä¸€ä¸ªåŸºæœ¬ç±»å‹ï¼Œæˆ‘ä»¬é»˜è®¤ä½¿ç”¨ä¸€ä¸ªç©ºå¯¹è±¡ä½œä¸ºç›®æ ‡å€¼ï¼Œæ‰€ä»¥æœ€ç»ˆçš„ç»“æœå°±å˜æˆäº†å¯¹è±¡çš„å±æ€§ï¼

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ç›®æ ‡å±æ€§å€¼å’Œå¾…å¤åˆ¶å¯¹è±¡çš„å±æ€§å€¼è¿›è¡Œåˆ¤æ–­ï¼š

åˆ¤æ–­ç›®æ ‡å±æ€§å€¼è·Ÿè¦å¤åˆ¶çš„å¯¹è±¡çš„å±æ€§å€¼ç±»å‹æ˜¯å¦ä¸€è‡´:

- å¦‚æœå¾…å¤åˆ¶å¯¹è±¡å±æ€§å€¼ç±»å‹ä¸ºæ•°ç»„ï¼Œç›®æ ‡å±æ€§å€¼ç±»å‹ä¸ä¸ºæ•°ç»„çš„è¯ï¼Œç›®æ ‡å±æ€§å€¼å°±è®¾ä¸º []

- å¦‚æœå¾…å¤åˆ¶å¯¹è±¡å±æ€§å€¼ç±»å‹ä¸ºå¯¹è±¡ï¼Œç›®æ ‡å±æ€§å€¼ç±»å‹ä¸ä¸ºå¯¹è±¡çš„è¯ï¼Œç›®æ ‡å±æ€§å€¼å°±è®¾ä¸º {}

ç»“åˆç€ [ã€ŠJavaScript ä¸“é¢˜ä¹‹ç±»å‹åˆ¤æ–­(ä¸‹)ã€‹](05.JavaScriptä¸“é¢˜ä¹‹ç±»å‹åˆ¤æ–­-ä¸‹.md) ä¸­çš„ isPlainObject å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹ç±»å‹è¿›è¡Œæ›´ç»†è‡´çš„åˆ’åˆ†ï¼š

```js

var clone, copyIsArray;

...

if (deep && copy && (isPlainObject(copy) ||
        (copyIsArray = Array.isArray(copy)))) {

  if (copyIsArray) {
    copyIsArray = false;
    clone = src && Array.isArray(src) ? src : [];
  
  } else {
    clone = src && isPlainObject(src) ? src : {};
  }
  
  target[name] = extend(deep, clone, copy);

} else if (copy !== undefined) {
  target[name] = copy;
}
```

## ä¸ƒ. å¾ªç¯å¼•ç”¨

å®é™…ä¸Šï¼Œæˆ‘ä»¬è¿˜å¯èƒ½é‡åˆ°ä¸€ä¸ªå¾ªç¯å¼•ç”¨çš„é—®é¢˜ï¼Œä¸¾ä¸ªä¾‹å­ï¼š

```js
var a = {name : b};
var b = {name : a}
var c = extend(a, b);
console.log(c);
```

æˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ªå¯ä»¥æ— é™å±•å¼€çš„å¯¹è±¡ï¼Œç±»ä¼¼äºè¿™æ ·ï¼š

![javascript_03-15_02](https://cdn.staticaly.com/gh/oliver556/image-hosting@master/20220315/javascript_03-15_02.3di2z5ggz0m0.webp)

ä¸ºäº†é¿å…è¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦åˆ¤æ–­è¦å¤åˆ¶çš„å¯¹è±¡å±æ€§æ˜¯å¦ç­‰äº targetï¼Œå¦‚æœç­‰äºï¼Œæˆ‘ä»¬å°±è·³è¿‡ï¼š

```js
...
src = target[name];
copy = options[name];

if (target === copy) {
  continue;
}
...
```

å¦‚æœåŠ ä¸Šè¿™å¥ï¼Œç»“æœå°±ä¼šæ˜¯ï¼š

```js
{name: undefined}
```

## å…«. æœ€ç»ˆä»£ç 

```js

// isPlainObject å‡½æ•°æ¥è‡ªäº  [JavaScriptä¸“é¢˜ä¹‹ç±»å‹åˆ¤æ–­(ä¸‹) ](https://github.com/mqyqingfeng/Blog/issues/30)
var class2type = {};
var toString = class2type.toString;
var hasOwn = class2type.hasOwnProperty;

function isPlainObject(obj) {
    var proto, Ctor;
    if (!obj || toString.call(obj) !== "[object Object]") {
        return false;
    }
    proto = Object.getPrototypeOf(obj);
    if (!proto) {
        return true;
    }
    Ctor = hasOwn.call(proto, "constructor") && proto.constructor;
    return typeof Ctor === "function" && hasOwn.toString.call(Ctor) === hasOwn.toString.call(Object);
}


function extend() {
  // é»˜è®¤ä¸è¿›è¡Œæ·±æ‹·è´
  var deep = false;
  var name, options, src, copy, clone, copyIsArray;
  var length = arguments.length;
  // è®°å½•è¦å¤åˆ¶çš„å¯¹è±¡çš„ä¸‹æ ‡
  var i = 1;
  // ç¬¬ä¸€ä¸ªå‚æ•°ä¸ä¼ å¸ƒå°”å€¼çš„æƒ…å†µä¸‹ï¼Œtarget é»˜è®¤æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°
  var target = arguments[0] || {};
  // å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°æ˜¯å¸ƒå°”å€¼ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ target
  if (typeof target == 'boolean') {
    deep = target;
    target = arguments[i] || {};
    i++;
  }
  // å¦‚æœtargetä¸æ˜¯å¯¹è±¡ï¼Œæˆ‘ä»¬æ˜¯æ— æ³•è¿›è¡Œå¤åˆ¶çš„ï¼Œæ‰€ä»¥è®¾ä¸º {}
  if (typeof target !== "object" && !isFunction(target)) {
    target = {};
  }
  
  // å¾ªç¯éå†è¦å¤åˆ¶çš„å¯¹è±¡ä»¬
  for (; i < length; i++) {
    // è·å–å½“å‰å¯¹è±¡
    options = arguments[i];
    // è¦æ±‚ä¸èƒ½ä¸ºç©º é¿å… extend(a,,b) è¿™ç§æƒ…å†µ
    if (options != null) {
      for (name in options) {
        // ç›®æ ‡å±æ€§å€¼
        src = target[name];
        // è¦å¤åˆ¶çš„å¯¹è±¡çš„å±æ€§å€¼
        copy = options[name];

        // è§£å†³å¾ªç¯å¼•ç”¨
        if (target === copy) {
          continue;
        }

        // è¦é€’å½’çš„å¯¹è±¡å¿…é¡»æ˜¯ plainObject æˆ–è€…æ•°ç»„
        if (deep && copy && (isPlainObject(copy) ||
            (copyIsArray = Array.isArray(copy)))) {
            // è¦å¤åˆ¶çš„å¯¹è±¡å±æ€§å€¼ç±»å‹éœ€è¦ä¸ç›®æ ‡å±æ€§å€¼ç›¸åŒ
          if (copyIsArray) {
            copyIsArray = false;
            clone = src && Array.isArray(src) ? src : [];

          } else {
            clone = src && isPlainObject(src) ? src : {};
          }

          target[name] = extend(deep, clone, copy);

        } else if (copy !== undefined) {
          target[name] = copy;
        }
      }
    }
  }
  
  return target;
};
```

## ä¹. æ€è€ƒé¢˜

å¦‚æœè§‰å¾—çœ‹æ˜ç™½äº†ä¸Šé¢çš„ä»£ç ï¼Œæƒ³æƒ³ä¸‹é¢ä¸¤ä¸ª demo çš„ç»“æœï¼š

```js
var a = extend(true, [4, 5, 6, 7, 8, 9], [1, 2, 3]);
console.log(a); // ???
```

```js
var obj1 = {
  value: {
    3: 1
  }
}

var obj2 = {
  value: [5, 6, 7],
}

var b = extend(true, obj1, obj2); // ???
var c = extend(true, obj2, obj1); // ???
```
