---
title: JavaScript ä¸“é¢˜ä¹‹è·Ÿç€ underscore å­¦èŠ‚æµ
date: 2021-10-19 11:37:19
permalink: /pages/487dd6/
categories:
  - ã€ŠJavaScriptã€‹ç¬”è®°
  - ä¸“é¢˜ç³»åˆ—
tags:
  - JavaScriptä¸“é¢˜ç³»åˆ—
---

# JavaScript ä¸“é¢˜ä¹‹è·Ÿç€ underscore å­¦èŠ‚æµ

## ğŸ“–. å‰è¨€

åœ¨ [ã€ŠJavaScriptä¸“é¢˜ä¹‹è·Ÿç€underscoreå­¦é˜²æŠ–ã€‹](01.JavaScriptä¸“é¢˜ä¹‹è·Ÿç€underscoreå­¦é˜²æŠ–.md) ä¸­ï¼Œæˆ‘ä»¬äº†è§£äº†ä¸ºä»€ä¹ˆè¦é™åˆ¶äº‹ä»¶çš„é¢‘ç¹è§¦å‘ï¼Œä»¥åŠå¦‚ä½•åšé™åˆ¶ï¼š

1. debounce é˜²æŠ–
2. throttle èŠ‚æµ

ä»Šå¤©é‡ç‚¹è®²è®²èŠ‚æµçš„å®ç°ã€‚

## ä¸€. èŠ‚æµ

èŠ‚æµçš„åŸç†å¾ˆç®€å•ï¼š

å¦‚æœä½ æŒç»­è§¦å‘äº‹ä»¶ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´ï¼Œåªæ‰§è¡Œä¸€æ¬¡äº‹ä»¶ã€‚

æ ¹æ®é¦–æ¬¡æ˜¯å¦æ‰§è¡Œä»¥åŠç»“æŸåæ˜¯å¦æ‰§è¡Œï¼Œæ•ˆæœæœ‰æ‰€ä¸åŒï¼Œå®ç°çš„æ–¹å¼ä¹Ÿæœ‰æ‰€ä¸åŒã€‚

æˆ‘ä»¬ç”¨ leading ä»£è¡¨é¦–æ¬¡æ˜¯å¦æ‰§è¡Œï¼Œtrailing ä»£è¡¨ç»“æŸåæ˜¯å¦å†æ‰§è¡Œä¸€æ¬¡ã€‚

å…³äºèŠ‚æµçš„å®ç°ï¼Œæœ‰ä¸¤ç§ä¸»æµçš„å®ç°æ–¹å¼ï¼Œä¸€ç§æ˜¯ä½¿ç”¨æ—¶é—´æˆ³ï¼Œä¸€ç§æ˜¯è®¾ç½®å®šæ—¶å™¨ã€‚

## äºŒ. ä½¿ç”¨æ—¶é—´æˆ³

è®©æˆ‘ä»¬æ¥çœ‹ç¬¬ä¸€ç§æ–¹æ³•ï¼šä½¿ç”¨æ—¶é—´æˆ³ï¼Œå½“è§¦å‘äº‹ä»¶çš„æ—¶å€™ï¼Œæˆ‘ä»¬å–å‡ºå½“å‰çš„æ—¶é—´æˆ³ï¼Œç„¶åå‡å»ä¹‹å‰çš„æ—¶é—´æˆ³(æœ€ä¸€å¼€å§‹å€¼è®¾ä¸º 0 )ï¼Œå¦‚æœå¤§äºè®¾ç½®çš„æ—¶é—´å‘¨æœŸï¼Œå°±æ‰§è¡Œå‡½æ•°ï¼Œç„¶åæ›´æ–°æ—¶é—´æˆ³ä¸ºå½“å‰çš„æ—¶é—´æˆ³ï¼Œå¦‚æœå°äºï¼Œå°±ä¸æ‰§è¡Œã€‚

çœ‹äº†è¿™ä¸ªè¡¨è¿°ï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰å·²ç»å¯ä»¥å†™å‡ºä»£ç äº†â€¦â€¦ è®©æˆ‘ä»¬æ¥å†™ç¬¬ä¸€ç‰ˆçš„ä»£ç ï¼š

```js
// ç¬¬ä¸€ç‰ˆ
function throttle(func, wait) {
  var context, args;
  var previous = 0;
  
  return function() {
    var now = +new Date();
    context = this;
    args = arguments;
    if (now - previous > wait) {
      func.apply(context, args);
      previous = now;
    }
  }
}
```

ä¾‹å­ä¾ç„¶æ˜¯ç”¨è®² debounce ä¸­çš„ä¾‹å­ï¼Œå¦‚æœä½ è¦ä½¿ç”¨ï¼š

```js
container.onmousemove = throttle(getUserAction, 1000);
```

æ•ˆæœæ¼”ç¤ºå¦‚ä¸‹ï¼š

![javascript_03-14_06](https://cdn.jsdelivr.net/gh/oliver556/image-hosting@master/20220314/javascript_03-14_06.5c3qfad0bbk0.gif)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼šå½“é¼ æ ‡ç§»å…¥çš„æ—¶å€™ï¼Œäº‹ä»¶ç«‹åˆ»æ‰§è¡Œï¼Œæ¯è¿‡ 1s ä¼šæ‰§è¡Œä¸€æ¬¡ï¼Œå¦‚æœåœ¨ 4.2s åœæ­¢è§¦å‘ï¼Œä»¥åä¸ä¼šå†æ‰§è¡Œäº‹ä»¶ã€‚

## ä¸‰. ä½¿ç”¨å®šæ—¶å™¨

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è®²è®²ç¬¬äºŒç§å®ç°æ–¹å¼ï¼Œä½¿ç”¨å®šæ—¶å™¨ã€‚

å½“è§¦å‘äº‹ä»¶çš„æ—¶å€™ï¼Œæˆ‘ä»¬è®¾ç½®ä¸€ä¸ªå®šæ—¶å™¨ï¼Œå†è§¦å‘äº‹ä»¶çš„æ—¶å€™ï¼Œå¦‚æœå®šæ—¶å™¨å­˜åœ¨ï¼Œå°±ä¸æ‰§è¡Œï¼Œç›´åˆ°å®šæ—¶å™¨æ‰§è¡Œï¼Œç„¶åæ‰§è¡Œå‡½æ•°ï¼Œæ¸…ç©ºå®šæ—¶å™¨ï¼Œè¿™æ ·å°±å¯ä»¥è®¾ç½®ä¸‹ä¸ªå®šæ—¶å™¨ã€‚

```js
// ç¬¬äºŒç‰ˆ
function throttle(func, wait) {
  var timeout;
  var previous = 0;
  
  return function() {
    context = this;
    args = arguments;
    if (!timeout) {
      timeout = setTimeout(function(){
        timeout = null;
        func.apply(context, args)
      }, wait)
    }
  }
}
```

ä¸ºäº†è®©æ•ˆæœæ›´åŠ æ˜æ˜¾ï¼Œæˆ‘ä»¬è®¾ç½® wait çš„æ—¶é—´ä¸º 3sï¼Œæ•ˆæœæ¼”ç¤ºå¦‚ä¸‹ï¼š

![javascript_03-14_07](https://cdn.jsdelivr.net/gh/oliver556/image-hosting@master/20220314/javascript_03-14_07.63nk89j4vng0.gif)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼šå½“é¼ æ ‡ç§»å…¥çš„æ—¶å€™ï¼Œäº‹ä»¶ä¸ä¼šç«‹åˆ»æ‰§è¡Œï¼Œæ™ƒäº† 3s åç»ˆäºæ‰§è¡Œäº†ä¸€æ¬¡ï¼Œæ­¤åæ¯ 3s æ‰§è¡Œä¸€æ¬¡ï¼Œå½“æ•°å­—æ˜¾ç¤ºä¸º 3 çš„æ—¶å€™ï¼Œç«‹åˆ»ç§»å‡ºé¼ æ ‡ï¼Œç›¸å½“äºå¤§çº¦ 9.2s çš„æ—¶å€™åœæ­¢è§¦å‘ï¼Œä½†æ˜¯ä¾ç„¶ä¼šåœ¨ç¬¬ 12s çš„æ—¶å€™æ‰§è¡Œä¸€æ¬¡äº‹ä»¶ã€‚

æ‰€ä»¥æ¯”è¾ƒä¸¤ä¸ªæ–¹æ³•ï¼š

1. ç¬¬ä¸€ç§äº‹ä»¶ä¼šç«‹åˆ»æ‰§è¡Œï¼Œç¬¬äºŒç§äº‹ä»¶ä¼šåœ¨ n ç§’åç¬¬ä¸€æ¬¡æ‰§è¡Œ
2. ç¬¬ä¸€ç§äº‹ä»¶åœæ­¢è§¦å‘åæ²¡æœ‰åŠæ³•å†æ‰§è¡Œäº‹ä»¶ï¼Œç¬¬äºŒç§äº‹ä»¶åœæ­¢è§¦å‘åä¾ç„¶ä¼šå†æ‰§è¡Œä¸€æ¬¡äº‹ä»¶

## å››. åŒå‰‘åˆç’§

é‚£æˆ‘ä»¬æƒ³è¦ä¸€ä¸ªä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿ

æœ‰äººå°±è¯´äº†ï¼šæˆ‘æƒ³è¦ä¸€ä¸ªæœ‰å¤´æœ‰å°¾çš„ï¼å°±æ˜¯é¼ æ ‡ç§»å…¥èƒ½ç«‹åˆ»æ‰§è¡Œï¼Œåœæ­¢è§¦å‘çš„æ—¶å€™è¿˜èƒ½å†æ‰§è¡Œä¸€æ¬¡ï¼

æ‰€ä»¥æˆ‘ä»¬ç»¼åˆä¸¤è€…çš„ä¼˜åŠ¿ï¼Œç„¶ååŒå‰‘åˆç’§ï¼Œå†™ä¸€ç‰ˆä»£ç ï¼š

```js
// ç¬¬ä¸‰ç‰ˆ
function throttle(func, wait) {
  var timeout, context, args, result;
  var previous = 0;

  var later = function() {
    previous = +new Date();
    timeout = null;
    func.apply(context, args)
  };

  var throttled = function() {
    var now = +new Date();
    //ä¸‹æ¬¡è§¦å‘ func å‰©ä½™çš„æ—¶é—´
    var remaining = wait - (now - previous);
    context = this;
    args = arguments;
     // å¦‚æœæ²¡æœ‰å‰©ä½™çš„æ—¶é—´äº†æˆ–è€…ä½ æ”¹äº†ç³»ç»Ÿæ—¶é—´
    if (remaining <= 0 || remaining > wait) {
      if (timeout) {
        clearTimeout(timeout);
        timeout = null;
      }
      previous = now;
      func.apply(context, args);
    } else if (!timeout) {
      timeout = setTimeout(later, remaining);
    }
  };
  return throttled;
}
```

æ•ˆæœæ¼”ç¤ºå¦‚ä¸‹ï¼š

![javascript_03-14_08](https://cdn.jsdelivr.net/gh/oliver556/image-hosting@master/20220314/javascript_03-14_08.14py50j6lqbg.gif)

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼šé¼ æ ‡ç§»å…¥ï¼Œäº‹ä»¶ç«‹åˆ»æ‰§è¡Œï¼Œæ™ƒäº† 3sï¼Œäº‹ä»¶å†ä¸€æ¬¡æ‰§è¡Œï¼Œå½“æ•°å­—å˜æˆ 3 çš„æ—¶å€™ï¼Œä¹Ÿå°±æ˜¯ 6s åï¼Œæˆ‘ä»¬ç«‹åˆ»ç§»å‡ºé¼ æ ‡ï¼Œåœæ­¢è§¦å‘äº‹ä»¶ï¼Œ9s çš„æ—¶å€™ï¼Œä¾ç„¶ä¼šå†æ‰§è¡Œä¸€æ¬¡äº‹ä»¶ã€‚

## äº”. ä¼˜åŒ–

ä½†æ˜¯æˆ‘æœ‰æ—¶ä¹Ÿå¸Œæœ›æ— å¤´æœ‰å°¾ï¼Œæˆ–è€…æœ‰å¤´æ— å°¾ï¼Œè¿™ä¸ªå’‹åŠï¼Ÿ

é‚£æˆ‘ä»¬è®¾ç½®ä¸ª options ä½œä¸ºç¬¬ä¸‰ä¸ªå‚æ•°ï¼Œç„¶åæ ¹æ®ä¼ çš„å€¼åˆ¤æ–­åˆ°åº•å“ªç§æ•ˆæœï¼Œæˆ‘ä»¬çº¦å®š:

- leadingï¼šfalse è¡¨ç¤ºç¦ç”¨ç¬¬ä¸€æ¬¡æ‰§è¡Œ
- trailing: false è¡¨ç¤ºç¦ç”¨åœæ­¢è§¦å‘çš„å›è°ƒ

æˆ‘ä»¬æ¥æ”¹ä¸€ä¸‹ä»£ç ï¼š

```js
// ç¬¬å››ç‰ˆ
function throttle(func, wait, options) {
  var timeout, context, args, result;
  var previous = 0;
  if (!options) options = {};
  
  var later = function() {
    previous = options.leading === false ? 0 : new Date().getTime();
    timeout = null;
    func.apply(context, args);
    if (!timeout) context = args = null;
  };
  
  var throttled = function() {
    var now = new Date().getTime();
    if (!previous && options.leading === false) previous = now;
    var remaining = wait - (now - previous);
    context = this;
    args = arguments;
    if (remaining <= 0 || remaining > wait) {
      if (timeout) {
        clearTimeout(timeout);
        timeout = null;
      }
      previous = now;
      func.apply(context, args);
      if (!timeout) context = args = null;
    } else if (!timeout && options.trailing !== false) {
      timeout = setTimeout(later, remaining);
    }
  };
  return throttled;
}
```

## å…­. å–æ¶ˆ

åœ¨ debounce çš„å®ç°ä¸­ï¼Œæˆ‘ä»¬åŠ äº†ä¸€ä¸ª cancel æ–¹æ³•ï¼Œthrottle æˆ‘ä»¬ä¹ŸåŠ ä¸ª cancel æ–¹æ³•ï¼š

```js
// ç¬¬äº”ç‰ˆ éå®Œæ•´ä»£ç ï¼Œå®Œæ•´ä»£ç è¯·æŸ¥çœ‹æœ€åçš„æ¼”ç¤ºä»£ç é“¾æ¥
...
throttled.cancel = function() {
  clearTimeout(timeout);
  previous = 0;
  timeout = null;
}
...
```

## ä¸ƒ. æ³¨æ„

æˆ‘ä»¬è¦æ³¨æ„ underscore çš„å®ç°ä¸­æœ‰è¿™æ ·ä¸€ä¸ªé—®é¢˜ï¼š

é‚£å°±æ˜¯ `leadingï¼šfalse` å’Œ `trailing: false` ä¸èƒ½åŒæ—¶è®¾ç½®ã€‚

å¦‚æœåŒæ—¶è®¾ç½®çš„è¯ï¼Œæ¯”å¦‚å½“ä½ å°†é¼ æ ‡ç§»å‡ºçš„æ—¶å€™ï¼Œå› ä¸º trailing è®¾ç½®ä¸º falseï¼Œåœæ­¢è§¦å‘çš„æ—¶å€™ä¸ä¼šè®¾ç½®å®šæ—¶å™¨ï¼Œæ‰€ä»¥åªè¦å†è¿‡äº†è®¾ç½®çš„æ—¶é—´ï¼Œå†ç§»å…¥çš„è¯ï¼Œå°±ä¼šç«‹åˆ»æ‰§è¡Œï¼Œå°±è¿åäº† leading: falseï¼Œbug å°±å‡ºæ¥äº†ï¼Œ
æ‰€ä»¥ï¼Œè¿™ä¸ª throttle åªæœ‰ä¸‰ç§ç”¨æ³•ï¼š

```js
container.onmousemove = throttle(getUserAction, 1000);
container.onmousemove = throttle(getUserAction, 1000, {
    leading: false
});
container.onmousemove = throttle(getUserAction, 1000, {
    trailing: false
});
```

è‡³æ­¤æˆ‘ä»¬å·²ç»å®Œæ•´å®ç°äº†ä¸€ä¸ª underscore ä¸­çš„ throttle å‡½æ•°ï¼Œæ­å–œï¼Œæ’’èŠ±ï¼
