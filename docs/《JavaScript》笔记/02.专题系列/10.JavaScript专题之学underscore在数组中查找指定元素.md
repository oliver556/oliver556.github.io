---
title: JavaScript ä¸“é¢˜ä¹‹å­¦ underscore åœ¨æ•°ç»„ä¸­æŸ¥æ‰¾æŒ‡å®šå…ƒç´ 
date: 2021-10-28 13:36:22
permalink: /pages/ee8e87/
categories:
  - å‰ç«¯æŠ€æœ¯
tags:
  - JavaScript ä¸“é¢˜
---

# JavaScript ä¸“é¢˜ä¹‹å­¦ underscore åœ¨æ•°ç»„ä¸­æŸ¥æ‰¾æŒ‡å®šå…ƒç´ 

## ğŸ“–. å‰è¨€

åœ¨å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°åœ¨æ•°ç»„ä¸­æŸ¥æ‰¾æŒ‡å®šå…ƒç´ çš„éœ€æ±‚ï¼Œå¯èƒ½å¤§å®¶è§‰å¾—è¿™ä¸ªéœ€æ±‚è¿‡äºç®€å•ï¼Œç„¶è€Œå¦‚ä½•ä¼˜é›…çš„å»å®ç°ä¸€ä¸ª `findIndex` å’Œ `findLastIndex`ã€`indexOf` å’Œ `lastIndexOf` æ–¹æ³•å´æ˜¯å¾ˆå°‘äººå»æ€è€ƒçš„ã€‚
æœ¬æ–‡å°±å¸¦ç€å¤§å®¶ä¸€èµ·å‚è€ƒç€ underscore å»å®ç°è¿™äº›æ–¹æ³•ã€‚

## ä¸€. findIndex

ES6 å¯¹æ•°ç»„æ–°å¢äº† `findIndex` æ–¹æ³•ï¼Œå®ƒä¼šè¿”å›æ•°ç»„ä¸­æ»¡è¶³æä¾›çš„å‡½æ•°çš„ç¬¬ä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•ï¼Œå¦åˆ™è¿”å› -1ã€‚

ä¸¾ä¸ªä¾‹å­ï¼š

```js
function isBigEnough(element) {
  return element >= 15;
}

[12, 5, 8, 130, 44].findIndex(isBigEnough);  // 3
```

`findIndex` ä¼šæ‰¾å‡ºç¬¬ä¸€ä¸ªå¤§äº 15 çš„å…ƒç´ çš„ä¸‹æ ‡ï¼Œæ‰€ä»¥æœ€åè¿”å› 3ã€‚

æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Œå…¶å®ï¼Œæˆ‘ä»¬è‡ªå·±å»å®ç°ä¸€ä¸ª findIndex ä¹Ÿå¾ˆç®€å•ã€‚

## äºŒ. å®ç° findIndex

æ€è·¯è‡ªç„¶å¾ˆæ˜äº†ï¼Œéå†ä¸€éï¼Œè¿”å›ç¬¦åˆè¦æ±‚çš„å€¼çš„ä¸‹æ ‡å³å¯ã€‚

```js
function findIndex(array, predicate, context) {
  for (var i = 0; i < array.length; i++) {
    if (predicate.call(context, array[i], i, array)) return i;
  }
  return -1;
}

console.log(findIndex([1, 2, 3, 4], function(item, i, array){
  if (item == 3) return true;
})) // 2
```

## ä¸‰. findLastIndex

findIndex æ˜¯æ­£åºæŸ¥æ‰¾ï¼Œä½†æ­£å¦‚ indexOf è¿˜æœ‰ä¸€ä¸ªå¯¹åº”çš„ lastIndexOf æ–¹æ³•ï¼Œæˆ‘ä»¬ä¹Ÿæƒ³å†™ä¸€ä¸ªå€’åºæŸ¥æ‰¾çš„ findLastIndex å‡½æ•°ã€‚å®ç°è‡ªç„¶ä¹Ÿå¾ˆç®€å•ï¼Œåªè¦ä¿®æ”¹ä¸‹å¾ªç¯å³å¯ã€‚

```js
function findLastIndex(array, predicate, context) {
  var length = array.length;
  for (var i = length - 1; i >= 0; i--) {
    if (predicate.call(context, array[i], i, array)) return i;
  }
  return -1;
}

console.log(findLastIndex([1, 2, 3, 4], function(item, index, array){
  if (item == 1) return true;
})) // 0
```

## å››. createIndexFinder

ç„¶è€Œé—®é¢˜åœ¨äºï¼ŒfindIndex å’Œ findLastIndex å…¶å®æœ‰å¾ˆå¤šé‡å¤çš„éƒ¨åˆ†ï¼Œå¦‚ä½•ç²¾ç®€å†—ä½™çš„å†…å®¹å‘¢ï¼Ÿè¿™ä¾¿æ˜¯æˆ‘ä»¬è¦å­¦ä¹ çš„åœ°æ–¹ï¼Œæ—¥åé¢è¯•é—®åˆ°æ­¤ç±»é—®é¢˜ï¼Œä¹Ÿæ˜¯åŠ åˆ†çš„é€‰é¡¹ã€‚

underscore çš„æ€è·¯å°±æ˜¯åˆ©ç”¨ä¼ å‚çš„ä¸åŒï¼Œè¿”å›ä¸åŒçš„å‡½æ•°ã€‚è¿™ä¸ªè‡ªç„¶æ˜¯ç®€å•ï¼Œä½†æ˜¯å¦‚ä½•æ ¹æ®å‚æ•°çš„ä¸åŒï¼Œåœ¨åŒä¸€ä¸ªå¾ªç¯ä¸­ï¼Œå®ç°æ­£åºå’Œå€’åºéå†å‘¢ï¼Ÿ

è®©æˆ‘ä»¬ç›´æ¥æ¨¡ä»¿ underscore çš„å®ç°ï¼š

```js
function createIndexFinder(dir) {
  return function(array, predicate, context) {
  
    var length = array.length;
    var index = dir > 0 ? 0 : length - 1;
    
    for (; index >= 0 && index < length; index += dir) {
      if (predicate.call(context, array[index], index, array)) return index;
    }
    
    return -1;
  }
}

var findIndex = createIndexFinder(1);
var findLastIndex = createIndexFinder(-1);
```

## äº”. sortedIndex

findIndex å’Œ findLastIndex çš„éœ€æ±‚ç®—æ˜¯ç»“æŸäº†ï¼Œä½†æ˜¯åˆæ¥äº†ä¸€ä¸ªæ–°éœ€æ±‚ï¼šåœ¨ä¸€ä¸ªæ’å¥½åºçš„æ•°ç»„ä¸­æ‰¾åˆ° value å¯¹åº”çš„ä½ç½®ï¼Œä¿è¯æ’å…¥æ•°ç»„åï¼Œä¾ç„¶ä¿æŒæœ‰åºçš„çŠ¶æ€ã€‚

å‡è®¾è¯¥å‡½æ•°å‘½åä¸º sortedIndexï¼Œæ•ˆæœä¸ºï¼š

```js
sortedIndex([10, 20, 30], 25); // 2
```

ä¹Ÿå°±æ˜¯è¯´å¦‚æœï¼Œæ³¨æ„æ˜¯å¦‚æœï¼Œ25 æŒ‰ç…§æ­¤ä¸‹æ ‡æ’å…¥æ•°ç»„åï¼Œæ•°ç»„å˜æˆ [10, 20, 25, 30]ï¼Œæ•°ç»„ä¾ç„¶æ˜¯æœ‰åºçš„çŠ¶æ€ã€‚

é‚£ä¹ˆè¿™ä¸ªåˆè¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿ

æ—¢ç„¶æ˜¯æœ‰åºçš„æ•°ç»„ï¼Œé‚£æˆ‘ä»¬å°±ä¸éœ€è¦éå†ï¼Œå¤§å¯ä»¥ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾æ³•ï¼Œç¡®å®šå€¼çš„ä½ç½®ã€‚è®©æˆ‘ä»¬å°è¯•ç€å»å†™ä¸€ç‰ˆï¼š

```js
// ç¬¬ä¸€ç‰ˆ
function sortedIndex(array, obj) {

  var low = 0, high = array.length;
  
  while (low < high) {
    var mid = Math.floor((low + high) / 2);
    if (array[mid] < obj) low = mid + 1;
    else high = mid;
  }
  
  return high;
};

console.log(sortedIndex([10, 20, 30, 40, 50], 35)) // 3
```

ç°åœ¨çš„æ–¹æ³•è™½ç„¶èƒ½ç”¨ï¼Œä½†é€šç”¨æ€§ä¸å¤Ÿï¼Œæ¯”å¦‚æˆ‘ä»¬å¸Œæœ›èƒ½å¤„ç†è¿™æ ·çš„æƒ…å†µï¼š

```js
// stooges é…è§’ æ¯”å¦‚ ä¸‰ä¸ªè‡­çš®åŒ  The Three Stooges
var stooges = [{name: 'stooge1', age: 10}, {name: 'stooge2', age: 30}];

var result = sortedIndex(stooges, {name: 'stooge3', age: 20}, function(stooge){
  return stooge.age;
});

console.log(result) // 1
```

æ‰€ä»¥æˆ‘ä»¬è¿˜éœ€è¦å†åŠ ä¸Šä¸€ä¸ªå‚æ•° iteratee å‡½æ•°å¯¹æ•°ç»„çš„æ¯ä¸€ä¸ªå…ƒç´ è¿›è¡Œå¤„ç†ï¼Œä¸€èˆ¬è¿™ä¸ªæ—¶å€™ï¼Œè¿˜ä¼šæ¶‰åŠåˆ° this æŒ‡å‘çš„é—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬å†ä¼ ä¸€ä¸ª context æ¥è®©æˆ‘ä»¬å¯ä»¥æŒ‡å®š thisï¼Œé‚£ä¹ˆè¿™æ ·ä¸€ä¸ªå‡½æ•°åˆè¯¥å¦‚ä½•å†™å‘¢ï¼Ÿ

```js
// ç¬¬äºŒç‰ˆ
function cb(func, context) {
  if (context === void 0) return func;
  return function() {
    return func.apply(context, arguments);
  };
}

function sortedIndex(array, obj, iteratee, context) {

  iteratee = cb(iteratee, context)
  
  var low = 0, high = array.length;
  while (low < high) {
    var mid = Math.floor((low + high) / 2);
    if (iteratee(array[mid]) < iteratee(obj)) low = mid + 1;
    else high = mid;
  }
  return high;
};
```

## å…­. indexOf

sortedIndex ä¹Ÿå®Œæˆäº†ï¼Œç°åœ¨æˆ‘ä»¬å°è¯•ç€å»å†™ä¸€ä¸ª indexOf å’Œ lastIndexOf å‡½æ•°ï¼Œå­¦ä¹  findIndex å’Œ FindLastIndex çš„æ–¹å¼ï¼Œæˆ‘ä»¬å†™ä¸€ç‰ˆï¼š

```js
// ç¬¬ä¸€ç‰ˆ
function createIndexOfFinder(dir) {
  return function(array, item){
    var length = array.length;
    var index = dir > 0 ? 0 : length - 1;
    for (; index >= 0 && index < length; index += dir) {
      if (array[index] === item) return index;
    }
    return -1;
  }
}

var indexOf = createIndexOfFinder(1);
var lastIndexOf = createIndexOfFinder(-1);

var result = indexOf([1, 2, 3, 4, 5], 2);

console.log(result) // 1
```

## ä¸ƒ. fromIndex

ä½†æ˜¯å³ä½¿æ˜¯æ•°ç»„çš„ indexOf æ–¹æ³•ä¹Ÿå¯ä»¥å¤šä¼ é€’ä¸€ä¸ªå‚æ•° fromIndexï¼Œä» MDN ä¸­çœ‹åˆ° fromIndex çš„è®²ç©¶å¯æœ‰ç‚¹å¤šï¼š

> è®¾å®šå¼€å§‹æŸ¥æ‰¾çš„ä½ç½®ã€‚å¦‚æœè¯¥ç´¢å¼•å€¼å¤§äºæˆ–ç­‰äºæ•°ç»„é•¿åº¦ï¼Œæ„å‘³ç€ä¸ä¼šåœ¨æ•°ç»„é‡ŒæŸ¥æ‰¾ï¼Œè¿”å› -1ã€‚å¦‚æœå‚æ•°ä¸­æä¾›çš„ç´¢å¼•å€¼æ˜¯ä¸€ä¸ªè´Ÿå€¼ï¼Œåˆ™å°†å…¶ä½œä¸ºæ•°ç»„æœ«å°¾çš„ä¸€ä¸ªæŠµæ¶ˆï¼Œå³ -1 è¡¨ç¤ºä»æœ€åä¸€ä¸ªå…ƒç´ å¼€å§‹æŸ¥æ‰¾ï¼Œ-2 è¡¨ç¤ºä»å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ å¼€å§‹æŸ¥æ‰¾ ï¼Œ
> ä»¥æ­¤ç±»æ¨ã€‚ æ³¨æ„ï¼šå¦‚æœå‚æ•°ä¸­æä¾›çš„ç´¢å¼•å€¼æ˜¯ä¸€ä¸ªè´Ÿå€¼ï¼Œä»ç„¶ä»å‰å‘åæŸ¥è¯¢æ•°ç»„ã€‚å¦‚æœæŠµæ¶ˆåçš„ç´¢å¼•å€¼ä»å°äº 0ï¼Œåˆ™æ•´ä¸ªæ•°ç»„éƒ½å°†ä¼šè¢«æŸ¥è¯¢ã€‚å…¶é»˜è®¤å€¼ä¸º 0ã€‚

å†çœ‹çœ‹ lastIndexOf çš„ fromIndexï¼š

> ä»æ­¤ä½ç½®å¼€å§‹é€†å‘æŸ¥æ‰¾ã€‚é»˜è®¤ä¸ºæ•°ç»„çš„é•¿åº¦å‡ 1ï¼Œå³æ•´ä¸ªæ•°ç»„éƒ½è¢«æŸ¥æ‰¾ã€‚å¦‚æœè¯¥å€¼å¤§äºæˆ–ç­‰äºæ•°ç»„çš„é•¿åº¦ï¼Œåˆ™æ•´ä¸ªæ•°ç»„ä¼šè¢«æŸ¥æ‰¾ã€‚å¦‚æœä¸ºè´Ÿå€¼ï¼Œå°†å…¶è§†ä¸ºä»æ•°ç»„æœ«å°¾å‘å‰çš„åç§»ã€‚å³ä½¿è¯¥å€¼ä¸ºè´Ÿï¼Œæ•°ç»„ä»ç„¶ä¼šè¢«ä»åå‘å‰æŸ¥æ‰¾ã€‚å¦‚æœè¯¥å€¼ä¸ºè´Ÿæ—¶ï¼Œ
> å…¶ç»å¯¹å€¼å¤§äºæ•°ç»„é•¿åº¦ï¼Œåˆ™æ–¹æ³•è¿”å› -1ï¼Œå³æ•°ç»„ä¸ä¼šè¢«æŸ¥æ‰¾ã€‚

æŒ‰ç…§è¿™ä¹ˆå¤šçš„è§„åˆ™ï¼Œæˆ‘ä»¬å°è¯•ç€å»å†™ç¬¬äºŒç‰ˆï¼š

```js
// ç¬¬äºŒç‰ˆ
function createIndexOfFinder(dir) {

  return function(array, item, idx){
  var length = array.length;
  var i = 0;
  
  if (typeof idx == "number") {
    if (dir > 0) {
      i = idx >= 0 ? idx : Math.max(length + idx, 0);
    }
    else {
      length = idx >= 0 ? Math.min(idx + 1, length) : idx + length + 1;
    }
  }
  
  for (idx = dir > 0 ? i : length - 1; idx >= 0 && idx < length; idx += dir) {
    if (array[idx] === item) return idx;
  }
  return -1;
  }
}

var indexOf = createIndexOfFinder(1);
var lastIndexOf = createIndexOfFinder(-1);
```

## å…«. ä¼˜åŒ–

åˆ°æ­¤ä¸ºæ­¢ï¼Œå·²ç»å¾ˆæ¥è¿‘åŸç”Ÿçš„ indexOf å‡½æ•°äº†ï¼Œä½†æ˜¯ underscore åœ¨æ­¤åŸºç¡€ä¸Šè¿˜åšäº†ä¸¤ç‚¹ä¼˜åŒ–ã€‚

ç¬¬ä¸€ä¸ªä¼˜åŒ–æ˜¯æ”¯æŒæŸ¥æ‰¾ NaNã€‚

å› ä¸º NaN ä¸å…¨ç­‰äº NaNï¼Œæ‰€ä»¥åŸç”Ÿçš„ indexOf å¹¶ä¸èƒ½æ‰¾å‡º NaN çš„ä¸‹æ ‡ã€‚

```js
[1, NaN].indexOf(NaN); // -1
```

é‚£ä¹ˆæˆ‘ä»¬è¯¥å¦‚ä½•å®ç°è¿™ä¸ªåŠŸèƒ½å‘¢ï¼Ÿ

å°±æ˜¯ä»æ•°ç»„ä¸­æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„å€¼çš„ä¸‹æ ‡å˜›ï¼Œä¸å°±æ˜¯æˆ‘ä»¬æœ€ä¸€å¼€å§‹å†™çš„ findIndex å—ï¼Ÿ

æˆ‘ä»¬æ¥å†™ä¸€ä¸‹ï¼š

```js
// ç¬¬ä¸‰ç‰ˆ
function createIndexOfFinder(dir, predicate) {

  return function(array, item, idx){
  
    if () { ... }
  
      // åˆ¤æ–­å…ƒç´ æ˜¯å¦æ˜¯ NaN
    if (item !== item) {
      // åœ¨æˆªå–å¥½çš„æ•°ç»„ä¸­æŸ¥æ‰¾ç¬¬ä¸€ä¸ªæ»¡è¶³isNaNå‡½æ•°çš„å…ƒç´ çš„ä¸‹æ ‡
      idx = predicate(array.slice(i, length), isNaN)
      return idx >= 0 ? idx + i: -1;
    }
  
    for () { ... }
  }
}

var indexOf = createIndexOfFinder(1, findIndex);
var lastIndexOf = createIndexOfFinder(-1, findLastIndex);
```

ç¬¬äºŒä¸ªä¼˜åŒ–æ˜¯æ”¯æŒå¯¹æœ‰åºçš„æ•°ç»„è¿›è¡Œæ›´å¿«çš„äºŒåˆ†æŸ¥æ‰¾ã€‚

å¦‚æœ indexOf ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ä¼ å¼€å§‹æœç´¢çš„ä¸‹æ ‡å€¼ï¼Œè€Œæ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ trueï¼Œå°±è®¤ä¸ºæ•°ç»„æ˜¯ä¸€ä¸ªæ’å¥½åºçš„æ•°ç»„ï¼Œè¿™æ—¶å€™ï¼Œå°±ä¼šé‡‡ç”¨æ›´å¿«çš„äºŒåˆ†æ³•è¿›è¡ŒæŸ¥æ‰¾ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œå¯ä»¥åˆ©ç”¨æˆ‘ä»¬å†™çš„ sortedIndex å‡½æ•°ã€‚

åœ¨è¿™é‡Œç›´æ¥ç»™æœ€ç»ˆçš„æºç ï¼š

```js
// ç¬¬å››ç‰ˆ
function createIndexOfFinder(dir, predicate, sortedIndex) {

  return function(array, item, idx){
    var length = array.length;
    var i = 0;
  
    if (typeof idx == "number") {
      if (dir > 0) {
        i = idx >= 0 ? idx : Math.max(length + idx, 0);
      }
      else {
        length = idx >= 0 ? Math.min(idx + 1, length) : idx + length + 1;
      }
    }
    else if (sortedIndex && idx && length) {
      idx = sortedIndex(array, item);
      // å¦‚æœè¯¥æ’å…¥çš„ä½ç½®çš„å€¼æ­£å¥½ç­‰äºå…ƒç´ çš„å€¼ï¼Œè¯´æ˜æ˜¯ç¬¬ä¸€ä¸ªç¬¦åˆè¦æ±‚çš„å€¼
      return array[idx] === item ? idx : -1;
    }
  
    // åˆ¤æ–­æ˜¯å¦æ˜¯ NaN
    if (item !== item) {
      idx = predicate(array.slice(i, length), isNaN)
      return idx >= 0 ? idx + i: -1;
    }
  
    for (idx = dir > 0 ? i : length - 1; idx >= 0 && idx < length; idx += dir) {
      if (array[idx] === item) return idx;
    }
    return -1;
  }
}

var indexOf = createIndexOfFinder(1, findIndex, sortedIndex);
var lastIndexOf = createIndexOfFinder(-1, findLastIndex);
```

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šåœ¨ underscore çš„å®ç°ä¸­ï¼Œåªæœ‰ indexOf æ˜¯æ”¯æŒæœ‰åºæ•°ç»„ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾ï¼ŒlastIndexOf å¹¶ä¸æ”¯æŒã€‚
