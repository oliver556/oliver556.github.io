---
title: ES6 ç³»åˆ—ä¹‹ Babel æ˜¯å¦‚ä½•ç¼–è¯‘ Class çš„(ä¸Š)
date: 2021-12-02 16:48:03
permalink: /pages/7d7afa/
categories:
  - å‰ç«¯æŠ€æœ¯
tags:
  - JavaScript ES6
---

# ES6 ç³»åˆ—ä¹‹ Babel æ˜¯å¦‚ä½•ç¼–è¯‘ Class çš„(ä¸Š)

## ğŸ“–. å‰è¨€

åœ¨äº†è§£ Babel æ˜¯å¦‚ä½•ç¼–è¯‘ class å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹ ES6 çš„ class å’Œ ES5 çš„æ„é€ å‡½æ•°æ˜¯å¦‚ä½•å¯¹åº”çš„ã€‚æ¯•ç«Ÿï¼ŒES6 çš„ class å¯ä»¥çœ‹ä½œä¸€ä¸ªè¯­æ³•ç³–ï¼Œå®ƒçš„ç»å¤§éƒ¨åˆ†åŠŸèƒ½ï¼ŒES5 éƒ½å¯ä»¥åšåˆ°ï¼Œ
æ–°çš„ class å†™æ³•åªæ˜¯è®©å¯¹è±¡åŸå‹çš„å†™æ³•æ›´åŠ æ¸…æ™°ã€æ›´åƒé¢å‘å¯¹è±¡ç¼–ç¨‹çš„è¯­æ³•è€Œå·²ã€‚

## ä¸€. constructor

ES6 ä¸­ï¼š

```js
class Person {
    constructor(name) {
        this.name = name;
    }

    sayHello() {
        return 'hello, I am ' + this.name;
    }
}

var kevin = new Person('Kevin');
kevin.sayHello(); // hello, I am Kevin
```

å¯¹åº”åˆ° ES5 ä¸­å°±æ˜¯:

```js
function Person(name) {
    this.name = name;
}

Person.prototype.sayHello = function () {
    return 'hello, I am ' + this.name;
};

var kevin = new Person('Kevin');
kevin.sayHello(); // hello, I am Kevin
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ° ES5 çš„æ„é€ å‡½æ•° Personï¼Œå¯¹åº” ES6 çš„ Person ç±»çš„ constructor æ–¹æ³•ã€‚

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š**ç±»çš„å†…éƒ¨æ‰€æœ‰å®šä¹‰çš„æ–¹æ³•ï¼Œéƒ½æ˜¯ä¸å¯æšä¸¾çš„ï¼ˆnon-enumerableï¼‰**

ä»¥ä¸Šé¢çš„ä¾‹å­ä¸ºä¾‹ï¼Œåœ¨ ES6 ä¸­ï¼š

```js
Object.keys(Person.prototype); // []
Object.getOwnPropertyNames(Person.prototype); // ["constructor", "sayHello"]
```

ç„¶è€Œåœ¨ ES5 ä¸­ï¼š

```js
Object.keys(Person.prototype); // ['sayHello']
Object.getOwnPropertyNames(Person.prototype); // ["constructor", "sayHello"]
```

## äºŒ. å®ä¾‹å±æ€§

ä»¥å‰ï¼Œæˆ‘ä»¬å®šä¹‰å®ä¾‹å±æ€§ï¼Œåªèƒ½å†™åœ¨ç±»çš„ constructor æ–¹æ³•é‡Œé¢ã€‚æ¯”å¦‚ï¼š

```js
class Person {
    constructor() {
        this.state = {
            count: 0
        };
    }
}
```

ç„¶è€Œç°åœ¨æœ‰ä¸€ä¸ªææ¡ˆï¼Œå¯¹å®ä¾‹å±æ€§å’Œé™æ€å±æ€§éƒ½è§„å®šäº†æ–°çš„å†™æ³•ï¼Œè€Œä¸” Babel å·²ç»æ”¯æŒã€‚ç°åœ¨æˆ‘ä»¬å¯ä»¥å†™æˆï¼š

```js
class Person {
    state = {
        count: 0
    };
}
```

å¯¹åº”åˆ° ES5 éƒ½æ˜¯ï¼š

```js
function Person() {
    this.state = {
        count: 0
    };
}
```

## ä¸‰. é™æ€æ–¹æ³•

æ‰€æœ‰åœ¨ç±»ä¸­å®šä¹‰çš„æ–¹æ³•ï¼Œéƒ½ä¼šè¢«å®ä¾‹ç»§æ‰¿ã€‚å¦‚æœåœ¨ä¸€ä¸ªæ–¹æ³•å‰ï¼ŒåŠ ä¸Š static å…³é”®å­—ï¼Œå°±è¡¨ç¤ºè¯¥æ–¹æ³•ä¸ä¼šè¢«å®ä¾‹ç»§æ‰¿ï¼Œè€Œæ˜¯ç›´æ¥é€šè¿‡ç±»æ¥è°ƒç”¨ï¼Œè¿™å°±ç§°ä¸ºâ€œé™æ€æ–¹æ³•â€ã€‚

ES6 ä¸­ï¼š

```js
class Person {
    static sayHello() {
        return 'hello';
    }
}

Person.sayHello() // 'hello'

var kevin = new Person();
kevin.sayHello(); // TypeError: kevin.sayHello is not a function
```

å¯¹åº” ES5ï¼š

```js
function Person() {}

Person.sayHello = function() {
    return 'hello';
};

Person.sayHello(); // 'hello'

var kevin = new Person();
kevin.sayHello(); // TypeError: kevin.sayHello is not a function
```

## å››. é™æ€å±æ€§

é™æ€å±æ€§æŒ‡çš„æ˜¯ Class æœ¬èº«çš„å±æ€§ï¼Œå³ Class.propNameï¼Œè€Œä¸æ˜¯å®šä¹‰åœ¨å®ä¾‹å¯¹è±¡ï¼ˆthisï¼‰ä¸Šçš„å±æ€§ã€‚ä»¥å‰ï¼Œæˆ‘ä»¬æ·»åŠ é™æ€å±æ€§åªå¯ä»¥è¿™æ ·ï¼š

```js
class Person {}

Person.name = 'kevin';
```

å› ä¸ºä¸Šé¢æåˆ°çš„ææ¡ˆï¼Œç°åœ¨å¯ä»¥å†™æˆï¼š

```js
class Person {
  static name = 'kevin';
}
```

å¯¹åº”åˆ° ES5 éƒ½æ˜¯ï¼š

```js
function Person() {};

Person.name = 'kevin';
```

## äº”. new è°ƒç”¨

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼šç±»å¿…é¡»ä½¿ç”¨ new è°ƒç”¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚è¿™æ˜¯å®ƒè·Ÿæ™®é€šæ„é€ å‡½æ•°çš„ä¸€ä¸ªä¸»è¦åŒºåˆ«ï¼Œåè€…ä¸ç”¨ new ä¹Ÿå¯ä»¥æ‰§è¡Œã€‚

```js
class Person {}

Person(); // TypeError: Class constructor Foo cannot be invoked without 'new'
```

## å…­. getter å’Œ setter

ä¸ ES5 ä¸€æ ·ï¼Œåœ¨â€œç±»â€çš„å†…éƒ¨å¯ä»¥ä½¿ç”¨ get å’Œ set å…³é”®å­—ï¼Œå¯¹æŸä¸ªå±æ€§è®¾ç½®å­˜å€¼å‡½æ•°å’Œå–å€¼å‡½æ•°ï¼Œæ‹¦æˆªè¯¥å±æ€§çš„å­˜å–è¡Œä¸ºã€‚

```js
class Person {
    get name() {
        return 'kevin';
    }
    set name(newName) {
        console.log('new name ä¸ºï¼š' + newName)
    }
}

let person = new Person();

person.name = 'daisy';
// new name ä¸ºï¼šdaisy

console.log(person.name);
// kevin
```

å¯¹åº”åˆ° ES5 ä¸­ï¼š

```js
function Person(name) {}

Person.prototype = {
    get name() {
        return 'kevin';
    },
    set name(newName) {
        console.log('new name ä¸ºï¼š' + newName)
    }
}

let person = new Person();

person.name = 'daisy';
// new name ä¸ºï¼šdaisy

console.log(person.name);
// kevin
```

## ä¸ƒ. Babel ç¼–è¯‘

è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»çŸ¥é“äº†æœ‰å…³â€œç±»â€çš„æ–¹æ³•ä¸­ï¼ŒES6 ä¸ ES5 æ˜¯å¦‚ä½•å¯¹åº”çš„ï¼Œå®é™…ä¸Š Babel åœ¨ç¼–è¯‘æ—¶å¹¶ä¸ä¼šç›´æ¥å°±è½¬æˆè¿™ç§å½¢å¼ï¼ŒBabel ä¼šè‡ªå·±ç”Ÿæˆä¸€äº›è¾…åŠ©å‡½æ•°ï¼Œå¸®åŠ©å®ç° ES6 çš„ç‰¹æ€§ã€‚

æˆ‘ä»¬å¯ä»¥åœ¨ Babel å®˜ç½‘çš„ [Try it out](https://babeljs.io/repl/#?babili=false&evaluate=true&lineWrap=false&presets=es2015%2Creact%2Cstage-2&targets=&browsers=&builtIns=false&debug=false&code_lz=Q)
é¡µé¢æŸ¥çœ‹ ES6 çš„ä»£ç ç¼–è¯‘æˆä»€ä¹ˆæ ·å­ã€‚

### 1. ç¼–è¯‘ï¼ˆä¸€ï¼‰

ES6 ä»£ç ä¸ºï¼š

```js
class Person {
    constructor(name) {
        this.name = name;
    }
}
```

Babel ç¼–è¯‘ä¸ºï¼š

```js
"use strict";

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function");
    }
}

var Person = function Person(name) {
    _classCallCheck(this, Person);

    this.name = name;
};
```

_classCallCheck çš„ä½œç”¨æ˜¯æ£€æŸ¥ Person æ˜¯å¦æ˜¯é€šè¿‡ new çš„æ–¹å¼è°ƒç”¨ï¼Œåœ¨ä¸Šé¢ï¼Œæˆ‘ä»¬ä¹Ÿè¯´è¿‡ï¼Œç±»å¿…é¡»ä½¿ç”¨ new è°ƒç”¨ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚

å½“æˆ‘ä»¬ä½¿ç”¨ `var person = Person()` çš„å½¢å¼è°ƒç”¨çš„æ—¶å€™ï¼Œthis æŒ‡å‘ windowï¼Œæ‰€ä»¥ `instance instanceof Constructor` å°±ä¼šä¸º falseï¼Œä¸ ES6 çš„è¦æ±‚ä¸€è‡´ã€‚

### 2. ç¼–è¯‘ï¼ˆäºŒï¼‰

ES6 ä»£ç ä¸ºï¼š

```js
class Person {
    // å®ä¾‹å±æ€§
    foo = 'foo';
    // é™æ€å±æ€§
    static bar = 'bar';

    constructor(name) {
        this.name = name;
    }
}
```

Babel ç¼–è¯‘ä¸ºï¼š

```js
'use strict';

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function");
    }
}

var Person = function Person(name) {
    _classCallCheck(this, Person);

    this.foo = 'foo';

    this.name = name;
};

Person.bar = 'bar';
```

### 3. ç¼–è¯‘ï¼ˆä¸‰ï¼‰

ES6 ä»£ç ä¸ºï¼š

```js
class Person {
    constructor(name) {
        this.name = name;
    }

    sayHello() {
        return 'hello, I am ' + this.name;
    }

    static onlySayHello() {
        return 'hello'
    }

    get name() {
        return 'kevin';
    }

    set name(newName) {
        console.log('new name ä¸ºï¼š' + newName)
    }
}
```

å¯¹åº”åˆ° ES5 çš„ä»£ç åº”è¯¥æ˜¯ï¼š

```js
function Person(name) {
    this.name = name;
}

Person.prototype =  {
    sayHello: function () {
        return 'hello, I am ' + this.name;
    },
    get name() {
        return 'kevin';
    },
    set name(newName) {
        console.log('new name ä¸ºï¼š' + newName)
    }
}

Person.onlySayHello = function () {
    return 'hello'
};
```

Babel ç¼–è¯‘åä¸ºï¼š

```js
'use strict';

var _createClass = function() {
    function defineProperties(target, props) {
        for (var i = 0; i < props.length; i++) {
            var descriptor = props[i];
            descriptor.enumerable = descriptor.enumerable || false;
            descriptor.configurable = true;
            if ("value" in descriptor) descriptor.writable = true;
            Object.defineProperty(target, descriptor.key, descriptor);
        }
    }
    return function(Constructor, protoProps, staticProps) {
        if (protoProps) defineProperties(Constructor.prototype, protoProps);
        if (staticProps) defineProperties(Constructor, staticProps);
        return Constructor;
    };
}();

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function");
    }
}

var Person = function() {
    function Person(name) {
        _classCallCheck(this, Person);

        this.name = name;
    }

    _createClass(Person, [{
        key: 'sayHello',
        value: function sayHello() {
            return 'hello, I am ' + this.name;
        }
    }, {
        key: 'name',
        get: function get() {
            return 'kevin';
        },
        set: function set(newName) {
            console.log('new name ä¸ºï¼š' + newName);
        }
    }], [{
        key: 'onlySayHello',
        value: function onlySayHello() {
            return 'hello';
        }
    }]);

    return Person;
}();
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ° Babel ç”Ÿæˆäº†ä¸€ä¸ª _`createClass` è¾…åŠ©å‡½æ•°ï¼Œè¯¥å‡½æ•°ä¼ å…¥ä¸‰ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯æ„é€ å‡½æ•°ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ä¹Ÿå°±æ˜¯ Personï¼Œç¬¬äºŒä¸ªæ˜¯è¦æ·»åŠ åˆ°åŸå‹ä¸Šçš„å‡½æ•°æ•°ç»„ï¼Œç¬¬ä¸‰ä¸ªæ˜¯è¦æ·»åŠ åˆ°æ„é€ å‡½æ•°æœ¬èº«çš„å‡½æ•°æ•°ç»„ï¼Œ
ä¹Ÿå°±æ˜¯æ‰€æœ‰æ·»åŠ  static å…³é”®å­—çš„å‡½æ•°ã€‚è¯¥å‡½æ•°çš„ä½œç”¨å°±æ˜¯å°†å‡½æ•°æ•°ç»„ä¸­çš„æ–¹æ³•æ·»åŠ åˆ°æ„é€ å‡½æ•°æˆ–è€…æ„é€ å‡½æ•°çš„åŸå‹ä¸­ï¼Œæœ€åè¿”å›è¿™ä¸ªæ„é€ å‡½æ•°ã€‚

åœ¨å…¶ä¸­ï¼Œåˆç”Ÿæˆäº†ä¸€ä¸ª `defineProperties` è¾…åŠ©å‡½æ•°ï¼Œä½¿ç”¨ `Object.defineProperty` æ–¹æ³•æ·»åŠ å±æ€§ã€‚

é»˜è®¤ `enumerable` ä¸º falseï¼Œ`configurable` ä¸º trueï¼Œè¿™ä¸ªåœ¨ä¸Šé¢ä¹Ÿæœ‰å¼ºè°ƒè¿‡ï¼Œæ˜¯ä¸ºäº†é˜²æ­¢ `Object.keys()` ä¹‹ç±»çš„æ–¹æ³•éå†åˆ°ã€‚ç„¶åé€šè¿‡åˆ¤æ–­ `value` æ˜¯å¦å­˜åœ¨ï¼Œæ¥åˆ¤æ–­æ˜¯å¦æ˜¯ `getter` å’Œ `setter`ã€‚
å¦‚æœå­˜åœ¨ valueï¼Œå°±ä¸º `descriptor` æ·»åŠ  `value` å’Œ `writable` å±æ€§ï¼Œå¦‚æœä¸å­˜åœ¨ï¼Œå°±ç›´æ¥ä½¿ç”¨ `get` å’Œ `set` å±æ€§ã€‚

## å…«. å†™åœ¨åé¢

è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»äº†è§£äº† Babel æ˜¯å¦‚ä½•ç¼–è¯‘ä¸€ä¸ª Class çš„ï¼Œç„¶è€Œï¼ŒClass è¿˜æœ‰ä¸€ä¸ªé‡è¦çš„ç‰¹æ€§å°±æ˜¯ç»§æ‰¿ï¼ŒClass å¦‚ä½•ç»§æ‰¿ï¼ŒBabel åˆè¯¥å¦‚ä½•ç¼–è¯‘ï¼Œæ¬¢è¿æœŸå¾…ä¸‹ä¸€ç¯‡ã€Š ES6 ç³»åˆ—ä¹‹ Babel æ˜¯å¦‚ä½•ç¼–è¯‘ Class çš„(ä¸‹)ã€‹
