---
title: ES6 ç³»åˆ—ä¹‹ Babel æ˜¯å¦‚ä½•ç¼–è¯‘ Class çš„(ä¸‹)
date: 2021-12-03 17:09:11
permalink: /pages/25e63f/
categories:
  - å‰ç«¯æŠ€æœ¯
tags:
  - Webå¼€å‘
  - JavaScript
  - ES6ç³»åˆ—
---

# ES6 ç³»åˆ—ä¹‹ Babel æ˜¯å¦‚ä½•ç¼–è¯‘ Class çš„(ä¸‹)

## ğŸ“–. å‰è¨€

åœ¨ä¸Šä¸€ç¯‡ [ã€Š ES6 ç³»åˆ— Babel æ˜¯å¦‚ä½•ç¼–è¯‘ Class çš„(ä¸Š)ã€‹](14.ES6ç³»åˆ—ä¹‹Babelæ˜¯å¦‚ä½•ç¼–è¯‘Classçš„-ä¸Š.md)ï¼Œæˆ‘ä»¬çŸ¥é“äº† Babel æ˜¯å¦‚ä½•ç¼–è¯‘ Class çš„ï¼Œè¿™ç¯‡æˆ‘ä»¬å­¦ä¹  Babel æ˜¯å¦‚ä½•ç”¨ ES5 å®ç° Class çš„ç»§æ‰¿ã€‚

## ä¸€. ES5 å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿

```js
function Parent (name) {
    this.name = name;
}

Parent.prototype.getName = function () {
    console.log(this.name)
}

function Child (name, age) {
    Parent.call(this, name);
    this.age = age;
}

Child.prototype = Object.create(Parent.prototype);

var child1 = new Child('kevin', '18');

console.log(child1);
```

åŸå‹é“¾ç¤ºæ„å›¾ä¸ºï¼š

![javascript_05-20_02](https://cdn.staticaly.com/gh/oliver556/image-hosting@master/20220520/javascript_05-20_02.rae3knj0bbk.webp)

å…³äºå¯„ç”Ÿç»„åˆå¼ç»§æ‰¿æˆ‘ä»¬åœ¨ [ã€ŠJavaScriptæ·±å…¥ä¹‹ç»§æ‰¿çš„å¤šç§æ–¹å¼å’Œä¼˜ç¼ºç‚¹ã€‹](../01.æ·±å…¥ç³»åˆ—/15.JavaScriptæ·±å…¥ä¹‹ç»§æ‰¿çš„å¤šç§æ–¹å¼ä»¥åŠä¼˜ç¼ºç‚¹.md) ä¸­ä»‹ç»è¿‡ã€‚

å¼•ç”¨ã€ŠJavaScripté«˜çº§ç¨‹åºè®¾è®¡ã€‹ä¸­å¯¹å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿çš„å¤¸èµå°±æ˜¯ï¼š

> è¿™ç§æ–¹å¼çš„é«˜æ•ˆç‡ä½“ç°å®ƒåªè°ƒç”¨äº†ä¸€æ¬¡ Parent æ„é€ å‡½æ•°ï¼Œå¹¶ä¸”å› æ­¤é¿å…äº†åœ¨ Parent.prototype ä¸Šé¢åˆ›å»ºä¸å¿…è¦çš„ã€å¤šä½™çš„å±æ€§ã€‚ä¸æ­¤åŒæ—¶ï¼ŒåŸå‹é“¾è¿˜èƒ½ä¿æŒä¸å˜ï¼›å› æ­¤ï¼Œè¿˜èƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨ instanceof å’Œ isPrototypeOfã€‚
> å¼€å‘äººå‘˜æ™®éè®¤ä¸ºå¯„ç”Ÿç»„åˆå¼ç»§æ‰¿æ˜¯å¼•ç”¨ç±»å‹æœ€ç†æƒ³çš„ç»§æ‰¿èŒƒå¼ã€‚

## äºŒ. ES6 extend

Class é€šè¿‡ extends å…³é”®å­—å®ç°ç»§æ‰¿ï¼Œè¿™æ¯” ES5 çš„é€šè¿‡ä¿®æ”¹åŸå‹é“¾å®ç°ç»§æ‰¿ï¼Œè¦æ¸…æ™°å’Œæ–¹ä¾¿å¾ˆå¤šã€‚

ä»¥ä¸Š ES5 çš„ä»£ç å¯¹åº”åˆ° ES6 å°±æ˜¯ï¼š

```js
class Parent {
    constructor(name) {
        this.name = name;
    }
}

class Child extends Parent {
    constructor(name, age) {
        super(name); // è°ƒç”¨çˆ¶ç±»çš„ constructor(name)
        this.age = age;
    }
}

var child1 = new Child('kevin', '18');

console.log(child1);
```

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š

`super` å…³é”®å­—è¡¨ç¤ºçˆ¶ç±»çš„æ„é€ å‡½æ•°ï¼Œç›¸å½“äº ES5 çš„ `Parent.call(this)`ã€‚

å­ç±»å¿…é¡»åœ¨ cons`tructor æ–¹æ³•ä¸­è°ƒç”¨ `super` æ–¹æ³•ï¼Œå¦åˆ™æ–°å»ºå®ä¾‹æ—¶ä¼šæŠ¥é”™ã€‚è¿™æ˜¯å› ä¸ºå­ç±»æ²¡æœ‰è‡ªå·±çš„ this å¯¹è±¡ï¼Œè€Œæ˜¯ç»§æ‰¿çˆ¶ç±»çš„ this å¯¹è±¡ï¼Œç„¶åå¯¹å…¶è¿›è¡ŒåŠ å·¥ã€‚å¦‚æœä¸è°ƒç”¨ `super` æ–¹æ³•ï¼Œå­ç±»å°±å¾—ä¸åˆ° this å¯¹è±¡ã€‚

ä¹Ÿæ­£æ˜¯å› ä¸ºè¿™ä¸ªåŸå› ï¼Œåœ¨å­ç±»çš„æ„é€ å‡½æ•°ä¸­ï¼Œåªæœ‰è°ƒç”¨ `super` ä¹‹åï¼Œæ‰å¯ä»¥ä½¿ç”¨ this å…³é”®å­—ï¼Œå¦åˆ™ä¼šæŠ¥é”™ã€‚

## ä¸‰. å­ç±»çš„ __proto__

åœ¨ ES6 ä¸­ï¼Œçˆ¶ç±»çš„é™æ€æ–¹æ³•ï¼Œå¯ä»¥è¢«å­ç±»ç»§æ‰¿ã€‚ä¸¾ä¸ªä¾‹å­ï¼š

```js
class Foo {
  static classMethod() {
    return 'hello';
  }
}

class Bar extends Foo {
}

Bar.classMethod(); // 'hello'
```

è¿™æ˜¯å› ä¸º Class ä½œä¸ºæ„é€ å‡½æ•°çš„è¯­æ³•ç³–ï¼ŒåŒæ—¶æœ‰ prototype å±æ€§å’Œ __proto__ å±æ€§ï¼Œå› æ­¤åŒæ—¶å­˜åœ¨ä¸¤æ¡ç»§æ‰¿é“¾ã€‚

ï¼ˆ1ï¼‰å­ç±»çš„ __proto__ å±æ€§ï¼Œè¡¨ç¤ºæ„é€ å‡½æ•°çš„ç»§æ‰¿ï¼Œæ€»æ˜¯æŒ‡å‘çˆ¶ç±»ã€‚

ï¼ˆ2ï¼‰å­ç±» prototype å±æ€§çš„ __proto__ å±æ€§ï¼Œè¡¨ç¤ºæ–¹æ³•çš„ç»§æ‰¿ï¼Œæ€»æ˜¯æŒ‡å‘çˆ¶ç±»çš„ prototype å±æ€§ã€‚

```js
class Parent {
}

class Child extends Parent {
}

console.log(Child.__proto__ === Parent); // true
console.log(Child.prototype.__proto__ === Parent.prototype); // true
```

ES6 çš„åŸå‹é“¾ç¤ºæ„å›¾ä¸ºï¼š

![javascript_05-20_03](https://cdn.staticaly.com/gh/oliver556/image-hosting@master/20220520/javascript_05-20_03.3yf1bx44mkm0.webp)

æˆ‘ä»¬ä¼šå‘ç°ï¼Œç›¸æ¯”å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿ï¼ŒES6 çš„ class å¤šäº†ä¸€ä¸ª `Object.setPrototypeOf(Child, Parent)` çš„æ­¥éª¤ã€‚

## å››. ç»§æ‰¿ç›®æ ‡

extends å…³é”®å­—åé¢å¯ä»¥è·Ÿå¤šç§ç±»å‹çš„å€¼ã€‚

```js
class B extends A {
}
```

ä¸Šé¢ä»£ç çš„ Aï¼Œåªè¦æ˜¯ä¸€ä¸ªæœ‰ `prototype` å±æ€§çš„å‡½æ•°ï¼Œå°±èƒ½è¢« B ç»§æ‰¿ã€‚ç”±äºå‡½æ•°éƒ½æœ‰ `prototype` å±æ€§ï¼ˆé™¤äº† `Function.prototype` å‡½æ•°ï¼‰ï¼Œå› æ­¤ A å¯ä»¥æ˜¯ä»»æ„å‡½æ•°ã€‚

é™¤äº†å‡½æ•°ä¹‹å¤–ï¼ŒA çš„å€¼è¿˜å¯ä»¥æ˜¯ nullï¼Œå½“ `extend null` çš„æ—¶å€™ï¼š

```js
class A extends null {
}

console.log(A.__proto__ === Function.prototype); // true
console.log(A.prototype.__proto__ === undefined); // true
```

## äº”. Babel ç¼–è¯‘

æ‹¿ ES6 çš„è¿™æ®µä»£ç :

```js
class Parent {
    constructor(name) {
        this.name = name;
    }
}

class Child extends Parent {
    constructor(name, age) {
        super(name); // è°ƒç”¨çˆ¶ç±»çš„ constructor(name)
        this.age = age;
    }
}

var child1 = new Child('kevin', '18');

console.log(child1);
```

Babel åˆæ˜¯å¦‚ä½•ç¼–è¯‘çš„å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥åœ¨ Babel å®˜ç½‘çš„ [Try it out](https://babeljs.io/repl) ä¸­å°è¯•ï¼š

```js
'use strict';

function _possibleConstructorReturn(self, call) {
    if (!self) {
        throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }
    return call && (typeof call === "object" || typeof call === "function") ? call : self;
}

function _inherits(subClass, superClass) {
    if (typeof superClass !== "function" && superClass !== null) {
        throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }
    subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
}

function _classCallCheck(instance, Constructor) {
    if (!(instance instanceof Constructor)) {
        throw new TypeError("Cannot call a class as a function");
    }
}

var Parent = function Parent(name) {
    _classCallCheck(this, Parent);

    this.name = name;
};

var Child = function(_Parent) {
    _inherits(Child, _Parent);

    function Child(name, age) {
        _classCallCheck(this, Child);

        // è°ƒç”¨çˆ¶ç±»çš„ constructor(name)
        var _this = _possibleConstructorReturn(this, (Child.__proto__ || Object.getPrototypeOf(Child)).call(this, name));

        _this.age = age;
        return _this;
    }

    return Child;
}(Parent);

var child1 = new Child('kevin', '18');

console.log(child1);
```

æˆ‘ä»¬å¯ä»¥çœ‹åˆ° Babel åˆ›å»ºäº† _`inherits` å‡½æ•°å¸®åŠ©å®ç°ç»§æ‰¿ï¼Œåˆåˆ›å»ºäº† _`possibleConstructorReturn` å‡½æ•°å¸®åŠ©ç¡®å®šè°ƒç”¨çˆ¶ç±»æ„é€ å‡½æ•°çš„è¿”å›å€¼ï¼Œæˆ‘ä»¬æ¥ç»†è‡´çš„çœ‹ä¸€çœ‹ä»£ç ã€‚

## å…­. _inherits

```js
function _inherits(subClass, superClass) {
    // extend çš„ç»§æ‰¿ç›®æ ‡å¿…é¡»æ˜¯å‡½æ•°æˆ–è€…æ˜¯ null
    if (typeof superClass !== "function" && superClass !== null) {
        throw new TypeError("Super expression must either be null or a function, not " + typeof superClass);
    }

    // ç±»ä¼¼äº ES5 çš„å¯„ç”Ÿç»„åˆå¼ç»§æ‰¿ï¼Œä½¿ç”¨ Object.createï¼Œè®¾ç½®å­ç±» prototype å±æ€§çš„ __proto__ å±æ€§æŒ‡å‘çˆ¶ç±»çš„ prototype å±æ€§
    subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });

    // è®¾ç½®å­ç±»çš„ __proto__ å±æ€§æŒ‡å‘çˆ¶ç±»
    if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass;
}
```

å…³äº Object.create()ï¼Œä¸€èˆ¬æˆ‘ä»¬ç”¨çš„æ—¶å€™ä¼šä¼ å…¥ä¸€ä¸ªå‚æ•°ï¼Œå…¶å®æ˜¯æ”¯æŒä¼ å…¥ä¸¤ä¸ªå‚æ•°çš„ï¼Œç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºè¦æ·»åŠ åˆ°æ–°åˆ›å»ºå¯¹è±¡çš„å±æ€§ï¼Œæ³¨æ„è¿™é‡Œæ˜¯ç»™æ–°åˆ›å»ºçš„å¯¹è±¡å³è¿”å›å€¼æ·»åŠ å±æ€§ï¼Œè€Œä¸æ˜¯åœ¨æ–°åˆ›å»ºå¯¹è±¡çš„åŸå‹å¯¹è±¡ä¸Šæ·»åŠ ã€‚

ä¸¾ä¸ªä¾‹å­ï¼š

```js
// åˆ›å»ºä¸€ä¸ªä»¥å¦ä¸€ä¸ªç©ºå¯¹è±¡ä¸ºåŸå‹,ä¸”æ‹¥æœ‰ä¸€ä¸ªå±æ€§ p çš„å¯¹è±¡
const o = Object.create({}, { p: { value: 42 } });
console.log(o); // {p: 42}
console.log(o.p); // 42
```

å†å®Œæ•´ä¸€ç‚¹ï¼š

```js
const o = Object.create({}, {
  p: {
    value: 42,
    enumerable: false,
    // è¯¥å±æ€§ä¸å¯å†™
    writable: false,
    configurable: true
  }
});
o.p = 24;
console.log(o.p); // 42
```

é‚£ä¹ˆå¯¹äºè¿™æ®µä»£ç ï¼š

```js
subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } });
```

ä½œç”¨å°±æ˜¯ç»™ `subClass.prototype` æ·»åŠ ä¸€ä¸ªå¯é…ç½®å¯å†™ä¸å¯æšä¸¾çš„ `constructor` å±æ€§ï¼Œè¯¥å±æ€§å€¼ä¸º `subClass`ã€‚

## ä¸ƒ. _possibleConstructorReturn

å‡½æ•°é‡Œæ˜¯è¿™æ ·è°ƒç”¨çš„ï¼š

```js
var _this = _possibleConstructorReturn(this, (Child.__proto__ || Object.getPrototypeOf(Child)).call(this, name));
```

æˆ‘ä»¬ç®€åŒ–ä¸ºï¼š

```js
var _this = _possibleConstructorReturn(this, Parent.call(this, name));
```

_`possibleConstructorReturn` çš„æºç ä¸ºï¼š

```js
function _possibleConstructorReturn(self, call) {
    if (!self) {
        throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
    }
    return call && (typeof call === "object" || typeof call === "function") ? call : self;
}
```

åœ¨è¿™é‡Œæˆ‘ä»¬åˆ¤æ–­ `Parent.call(this, name)` çš„è¿”å›å€¼çš„ç±»å‹ï¼Œå’¦ï¼Ÿè¿™ä¸ªå€¼è¿˜èƒ½æœ‰å¾ˆå¤šç±»å‹ï¼Ÿ

å¯¹äºè¿™æ ·ä¸€ä¸ª classï¼š

```js
class Parent {
    constructor() {
        this.xxx = xxx;
    }
}
```

`Parent.call(this, name)` çš„å€¼è‚¯å®šæ˜¯ `undefined`ã€‚å¯æ˜¯å¦‚æœæˆ‘ä»¬åœ¨ `constructor` å‡½æ•°ä¸­ `return` äº†å‘¢ï¼Ÿæ¯”å¦‚ï¼š

```js
class Parent {
    constructor() {
        return {
            name: 'kevin'
        }
    }
}
```

æˆ‘ä»¬å¯ä»¥è¿”å›å„ç§ç±»å‹çš„å€¼ï¼Œç”šè‡³æ˜¯ nullï¼š

```js
class Parent {
    constructor() {
        return null
    }
}
```

æˆ‘ä»¬æ¥ç€çœ‹è¿™ä¸ªåˆ¤æ–­ï¼š

```js
call && (typeof call === "object" || typeof call === "function") ? call : self;
```

æ³¨æ„ï¼Œè¿™å¥è¯çš„æ„æ€å¹¶ä¸æ˜¯åˆ¤æ–­ call æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œå°±æ‰§è¡Œ `(typeof call === "object" || typeof call === "function") ? call : self`

å› ä¸º `&&` çš„è¿ç®—ç¬¦ä¼˜å…ˆçº§é«˜äº `? :`ï¼Œæ‰€ä»¥è¿™å¥è¯çš„æ„æ€åº”è¯¥æ˜¯ï¼š

```js
(call && (typeof call === "object" || typeof call === "function")) ? call : self;
```

å¯¹äº `Parent.call(this)` çš„å€¼ï¼Œå¦‚æœæ˜¯ `object` ç±»å‹æˆ–è€…æ˜¯ `function` ç±»å‹ï¼Œå°±è¿”å› `Parent.call(this)`ï¼Œå¦‚æœæ˜¯ `null` æˆ–è€…åŸºæœ¬ç±»å‹çš„å€¼æˆ–è€…æ˜¯ `undefined`ï¼Œéƒ½ä¼šè¿”å› `self` ä¹Ÿå°±æ˜¯å­ç±»çš„ thisã€‚

è¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆè¿™ä¸ªå‡½æ•°è¢«å‘½åä¸º _`possibleConstructorReturn`ã€‚

## å…«. æ€»ç»“

```js
var Child = function(_Parent) {
    _inherits(Child, _Parent);

    function Child(name, age) {
        _classCallCheck(this, Child);

        // è°ƒç”¨çˆ¶ç±»çš„ constructor(name)
        var _this = _possibleConstructorReturn(this, (Child.__proto__ || Object.getPrototypeOf(Child)).call(this, name));

        _this.age = age;
        return _this;
    }

    return Child;
}(Parent);
```

æœ€åæˆ‘ä»¬æ€»ä½“çœ‹ä¸‹å¦‚ä½•å®ç°ç»§æ‰¿ï¼š

é¦–å…ˆæ‰§è¡Œ `_inherits(Child, Parent)`ï¼Œå»ºç«‹ Child å’Œ Parent çš„åŸå‹é“¾å…³ç³»ï¼Œå³ `Object.setPrototypeOf(Child.prototype, Parent.prototype)` å’Œ `Object.setPrototypeOf(Child, Parent)`ã€‚

ç„¶åè°ƒç”¨ `Parent.call(this, name)`ï¼Œæ ¹æ® Parent æ„é€ å‡½æ•°çš„è¿”å›å€¼ç±»å‹ç¡®å®šå­ç±»æ„é€ å‡½æ•° this çš„åˆå§‹å€¼ _thisã€‚

æœ€ç»ˆï¼Œæ ¹æ®å­ç±»æ„é€ å‡½æ•°ï¼Œä¿®æ”¹ _this çš„å€¼ï¼Œç„¶åè¿”å›è¯¥å€¼ã€‚


