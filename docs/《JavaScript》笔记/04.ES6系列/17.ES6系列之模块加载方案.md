---
title: ES6 ç³»åˆ—ä¹‹æ¨¡å—åŠ è½½æ–¹æ¡ˆ
date: 2021-12-05 11:18:05
permalink: /pages/441c0f/
categories:
  - å‰ç«¯æŠ€æœ¯
tags:
  - Webå¼€å‘
  - JavaScript
  - ES6ç³»åˆ—
---

# ES6 ç³»åˆ—ä¹‹æ¨¡å—åŠ è½½æ–¹æ¡ˆ

## ğŸ“–. å‰è¨€

æœ¬ç¯‡æˆ‘ä»¬é‡ç‚¹ä»‹ç»ä»¥ä¸‹å››ç§æ¨¡å—åŠ è½½è§„èŒƒï¼š

1. AMD
2. CMD 
3. CommonJS 
4. ES6 æ¨¡å—

æœ€åå†å»¶ä¼¸è®²ä¸‹ Babel çš„ç¼–è¯‘å’Œ webpack çš„æ‰“åŒ…åŸç†ã€‚

## ä¸€. require.js

åœ¨äº†è§£ AMD è§„èŒƒä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ require.js çš„ä½¿ç”¨æ–¹å¼ã€‚

é¡¹ç›®ç›®å½•ä¸ºï¼š

```
* project/
    * index.html
    * vender/
        * main.js
        * require.js
        * add.js
        * square.js
        * multiply.js
```

`index.html` çš„å†…å®¹å¦‚ä¸‹ï¼š

```html
<!DOCTYPE html>
<html>
    <head>
        <title>require.js</title>
    </head>
    <body>
        <h1>Content</h1>
        <script data-main="vender/main" src="vender/require.js"></script>
    </body>
</html>
```

`data-main="vender/main"` è¡¨ç¤ºä¸»æ¨¡å—æ˜¯ `vender` ä¸‹çš„ `main.js`ã€‚

`main.js` çš„é…ç½®å¦‚ä¸‹ï¼š

```js
// main.js
require(['./add', './square'], function(addModule, squareModule) {
    console.log(addModule.add(1, 1))
    console.log(squareModule.square(3))
});
```

require çš„ç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºä¾èµ–çš„æ¨¡å—çš„è·¯å¾„ï¼Œç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºæ­¤æ¨¡å—çš„å†…å®¹ã€‚

ç”±æ­¤å¯ä»¥çœ‹å‡ºï¼Œ`ä¸»æ¨¡å—` ä¾èµ– `add æ¨¡å—` å’Œ `square æ¨¡å—`ã€‚

æˆ‘ä»¬çœ‹ä¸‹ `add æ¨¡å—` å³ `add.js` çš„å†…å®¹ï¼š

```js
// add.js
define(function() {
    console.log('åŠ è½½äº† add æ¨¡å—');
    var add = function(x, y) {ã€€
        return x + y;
    };

    return {ã€€ã€€ã€€ã€€ã€€ã€€
        add: add
    };
});
```

`requirejs` ä¸ºå…¨å±€æ·»åŠ äº† `define` å‡½æ•°ï¼Œä½ åªè¦æŒ‰ç…§è¿™ç§çº¦å®šçš„æ–¹å¼ä¹¦å†™è¿™ä¸ªæ¨¡å—å³å¯ã€‚

é‚£å¦‚æœä¾èµ–çš„æ¨¡å—åˆä¾èµ–äº†å…¶ä»–æ¨¡å—å‘¢ï¼Ÿ

æˆ‘ä»¬æ¥çœ‹çœ‹ä¸»æ¨¡å—ä¾èµ–çš„ `square æ¨¡å—`ï¼Œ `square æ¨¡å—` çš„ä½œç”¨æ˜¯æ±‚å‡ºä¸€ä¸ªæ•°å­—çš„å¹³æ–¹ï¼Œæ¯”å¦‚è¾“å…¥ 3 å°±è¿”å› 9ï¼Œè¯¥æ¨¡å—ä¾èµ–ä¸€ä¸ª `ä¹˜æ³•æ¨¡å—`ï¼Œè¯¥ä¹˜æ³•æ¨¡å—å³ `multiply.js` çš„ä»£ç å¦‚ä¸‹ï¼š

```js
// multiply.js
define(function() {
    console.log('åŠ è½½äº† multiply æ¨¡å—')
    var multiply = function(x, y) {ã€€
        return x * y;
    };

    return {ã€€ã€€ã€€ã€€ã€€ã€€
        multiply: multiply
    };
});
```

è€Œ `square æ¨¡å—` å°±è¦ç”¨åˆ° `multiply æ¨¡å—`ï¼Œå…¶å®å†™æ³•è·Ÿ main.js æ·»åŠ ä¾èµ–æ¨¡å—ä¸€æ ·ï¼š

```js
// square.js
define(['./multiply'], function(multiplyModule) {
    console.log('åŠ è½½äº† square æ¨¡å—')
    return {ã€€ã€€ã€€ã€€ã€€ã€€
        square: function(num) {
            return multiplyModule.multiply(num, num)
        }
    };
});
```

require.js ä¼šè‡ªåŠ¨åˆ†æä¾èµ–å…³ç³»ï¼Œå°†éœ€è¦åŠ è½½çš„æ¨¡å—æ­£ç¡®åŠ è½½ã€‚

è€Œå¦‚æœæˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ `index.html`ï¼Œæ‰“å°çš„é¡ºåºä¸ºï¼š

```
åŠ è½½äº† add æ¨¡å—
åŠ è½½äº† multiply æ¨¡å—
åŠ è½½äº† square æ¨¡å—
2
9
```

## äºŒ. AMD

åœ¨ä¸ŠèŠ‚ï¼Œæˆ‘ä»¬è¯´äº†è¿™æ ·ä¸€å¥è¯ï¼š

> `requirejs` ä¸ºå…¨å±€æ·»åŠ äº† `define` å‡½æ•°ï¼Œä½ åªè¦æŒ‰ç…§è¿™ç§çº¦å®šçš„æ–¹å¼ä¹¦å†™è¿™ä¸ªæ¨¡å—å³å¯ã€‚

é‚£è¿™ä¸ªçº¦å®šçš„ä¹¦å†™æ–¹å¼æ˜¯æŒ‡ä»€ä¹ˆå‘¢ï¼Ÿ

æŒ‡çš„ä¾¿æ˜¯ The Asynchronous Module Definition (AMD) è§„èŒƒã€‚

æ‰€ä»¥å…¶å® **AMD æ˜¯ RequireJS åœ¨æ¨å¹¿è¿‡ç¨‹ä¸­å¯¹æ¨¡å—å®šä¹‰çš„è§„èŒƒåŒ–äº§å‡º**ã€‚

ä½ å»çœ‹ [AMD è§„èŒƒ](https://github.com/amdjs/amdjs-api/wiki/AMD-(%E4%B8%AD%E6%96%87%E7%89%88)) çš„å†…å®¹ï¼Œå…¶ä¸»è¦å†…å®¹å°±æ˜¯å®šä¹‰äº† define å‡½æ•°è¯¥å¦‚ä½•ä¹¦å†™ï¼Œ
åªè¦ä½ æŒ‰ç…§è¿™ä¸ªè§„èŒƒä¹¦å†™æ¨¡å—å’Œä¾èµ–ï¼Œrequire.js å°±èƒ½æ­£ç¡®çš„è¿›è¡Œè§£æã€‚

## ä¸‰. sea.js

åœ¨å›½å†…ï¼Œç»å¸¸ä¸ AMD è¢«ä¸€èµ·æèµ·çš„è¿˜æœ‰ CMDï¼ŒCMD åˆæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬ä» sea.js çš„ä½¿ç”¨å¼€å§‹è¯´èµ·ã€‚

æ–‡ä»¶ç›®å½•ä¸ requirejs é¡¹ç›®ç›®å½•ç›¸åŒ:

```
* project/
    * index.html
    * vender/
        * main.js
        * require.js
        * add.js
        * square.js
        * multiply.js
```

`index.html` çš„å†…å®¹å¦‚ä¸‹ï¼š

```html
<!DOCTYPE html>
<html>
<head>
    <title>sea.js</title>
</head>
<body>
    <h1>Content</h1>
    <script src="vender/sea.js"></script>
    <script>
    // åœ¨é¡µé¢ä¸­åŠ è½½ä¸»æ¨¡å—
    seajs.use("./vender/main");
    </script>
</body>

</html>
```

`main.js` çš„å†…å®¹å¦‚ä¸‹ï¼š

```js
// main.js
define(function(require, exports, module) {
    var addModule = require('./add');
    console.log(addModule.add(1, 1))

    var squareModule = require('./square');
    console.log(squareModule.square(3))
});
```

`add.js` çš„å†…å®¹å¦‚ä¸‹ï¼š

```js
// add.js
define(function(require, exports, module) {
    console.log('åŠ è½½äº† add æ¨¡å—')
    var add = function(x, y) {ã€€
        return x + y;
    };
    module.exports = {ã€€ã€€ã€€ã€€ã€€ã€€
        add: add
    };
});
```

`square.js` çš„å†…å®¹å¦‚ä¸‹ï¼š

```js
define(function(require, exports, module) {
    console.log('åŠ è½½äº† square æ¨¡å—')
    var multiplyModule = require('./multiply');
    module.exports = {ã€€ã€€ã€€ã€€ã€€ã€€
        square: function(num) {
            return multiplyModule.multiply(num, num)
        }
    };

});
```

`multiply.js` çš„å†…å®¹å¦‚ä¸‹ï¼š

```js
define(function(require, exports, module) {
    console.log('åŠ è½½äº† multiply æ¨¡å—')
    var multiply = function(x, y) {ã€€
        return x * y;
    };
    module.exports = {ã€€ã€€ã€€ã€€ã€€ã€€
        multiply: multiply
    };
});
```

è·Ÿç¬¬ä¸€ä¸ªä¾‹å­æ˜¯åŒæ ·çš„ä¾èµ–ç»“æ„ï¼Œå³ main ä¾èµ– add å’Œ squareï¼Œsquare åˆä¾èµ– multiplyã€‚

è€Œå¦‚æœæˆ‘ä»¬åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ index.htmlï¼Œæ‰“å°çš„é¡ºåºä¸ºï¼š

```
åŠ è½½äº† add æ¨¡å—
2
åŠ è½½äº† square æ¨¡å—
åŠ è½½äº† multiply æ¨¡å—
9
```

## å››. CMD

ä¸ AMD ä¸€æ ·ï¼ŒCMD å…¶å®å°±æ˜¯ SeaJS åœ¨æ¨å¹¿è¿‡ç¨‹ä¸­å¯¹æ¨¡å—å®šä¹‰çš„è§„èŒƒåŒ–äº§å‡ºã€‚

ä½ å»çœ‹ [CMD è§„èŒƒ](https://github.com/seajs/seajs/issues/242)çš„å†…å®¹ï¼Œä¸»è¦å†…å®¹å°±æ˜¯æè¿°è¯¥å¦‚ä½•å®šä¹‰æ¨¡å—ï¼Œå¦‚ä½•å¼•å…¥æ¨¡å—ï¼Œå¦‚ä½•å¯¼å‡ºæ¨¡å—ï¼Œ
åªè¦ä½ æŒ‰ç…§è¿™ä¸ªè§„èŒƒä¹¦å†™ä»£ç ï¼Œsea.js å°±èƒ½æ­£ç¡®çš„è¿›è¡Œè§£æã€‚

## äº”. AMD ä¸ CMD çš„åŒºåˆ«

ä» sea.js å’Œ require.js çš„ä¾‹å­å¯ä»¥çœ‹å‡ºï¼š

1. CMD æ¨å´‡ **ä¾èµ–å°±è¿‘**ï¼ŒAMD æ¨å´‡ **ä¾èµ–å‰ç½®**ã€‚çœ‹ä¸¤ä¸ªé¡¹ç›®ä¸­çš„ main.jsï¼š

```js
// require.js ä¾‹å­ä¸­çš„ main.js
// ä¾èµ–å¿…é¡»ä¸€å¼€å§‹å°±å†™å¥½
require(['./add', './square'], function(addModule, squareModule) {
    console.log(addModule.add(1, 1))
    console.log(squareModule.square(3))
});
```

```js
// sea.js ä¾‹å­ä¸­çš„ main.js
define(function(require, exports, module) {
    var addModule = require('./add');
    console.log(addModule.add(1, 1))

    // ä¾èµ–å¯ä»¥å°±è¿‘ä¹¦å†™
    var squareModule = require('./square');
    console.log(squareModule.square(3))
});
```

2. å¯¹äºä¾èµ–çš„æ¨¡å—ï¼ŒAMD æ˜¯ **æå‰æ‰§è¡Œ**ï¼ŒCMD æ˜¯ **å»¶è¿Ÿæ‰§è¡Œ**ã€‚çœ‹ä¸¤ä¸ªé¡¹ç›®ä¸­çš„æ‰“å°é¡ºåºï¼š

```
// require.js
åŠ è½½äº† add æ¨¡å—
åŠ è½½äº† multiply æ¨¡å—
åŠ è½½äº† square æ¨¡å—
2
9
```

```
// sea.js
åŠ è½½äº† add æ¨¡å—
2
åŠ è½½äº† square æ¨¡å—
åŠ è½½äº† multiply æ¨¡å—
9
```

AMD æ˜¯å°†éœ€è¦ä½¿ç”¨çš„æ¨¡å—å…ˆåŠ è½½å®Œå†æ‰§è¡Œä»£ç ï¼Œè€Œ CMD æ˜¯åœ¨ require çš„æ—¶å€™æ‰å»åŠ è½½æ¨¡å—æ–‡ä»¶ï¼ŒåŠ è½½å®Œå†æ¥ç€æ‰§è¡Œã€‚

## å…­. æ„Ÿè°¢

æ„Ÿè°¢ require.js å’Œ sea.js åœ¨æ¨åŠ¨ JavaScript æ¨¡å—åŒ–å‘å±•æ–¹é¢åšå‡ºçš„è´¡çŒ®ã€‚

## ä¸ƒ. CommonJS

AMD å’Œ CMD éƒ½æ˜¯ç”¨äºæµè§ˆå™¨ç«¯çš„æ¨¡å—è§„èŒƒï¼Œè€Œåœ¨æœåŠ¡å™¨ç«¯æ¯”å¦‚ nodeï¼Œé‡‡ç”¨çš„åˆ™æ˜¯ CommonJS è§„èŒƒã€‚

å¯¼å‡ºæ¨¡å—çš„æ–¹å¼ï¼š

```js
var add = function(x, y) {ã€€
    return x + y;
};

module.exports.add = add;
```

å¼•å…¥æ¨¡å—çš„æ–¹å¼ï¼š

```js
var add = require('./add.js');
console.log(add.add(1, 1));
```

æˆ‘ä»¬å°†ä¹‹å‰çš„ä¾‹å­æ”¹æˆ CommonJS è§„èŒƒï¼š

```js
// main.js
var add = require('./add.js');
console.log(add.add(1, 1))

var square = require('./square.js');
console.log(square.square(3));
```

```js
// add.js
console.log('åŠ è½½äº† add æ¨¡å—')

var add = function(x, y) {ã€€
    return x + y;
};

module.exports.add = add;
```

```js
// multiply.js
console.log('åŠ è½½äº† multiply æ¨¡å—')

var multiply = function(x, y) {ã€€
    return x * y;
};

module.exports.multiply = multiply;
```

```js
// square.js
console.log('åŠ è½½äº† square æ¨¡å—')

var multiply = require('./multiply.js');

var square = function(num) {ã€€
    return multiply.multiply(num, num);
};

module.exports.square = square;
```

å¦‚æœæˆ‘ä»¬æ‰§è¡Œ `node main.js`ï¼Œæ‰“å°çš„é¡ºåºä¸ºï¼š

```
åŠ è½½äº† add æ¨¡å—
2
åŠ è½½äº† square æ¨¡å—
åŠ è½½äº† multiply æ¨¡å—
9
```

è·Ÿ sea.js çš„æ‰§è¡Œç»“æœä¸€è‡´ï¼Œä¹Ÿæ˜¯åœ¨ require çš„æ—¶å€™æ‰å»åŠ è½½æ¨¡å—æ–‡ä»¶ï¼ŒåŠ è½½å®Œå†æ¥ç€æ‰§è¡Œã€‚

## å…«. CommonJS ä¸ AMD

å¼•ç”¨é˜®ä¸€å³°è€å¸ˆçš„[ã€ŠJavaScript æ ‡å‡†å‚è€ƒæ•™ç¨‹ï¼ˆalphaï¼‰ã€‹](http://javascript.ruanyifeng.com/nodejs/module.html):

> CommonJS è§„èŒƒåŠ è½½æ¨¡å—æ˜¯åŒæ­¥çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œåªæœ‰åŠ è½½å®Œæˆï¼Œæ‰èƒ½æ‰§è¡Œåé¢çš„æ“ä½œã€‚

> AMDè§„èŒƒåˆ™æ˜¯éåŒæ­¥åŠ è½½æ¨¡å—ï¼Œå…è®¸æŒ‡å®šå›è°ƒå‡½æ•°ã€‚
>
> ç”±äº Node.js ä¸»è¦ç”¨äºæœåŠ¡å™¨ç¼–ç¨‹ï¼Œæ¨¡å—æ–‡ä»¶ä¸€èˆ¬éƒ½å·²ç»å­˜åœ¨äºæœ¬åœ°ç¡¬ç›˜ï¼Œæ‰€ä»¥åŠ è½½èµ·æ¥æ¯”è¾ƒå¿«ï¼Œä¸ç”¨è€ƒè™‘éåŒæ­¥åŠ è½½çš„æ–¹å¼ï¼Œæ‰€ä»¥ CommonJS è§„èŒƒæ¯”è¾ƒé€‚ç”¨ã€‚

> ä½†æ˜¯ï¼Œå¦‚æœæ˜¯æµè§ˆå™¨ç¯å¢ƒï¼Œè¦ä»æœåŠ¡å™¨ç«¯åŠ è½½æ¨¡å—ï¼Œè¿™æ—¶å°±å¿…é¡»é‡‡ç”¨éåŒæ­¥æ¨¡å¼ï¼Œå› æ­¤æµè§ˆå™¨ç«¯ä¸€èˆ¬é‡‡ç”¨ AMD è§„èŒƒã€‚

## ä¹. ES6

ECMAScript2015 è§„å®šäº†æ–°çš„æ¨¡å—åŠ è½½æ–¹æ¡ˆã€‚

å¯¼å‡ºæ¨¡å—çš„æ–¹å¼ï¼š

```js
var firstName = 'Michael';
var lastName = 'Jackson';
var year = 1958;

export {firstName, lastName, year};
```

å¼•å…¥æ¨¡å—çš„æ–¹å¼ï¼š

```js
import {firstName, lastName, year} from './profile';
```

æˆ‘ä»¬å†å°†ä¸Šé¢çš„ä¾‹å­æ”¹æˆ ES6 è§„èŒƒï¼š

ç›®å½•ç»“æ„ä¸ requirejs å’Œ seajs ç›®å½•ç»“æ„ä¸€è‡´ã€‚

```html
<!DOCTYPE html>
<html>
    <head>
        <title>ES6</title>
    </head>
    <body>
        <h1>Content</h1>
        <script src="vender/main.js" type="module"></script>
    </body>
</html>
```

æ³¨æ„ï¼æµè§ˆå™¨åŠ è½½ ES6 æ¨¡å—ï¼Œä¹Ÿä½¿ç”¨ `<script>` æ ‡ç­¾ï¼Œä½†æ˜¯è¦åŠ å…¥ `type="module"` å±æ€§ã€‚

```js
// main.js
import {add} from './add.js';
console.log(add(1, 1))

import {square} from './square.js';
console.log(square(3));
```

```html
// add.js
console.log('åŠ è½½äº† add æ¨¡å—')

var add = function(x, y) {
    return x + y;
};

export {add}
```

```js
// multiply.js
console.log('åŠ è½½äº† multiply æ¨¡å—')

var multiply = function(x, y) {ã€€
    return x * y;
};

export {multiply}
```

```js
// square.js
console.log('åŠ è½½äº† square æ¨¡å—')

import {multiply} from './multiply.js';

var square = function(num) {ã€€
    return multiply(num, num);
};

export {square}
```

å€¼å¾—æ³¨æ„çš„ï¼Œåœ¨ Chrome ä¸­ï¼Œå¦‚æœç›´æ¥æ‰“å¼€ï¼Œä¼šæŠ¥è·¨åŸŸé”™è¯¯ï¼Œå¿…é¡»å¼€å¯æœåŠ¡å™¨ï¼Œä¿è¯æ–‡ä»¶åŒæºæ‰å¯ä»¥æœ‰æ•ˆæœã€‚

ä¸ºäº†éªŒè¯è¿™ä¸ªæ•ˆæœä½ å¯ä»¥ï¼š

```bash
cnpm install http-server -g
```

ç„¶åè¿›å…¥è¯¥ç›®å½•ï¼Œæ‰§è¡Œ

```bash
http-server
```

åœ¨æµè§ˆå™¨æ‰“å¼€ `http://localhost:8080/` å³å¯æŸ¥çœ‹æ•ˆæœã€‚

æ‰“å°çš„é¡ºåºä¸ºï¼š

```
åŠ è½½äº† add æ¨¡å—
åŠ è½½äº† multiply æ¨¡å—
åŠ è½½äº† square æ¨¡å—
2
9
```

è·Ÿ require.js çš„æ‰§è¡Œç»“æœæ˜¯ä¸€è‡´çš„ï¼Œä¹Ÿå°±æ˜¯å°†éœ€è¦ä½¿ç”¨çš„æ¨¡å—å…ˆåŠ è½½å®Œå†æ‰§è¡Œä»£ç ã€‚

## å. ES6 ä¸ CommonJS

å¼•ç”¨é˜®ä¸€å³°è€å¸ˆçš„ [ã€ŠECMAScript 6 å…¥é—¨ã€‹](http://es6.ruanyifeng.com/#docs/module-loader)ï¼š

> å®ƒä»¬æœ‰ä¸¤ä¸ªé‡å¤§å·®å¼‚ã€‚
> 
> 1. CommonJS æ¨¡å—è¾“å‡ºçš„æ˜¯ä¸€ä¸ªå€¼çš„æ‹·è´ï¼ŒES6 æ¨¡å—è¾“å‡ºçš„æ˜¯å€¼çš„å¼•ç”¨ã€‚
> 2. CommonJS æ¨¡å—æ˜¯è¿è¡Œæ—¶åŠ è½½ï¼ŒES6 æ¨¡å—æ˜¯ç¼–è¯‘æ—¶è¾“å‡ºæ¥å£ã€‚

ç¬¬äºŒä¸ªå·®å¼‚å¯ä»¥ä»ä¸¤ä¸ªé¡¹ç›®çš„æ‰“å°ç»“æœçœ‹å‡ºï¼Œå¯¼è‡´è¿™ç§å·®åˆ«çš„åŸå› æ˜¯ï¼š

> å› ä¸º CommonJS åŠ è½½çš„æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ˆå³module.exportså±æ€§ï¼‰ï¼Œè¯¥å¯¹è±¡åªæœ‰åœ¨è„šæœ¬è¿è¡Œå®Œæ‰ä¼šç”Ÿæˆã€‚è€Œ ES6 æ¨¡å—ä¸æ˜¯å¯¹è±¡ï¼Œå®ƒçš„å¯¹å¤–æ¥å£åªæ˜¯ä¸€ç§é™æ€å®šä¹‰ï¼Œåœ¨ä»£ç é™æ€è§£æé˜¶æ®µå°±ä¼šç”Ÿæˆã€‚

é‡ç‚¹è§£é‡Šç¬¬ä¸€ä¸ªå·®å¼‚ã€‚

> CommonJS æ¨¡å—è¾“å‡ºçš„æ˜¯å€¼çš„æ‹·è´ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€æ—¦è¾“å‡ºä¸€ä¸ªå€¼ï¼Œæ¨¡å—å†…éƒ¨çš„å˜åŒ–å°±å½±å“ä¸åˆ°è¿™ä¸ªå€¼ã€‚

ä¸¾ä¸ªä¾‹å­ï¼š

```js
// è¾“å‡ºæ¨¡å— counter.js
var counter = 3;
function incCounter() {
  counter++;
}
module.exports = {
    counter: counter,
    incCounter: incCounter,
};
```

```js
// å¼•å…¥æ¨¡å— main.js
var mod = require('./counter');

console.log(mod.counter);  // 3
mod.incCounter();
console.log(mod.counter); // 3
```

counter.js æ¨¡å—åŠ è½½ä»¥åï¼Œå®ƒçš„å†…éƒ¨å˜åŒ–å°±å½±å“ä¸åˆ°è¾“å‡ºçš„ mod.counter äº†ã€‚è¿™æ˜¯å› ä¸º mod.counter æ˜¯ä¸€ä¸ªåŸå§‹ç±»å‹çš„å€¼ï¼Œä¼šè¢«ç¼“å­˜ã€‚

ä½†æ˜¯å¦‚æœä¿®æ”¹ counter ä¸ºä¸€ä¸ªå¼•ç”¨ç±»å‹çš„è¯ï¼š

```js
// è¾“å‡ºæ¨¡å— counter.js
var counter = {
    value: 3
};

function incCounter() {
    counter.value++;
}
module.exports = {
    counter: counter,
    incCounter: incCounter,
};
```

```js
// å¼•å…¥æ¨¡å— main.js
var mod = require('./counter.js');

console.log(mod.counter.value); // 3
mod.incCounter();
console.log(mod.counter.value); // 4
```

value æ˜¯ä¼šå‘ç”Ÿæ”¹å˜çš„ã€‚ä¸è¿‡ä¹Ÿå¯ä»¥è¯´è¿™æ˜¯ "å€¼çš„æ‹·è´"ï¼Œåªæ˜¯å¯¹äºå¼•ç”¨ç±»å‹è€Œè¨€ï¼Œå€¼æŒ‡çš„å…¶å®æ˜¯å¼•ç”¨ã€‚

è€Œå¦‚æœæˆ‘ä»¬å°†è¿™ä¸ªä¾‹å­æ”¹æˆ ES6:

```js
// counter.js
export let counter = 3;
export function incCounter() {
  counter++;
}

// main.js
import { counter, incCounter } from './counter';
console.log(counter); // 3
incCounter();
console.log(counter); // 4
```

è¿™æ˜¯å› ä¸º

> ES6 æ¨¡å—çš„è¿è¡Œæœºåˆ¶ä¸ CommonJS ä¸ä¸€æ ·ã€‚JS å¼•æ“å¯¹è„šæœ¬é™æ€åˆ†æçš„æ—¶å€™ï¼Œé‡åˆ°æ¨¡å—åŠ è½½å‘½ä»¤ importï¼Œå°±ä¼šç”Ÿæˆä¸€ä¸ªåªè¯»å¼•ç”¨ã€‚ç­‰åˆ°è„šæœ¬çœŸæ­£æ‰§è¡Œæ—¶ï¼Œå†æ ¹æ®è¿™ä¸ªåªè¯»å¼•ç”¨ï¼Œ
> åˆ°è¢«åŠ è½½çš„é‚£ä¸ªæ¨¡å—é‡Œé¢å»å–å€¼ã€‚æ¢å¥è¯è¯´ï¼ŒES6 çš„ import æœ‰ç‚¹åƒ Unix ç³»ç»Ÿçš„â€œç¬¦å·è¿æ¥â€ï¼ŒåŸå§‹å€¼å˜äº†ï¼Œimport åŠ è½½çš„å€¼ä¹Ÿä¼šè·Ÿç€å˜ã€‚å› æ­¤ï¼ŒES6 æ¨¡å—æ˜¯åŠ¨æ€å¼•ç”¨ï¼Œå¹¶ä¸”ä¸ä¼šç¼“å­˜å€¼ï¼Œ
> æ¨¡å—é‡Œé¢çš„å˜é‡ç»‘å®šå…¶æ‰€åœ¨çš„æ¨¡å—ã€‚

## åä¸€. Babel

é‰´äºæµè§ˆå™¨æ”¯æŒåº¦çš„é—®é¢˜ï¼Œå¦‚æœè¦ä½¿ç”¨ ES6 çš„è¯­æ³•ï¼Œä¸€èˆ¬éƒ½ä¼šå€ŸåŠ© Babelï¼Œå¯å¯¹äº import å’Œ export è€Œè¨€ï¼Œåªå€ŸåŠ© Babel å°±å¯ä»¥å—ï¼Ÿ

è®©æˆ‘ä»¬çœ‹çœ‹ Babel æ˜¯æ€ä¹ˆç¼–è¯‘ import å’Œ export è¯­æ³•çš„ã€‚

```js
// ES6
var firstName = 'Michael';
var lastName = 'Jackson';
var year = 1958;

export {firstName, lastName, year};
```

```js
// Babel ç¼–è¯‘å
'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
var firstName = 'Michael';
var lastName = 'Jackson';
var year = 1958;

exports.firstName = firstName;
exports.lastName = lastName;
exports.year = year;
```

æ˜¯ä¸æ˜¯æ„Ÿè§‰æœ‰é‚£ä¹ˆä¸€ç‚¹å¥‡æ€ªï¼Ÿç¼–è¯‘åçš„è¯­æ³•æ›´åƒæ˜¯ CommonJS è§„èŒƒï¼Œå†çœ‹ import çš„ç¼–è¯‘ç»“æœï¼š

```js
// ES6
import {firstName, lastName, year} from './profile';
```

```js
// Babel ç¼–è¯‘å
'use strict';

var _profile = require('./profile');
```

ä½ ä¼šå‘ç° Babel åªæ˜¯æŠŠ ES6 æ¨¡å—è¯­æ³•è½¬ä¸º CommonJS æ¨¡å—è¯­æ³•ï¼Œç„¶è€Œæµè§ˆå™¨æ˜¯ä¸æ”¯æŒè¿™ç§æ¨¡å—è¯­æ³•çš„ï¼Œæ‰€ä»¥ç›´æ¥è·‘åœ¨æµè§ˆå™¨ä¼šæŠ¥é”™çš„ï¼Œå¦‚æœæƒ³è¦åœ¨æµè§ˆå™¨ä¸­è¿è¡Œï¼Œè¿˜æ˜¯éœ€è¦ä½¿ç”¨æ‰“åŒ…å·¥å…·å°†ä»£ç æ‰“åŒ…ã€‚

## åäºŒ. webpack

Babel å°† ES6 æ¨¡å—è½¬ä¸º CommonJS åï¼Œ webpack åˆæ˜¯æ€ä¹ˆåšçš„æ‰“åŒ…çš„å‘¢ï¼Ÿå®ƒè¯¥å¦‚ä½•å°†è¿™äº›æ–‡ä»¶æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œä»è€Œèƒ½ä¿è¯æ­£ç¡®çš„å¤„ç†ä¾èµ–ï¼Œä»¥åŠèƒ½åœ¨æµè§ˆå™¨ä¸­è¿è¡Œå‘¢ï¼Ÿ

é¦–å…ˆä¸ºä»€ä¹ˆæµè§ˆå™¨ä¸­ä¸æ”¯æŒ CommonJS è¯­æ³•å‘¢ï¼Ÿ

è¿™æ˜¯å› ä¸ºæµè§ˆå™¨ç¯å¢ƒä¸­å¹¶æ²¡æœ‰ moduleã€ exportsã€ require ç­‰ç¯å¢ƒå˜é‡ã€‚

æ¢å¥è¯è¯´ï¼Œwebpack æ‰“åŒ…åçš„æ–‡ä»¶ä¹‹æ‰€ä»¥åœ¨æµè§ˆå™¨ä¸­èƒ½è¿è¡Œï¼Œå°±æ˜¯é æ¨¡æ‹Ÿäº†è¿™äº›å˜é‡çš„è¡Œä¸ºã€‚

é‚£æ€ä¹ˆæ¨¡æ‹Ÿå‘¢ï¼Ÿ

æˆ‘ä»¬ä»¥ CommonJS é¡¹ç›®ä¸­çš„ square.js ä¸ºä¾‹ï¼Œå®ƒä¾èµ–äº† multiply æ¨¡å—ï¼š

```js
console.log('åŠ è½½äº† square æ¨¡å—')

var multiply = require('./multiply.js');


var square = function(num) {ã€€
    return multiply.multiply(num, num);
};

module.exports.square = square;
```

webpack ä¼šå°†å…¶åŒ…è£¹ä¸€å±‚ï¼Œæ³¨å…¥è¿™äº›å˜é‡ï¼š

```js
function(module, exports, require) {
    console.log('åŠ è½½äº† square æ¨¡å—');

    var multiply = require("./multiply");
    module.exports = {
        square: function(num) {
            return multiply.multiply(num, num);
        }
    };
}
```

é‚£ webpack åˆä¼šå°† CommonJS é¡¹ç›®çš„ä»£ç æ‰“åŒ…æˆä»€ä¹ˆæ ·å‘¢ï¼Ÿæˆ‘å†™äº†ä¸€ä¸ªç²¾ç®€çš„ä¾‹å­ï¼Œä½ å¯ä»¥ç›´æ¥å¤åˆ¶åˆ°æµè§ˆå™¨ä¸­æŸ¥çœ‹æ•ˆæœï¼š

```js
// è‡ªæ‰§è¡Œå‡½æ•°
(function(modules) {

    // ç”¨äºå‚¨å­˜å·²ç»åŠ è½½è¿‡çš„æ¨¡å—
    var installedModules = {};

    function require(moduleName) {

        if (installedModules[moduleName]) {
            return installedModules[moduleName].exports;
        }

        var module = installedModules[moduleName] = {
            exports: {}
        };

        modules[moduleName](module, module.exports, require);

        return module.exports;
    }

    // åŠ è½½ä¸»æ¨¡å—
    return require("main");

})({
    "main": function(module, exports, require) {

        var addModule = require("./add");
        console.log(addModule.add(1, 1))

        var squareModule = require("./square");
        console.log(squareModule.square(3));

    },
    "./add": function(module, exports, require) {
        console.log('åŠ è½½äº† add æ¨¡å—');

        module.exports = {
            add: function(x, y) {
                return x + y;
            }
        };
    },
    "./square": function(module, exports, require) {
        console.log('åŠ è½½äº† square æ¨¡å—');

        var multiply = require("./multiply");
        module.exports = {
            square: function(num) {
                return multiply.multiply(num, num);
            }
        };
    },

    "./multiply": function(module, exports, require) {
        console.log('åŠ è½½äº† multiply æ¨¡å—');

        module.exports = {
            multiply: function(x, y) {
                return x * y;
            }
        };
    }
})
```

æœ€ç»ˆçš„æ‰§è¡Œç»“æœä¸ºï¼š

```
åŠ è½½äº† add æ¨¡å—
2
åŠ è½½äº† square æ¨¡å—
åŠ è½½äº† multiply æ¨¡å—
9
```

## ğŸŒŸ. å‚è€ƒ
- [ã€ŠJavaScript æ ‡å‡†å‚è€ƒæ•™ç¨‹ï¼ˆalphaï¼‰ã€‹](http://javascript.ruanyifeng.com/nodejs/module.html)
- [ã€ŠECMAScript6 å…¥é—¨ã€‹](http://es6.ruanyifeng.com/#docs/module-loader)
- [æ‰‹å†™ä¸€ä¸ªCommonJSæ‰“åŒ…å·¥å…·ï¼ˆä¸€ï¼‰](https://zhuanlan.zhihu.com/p/20731484)
