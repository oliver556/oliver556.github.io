---
title: ES6 ç³»åˆ—ä¹‹ç§æœ‰å˜é‡çš„å®ç°
date: 2021-12-07 15:10:33
permalink: /pages/f949e0/
categories:
  - å‰ç«¯æŠ€æœ¯
tags:
  - Webå¼€å‘
  - JavaScript
  - ES6ç³»åˆ—
---

# ES6 ç³»åˆ—ä¹‹ç§æœ‰å˜é‡çš„å®ç°

## ğŸ“–. å‰è¨€

åœ¨é˜…è¯» ã€ŠECMAScript 6 å…¥é—¨ã€‹çš„æ—¶å€™ï¼Œé›¶æ•£çš„çœ‹åˆ°æœ‰ç§æœ‰å˜é‡çš„å®ç°ï¼Œæ‰€ä»¥åœ¨æ­¤æ€»ç»“ä¸€ç¯‡ã€‚

## ä¸€. çº¦å®š

### 1. å®ç°

```js
class Example {
	constructor() {
		this._private = 'private';
	}
	getName() {
		return this._private;
	}
}

var ex = new Example();

console.log(ex.getName()); // private
console.log(ex._private); // private
```

### 2. ä¼˜ç‚¹

1. å†™æ³•ç®€å• 
2. è°ƒè¯•æ–¹ä¾¿ 
3. å…¼å®¹æ€§å¥½

### 3. ç¼ºç‚¹

1. å¤–éƒ¨å¯ä»¥è®¿é—®å’Œä¿®æ”¹ 
2. è¯­è¨€æ²¡æœ‰é…åˆçš„æœºåˆ¶ï¼Œå¦‚ `for in` è¯­å¥ä¼šå°†æ‰€æœ‰å±æ€§æšä¸¾å‡ºæ¥ 
3. å‘½åå†²çª

## äºŒ. é—­åŒ…

### 1. å®ç°ä¸€

```js
/**
 * å®ç°ä¸€
 */
class Example {
  constructor() {
    var _private = '';
    _private = 'private';
    this.getName = function() {return _private};
  }
}

var ex = new Example();

console.log(ex.getName()); // private
console.log(ex._private); // undefined
```

### 2. ä¼˜ç‚¹

1. æ— å‘½åå†²çª 
2. å¤–éƒ¨æ— æ³•è®¿é—®å’Œä¿®æ”¹

### 3. ç¼ºç‚¹

1. `constructor` çš„é€»è¾‘å˜å¾—å¤æ‚ã€‚æ„é€ å‡½æ•°åº”è¯¥åªåšå¯¹è±¡åˆå§‹åŒ–çš„äº‹æƒ…ï¼Œç°åœ¨ä¸ºäº†å®ç°ç§æœ‰å˜é‡ï¼Œå¿…é¡»åŒ…å«éƒ¨åˆ†æ–¹æ³•çš„å®ç°ï¼Œä»£ç ç»„ç»‡ä¸Šç•¥ä¸æ¸…æ™°ã€‚ 
2. æ–¹æ³•å­˜åœ¨äºå®ä¾‹ï¼Œè€ŒéåŸå‹ä¸Šï¼Œå­ç±»ä¹Ÿæ— æ³•ä½¿ç”¨ `super` è°ƒç”¨ 
3. æ„å»ºå¢åŠ ä¸€ç‚¹ç‚¹å¼€é”€

### 4. å®ç°äºŒ

```js
/**
 * å®ç°äºŒ
 */
const Example = (function() {
  var _private = '';

  class Example {
    constructor() {
      _private = 'private';
    }
    getName() {
      return _private;
    }
  }

  return Example;

})();

var ex = new Example();

console.log(ex.getName()); // private
console.log(ex._private); // undefined
```

### 5. ä¼˜ç‚¹

1. æ— å‘½åå†²çª 
2. å¤–éƒ¨æ— æ³•è®¿é—®å’Œä¿®æ”¹

### 6. ç¼ºç‚¹

1. å†™æ³•æœ‰ä¸€ç‚¹å¤æ‚ 
2. æ„å»ºå¢åŠ ä¸€ç‚¹ç‚¹å¼€é”€

## ä¸‰. Symbol

### 1. å®ç°

```js
const Example = (function() {
    var _private = Symbol('private');

    class Example {
        constructor() {
          this[_private] = 'private';
        }
        getName() {
          return this[_private];
        }
    }

    return Example;
})();

var ex = new Example();

console.log(ex.getName()); // private
console.log(ex.name); // undefined
```

### 2. ä¼˜ç‚¹

1. æ— å‘½åå†²çª 
2. å¤–éƒ¨æ— æ³•è®¿é—®å’Œä¿®æ”¹ 
3. æ— æ€§èƒ½æŸå¤±

### 3. ç¼ºç‚¹

1. å†™æ³•ç¨å¾®å¤æ‚ 
2. å…¼å®¹æ€§ä¹Ÿè¿˜å¥½

## å››. WeakMap

### 1. å®ç°

```js
/**
 * å®ç°ä¸€
 */
const _private = new WeakMap();

class Example {
  constructor() {
    _private.set(this, 'private');
  }
  getName() {
  	return _private.get(this);
  }
}

var ex = new Example();

console.log(ex.getName()); // private
console.log(ex.name); // undefined
```

å¦‚æœè¿™æ ·å†™ï¼Œä½ å¯èƒ½è§‰å¾—å°è£…æ€§ä¸å¤Ÿï¼Œä½ ä¹Ÿå¯ä»¥è¿™æ ·å†™ï¼š

```js
/**
 * å®ç°äºŒ
 */
const Example = (function() {
  var _private = new WeakMap(); // ç§æœ‰æˆå‘˜å­˜å‚¨å®¹å™¨

  class Example {
    constructor() {
      _private.set(this, 'private');
    }
    getName() {
    	return _private.get(this);
    }
  }

  return Example;
})();

var ex = new Example();

console.log(ex.getName()); // private
console.log(ex.name); // undefined
```

### 2. ä¼˜ç‚¹

1. æ— å‘½åå†²çª
2. å¤–éƒ¨æ— æ³•è®¿é—®å’Œä¿®æ”¹

### 3. ç¼ºç‚¹

1. å†™æ³•æ¯”è¾ƒéº»çƒ¦ 
2. å…¼å®¹æ€§æœ‰ç‚¹é—®é¢˜ 
3. æœ‰ä¸€å®šæ€§èƒ½ä»£ä»·

## äº”. æœ€æ–°ææ¡ˆ

```js
class Point {
  #x;
  #y;

  constructor(x, y) {
    this.#x = x;
    this.#y = y;
  }

  equals(point) {
    return this.#x === point.#x && this.#y === point.#y;
  }
}
```

é‚£ä¹ˆä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨ private å­—æ®µå‘¢ï¼Ÿæ¯”å¦‚è¯´è¿™æ ·ï¼š

```js
class Foo {
  private value;

  equals(foo) {
    return this.value === foo.value;
  }
}
```

ç®€å•ç‚¹æ¥è¯´ï¼Œå°±æ˜¯å«Œéº»çƒ¦ï¼Œå½“ç„¶ä¹Ÿæœ‰æ€§èƒ½ä¸Šçš„è€ƒè™‘â€¦â€¦

ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨ `#`ï¼Œè€Œæ˜¯ä½¿ç”¨ `private` å…³é”®å­—ï¼š

```js
class Foo {
  private value = '1';

  equals(foo) {
    return this.value === foo.value;
  }
}

var foo1 = new Foo();
var foo2 = new Foo();

console.log(foo1.equals(foo2));
```

åœ¨è¿™é‡Œæˆ‘ä»¬æ–°å»ºäº†ä¸¤ä¸ªå®ä¾‹ï¼Œç„¶åå°† foo2 ä½œä¸ºå‚æ•°ä¼ å…¥äº† foo1 çš„å®ä¾‹æ–¹æ³•ä¸­ã€‚

é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥è·å– `foo2.value` çš„å€¼å—ï¼Ÿå¦‚æœæˆ‘ä»¬ç›´æ¥ `foo2.value` è‚¯å®šæ˜¯è·å–ä¸åˆ°å€¼çš„ï¼Œæ¯•ç«Ÿæ˜¯ç§æœ‰å˜é‡ï¼Œå¯æ˜¯ `equals` æ˜¯ Foo çš„ä¸€ä¸ªç±»æ–¹æ³•ï¼Œé‚£ä¹ˆå¯ä»¥è·å–åˆ°çš„å—ï¼Ÿ

ç­”æ¡ˆæ˜¯å¯ä»¥çš„ã€‚

å…¶å®è¿™ç‚¹åœ¨å…¶ä»–è¯­è¨€ï¼Œæ¯”å¦‚è¯´ Java å’Œ C++ ä¸­ä¹Ÿæ˜¯ä¸€æ ·çš„ï¼Œ**ç±»çš„æˆå‘˜å‡½æ•°ä¸­å¯ä»¥è®¿é—®åŒç±»å‹å®ä¾‹çš„ç§æœ‰å˜é‡**ï¼Œè¿™æ˜¯å› ä¸ºç§æœ‰æ˜¯ä¸ºäº†å®ç°â€œå¯¹å¤–â€çš„ä¿¡æ¯éšè—ï¼Œåœ¨ç±»è‡ªå·±å†…éƒ¨ï¼Œæ²¡æœ‰å¿…è¦ç¦æ­¢ç§æœ‰å˜é‡çš„è®¿é—®ï¼Œ
ä½ ä¹Ÿå¯ä»¥ç†è§£ä¸ºç§æœ‰å˜é‡çš„é™åˆ¶æ˜¯ä»¥ç±»ä¸ºå•ä½ï¼Œè€Œä¸æ˜¯ä»¥å¯¹è±¡ä¸ºå•ä½ï¼Œæ­¤å¤–è¿™æ ·åšä¹Ÿå¯ä»¥ä¸ºä½¿ç”¨è€…å¸¦æ¥ä¾¿åˆ©ã€‚

æ—¢ç„¶è·å–å€¼æ˜¯å¯ä»¥çš„ï¼Œé‚£ä¹ˆæ‰“å°çš„ç»“æœåº”è¯¥ä¸º trueï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ä¼ å…¥çš„å€¼ä¸æ˜¯ Foo çš„å®ä¾‹ï¼Œè€Œæ˜¯ä¸€ä¸ªå…¶ä»–å¯¹è±¡å‘¢ï¼Ÿ

```js
var foo1 = new Foo();

console.log(foo1.equals({
  value: 2
}));
```

å½“ç„¶è¿™é‡Œä»£ç ä¹Ÿæ˜¯å¯ä»¥æ­£å¸¸è¿è¡Œçš„ï¼Œä½†æ˜¯å¯¹äºç¼–è¯‘å™¨æ¥è¯´ï¼Œå°±æœ‰ä¸€ç‚¹éº»çƒ¦äº†ï¼Œå› ä¸ºç¼–è¯‘å™¨ä¸çŸ¥é“ value åˆ°åº•æ˜¯ foo çš„æ­£å¸¸å±æ€§è¿˜æ˜¯ç§æœ‰å±æ€§ï¼Œæ‰€ä»¥ç¼–è¯‘å™¨éœ€è¦åšåˆ¤æ–­ï¼Œå…ˆåˆ¤æ–­ foo æ˜¯ä¸æ˜¯ Foo çš„å®ä¾‹ï¼Œç„¶åå†æ¥ç€è·å–å€¼ã€‚

è¿™ä¹Ÿæ„å‘³ç€æ¯æ¬¡å±æ€§è®¿é—®éƒ½éœ€è¦åšè¿™æ ·ä¸€ä¸ªåˆ¤æ–­ï¼Œè€Œå¼•æ“å·²ç»å›´ç»•å±æ€§è®¿é—®åšäº†é«˜åº¦ä¼˜åŒ–ï¼Œæ‡’å¾—æ”¹ï¼Œè€Œä¸”è¿˜é™ä½é€Ÿåº¦ã€‚

ä¸è¿‡é™¤äº†è¿™ä¸ªå·¥ä½œä¹‹å¤–ï¼Œè¿˜ä¼šæœ‰ä¸€äº›å…¶ä»–çš„å†…å®¹éœ€è¦è€ƒè™‘ï¼Œæ¯”å¦‚è¯´ï¼š

1. ä½ å¿…é¡»å°†ç§æœ‰çš„ `key` ç¼–ç è¿›æ¯ä¸ªè¯æ³•ç¯å¢ƒ 
2. `for in` å¯ä»¥éå†è¿™äº›å±æ€§å—ï¼Ÿ 
3. ç§æœ‰å±æ€§å’Œæ­£å¸¸å±æ€§åŒåçš„æ—¶å€™ï¼Œè°ä¼šå±è”½è°ï¼Ÿ 
4. æ€ä¹ˆé˜²æ­¢ç§æœ‰å±æ€§çš„åç§°ä¸è¢«æ¢æµ‹å‡ºæ¥ã€‚

å½“ç„¶è¿™äº›é—®é¢˜éƒ½å¯ä»¥è¢«è§£å†³å•¦ï¼Œå°±æ˜¯éº»çƒ¦äº†ç‚¹ã€‚

è€Œå¦‚æœä½ é€‰æ‹© `#`ï¼Œå®ç°çš„æ–¹å¼å°†è·Ÿ JavaScript å¯¹è±¡å±æ€§å®Œå…¨æ²¡æœ‰å…³ç³»ï¼Œå°†ä¼šä½¿ç”¨ `private slots` çš„æ–¹å¼ä»¥åŠä½¿ç”¨ä¸€ä¸ªæ–°çš„ `slot` æŸ¥æ‰¾è¯­æ³•ï¼Œæ€»ä¹‹å°±æ˜¯ä¼šæ¯” `private` çš„å®ç°æ–¹å¼ç®€å•å¾ˆå¤šã€‚

## ğŸŒŸ.å‚è€ƒ

- [ã€Šç¼–ç¨‹è¯­è¨€å¦‚ä½•æ¼”åŒ–â€”â€”ä»¥JSçš„privateä¸ºä¾‹ã€‹è´ºå¸ˆä¿Š](https://v.qq.com/x/page/c0529qeku63.html)
- [Exploring ES6](http://exploringjs.com/es6/ch_classes.html#sec_private-data-for-classes)
- [è¯‘ JS æ–°è¯­æ³•ï¼šç§æœ‰å±æ€§](https://zhuanlan.zhihu.com/p/27360252)
